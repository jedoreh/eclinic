<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>medical</title>
    <link rel="icon" href="img/favicon.png">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- animate CSS -->
    <link rel="stylesheet" href="css/animate.css">
    <!-- owl carousel CSS -->
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <!-- themify CSS -->
    <link rel="stylesheet" href="css/themify-icons.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <!-- flaticon CSS -->
    <link rel="stylesheet" href="css/flaticon.css">
    <!-- magnific popup CSS -->
    <link rel="stylesheet" href="css/magnific-popup.css">
    <!-- nice select CSS -->
    <!-- <link rel="stylesheet" href="css/nice-select.css"> -->
    <!-- swiper CSS -->
    <link rel="stylesheet" href="css/slick.css">
    <!-- style CSS -->
    <link rel="stylesheet" href="css/style.css">
    <style>
        thead, tbody, tr { display: block; }

        tr:after {
            content: ' ';
            display: block;
            visibility: hidden;
            clear: both;
        }

        

        tbody {
            height: 250px;
            overflow-y: auto;
        }

        thead {
            /* fallback */
        }

        thead th {
            height: 30px;

            /*text-align: left;*/
        }

        tbody td, thead th {
            width: 12.2%;
        }

        
    </style>
</head>

<body>
    <!--::header part start::-->
    <header class="main_menu">
            
        </header>
        <!-- Header part end-->
       
    <!-- breadcrumb start-->
    <section class="breadcrumb breadcrumb_bg">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcrumb_iner">
                        <div class="form-row">
                            <div class="form-group col-md-2">
                                <span id="username" style="color:#F1F1F1;font-size: 17px;"></span>
                            </div>
                            <div class="form-group col-md-6">
                                <span id="pagetitle" style="color:#F1F1F1;font-size: 20px;font-weight: bolder;">Prescription Ordering</span>
                            </div>
                            <div class="form-group col-md-2">
                                <span id="sysdate" style="color:#F1F1F1"></span>
                            </div>
                            <div class="form-group col-md-2">
                                <span id="systime" style="color:#F1F1F1"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- breadcrumb start-->

    

    <!--::regervation_part start::-->
    <section class="regervation_part padding_bottom" style="margin-top:30px;">
        <div class="container">
            <div class="row align-items-center regervation_content">
                <div class="col-md-12">
                    <div class="regervation_part_iner">
                        <br>
                        <form action="controllers/add-staff.php" class="frmaddperson">
                            <!-- <h2>Prescription Ordering</h2> -->
                            <div class="label label-success" id="errorlogin"></div>
                            <div class="form-row">
                                
                            </div>
                            
                        </form>
                    </div>
                    <div class="card-box">
                        <ul class="nav nav-tabs nav-tabs-solid nav-tabs-rounded nav-justified">
                            <!-- <li class="nav-item"><a class="nav-link btn-primary active" href="#solid-rounded-justified-tab6" data-toggle="tab">Sex</a></li> -->
                            <!-- <li class="nav-item"><a class="nav-link btn-primary active" href="#solid-rounded-justified-tab3" data-toggle="tab">Prescription Ordering</a></li>  -->
                            <!-- <li class="nav-item"><a class="nav-link btn-primary" href="#solid-rounded-justified-tab7" data-toggle="tab">Weight</a></li>
                            <li class="nav-item"><a class="nav-link btn-primary" href="#solid-rounded-justified-tab8" data-toggle="tab">Frequency</a></li>
                            <li class="nav-item"><a class="nav-link btn-primary" href="#solid-rounded-justified-tab4" data-toggle="tab">Duration</a></li>
                            <li class="nav-item"><a class="nav-link btn-primary" href="#solid-rounded-justified-tab23" data-toggle="tab">Routes</a></li>
                            <li class="nav-item"><a class="nav-link btn-primary" href="#solid-rounded-justified-tab9" data-toggle="tab">Dosage Unit</a></li> -->
                            <!-- <li class="nav-item dropdown">
                                <a href="#" class="dropdown-toggle nav-link" data-toggle="dropdown">Stocking Setup</a>
                                <div class="dropdown-menu dropdown-menu-right">
                                    <a class="dropdown-item" href="#solid-rounded-justified-tab2" data-toggle="tab">Route of Administration</a>
                                    <a class="dropdown-item" href="#solid-rounded-justified-tab3" data-toggle="tab">Category of Importance</a>
                                    <a class="dropdown-item" href="#solid-rounded-justified-tab4" data-toggle="tab">Stock Location</a>
                                    <a class="dropdown-item" href="#solid-rounded-justified-tab5" data-toggle="tab">Physical Position</a> 
                                </div>
                            </li> -->
                            <!-- <li class="nav-item"><a class="nav-link" href="#solid-rounded-justified-tab3" data-toggle="tab">Department Item Group</a></li>
                            <li class="nav-item"><a class="nav-link" href="#solid-rounded-justified-tab4" data-toggle="tab">Generic Name</a></li> -->
                            <!-- <li class="nav-item"><a class="nav-link" href="#solid-rounded-justified-tab5" data-toggle="tab">State</a></li>
                            <li class="nav-item"><a class="nav-link" href="#solid-rounded-justified-tab6" data-toggle="tab">Default Strength</a></li> -->
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane show active" id="solid-rounded-justified-tab3">
                                <br>
                                <!-- <h3>Sex</h3> -->
                                <div class="container">
                                    <div class="row">
                                        <div class="col-12">
                                            <form action="controllers/index.php" class="form-signin">
                                                <!-- <h2>Patient Information</h2> -->
                                                <div class="label label-success" id="card-status"></div>
                                                <div class="form-row">
                                                    <div class="form-group col-md-12 text-danger" id="patientcardtotal">
                                                        
                                                    </div>
                                                    
                                                    <div class="form-group col-md-4">
                                                        Select Patient:<br>
                                                        <select type="text" name="selectpatient" class="form-control" id="selectpatient"></select>
                                                    </div>
                                                    <div class="form-group col-md-2" style="font-size: 20px;">
                                                        HOSPITAL No.:<br>
                                                        <div class="form-patientinfo-hospitalno" id="form-patientinfo-hospitalno"></div>
                                                    </div>
                                                    <div class="form-group col-md-1" style="font-size: 20px;">
                                                        SEX:<br>
                                                        <div class="form-patientinfo-sex" id="form-patientinfo-sex"></div>
                                                    </div>
                                                    <div class="form-group col-md-1" style="font-size: 20px;">
                                                        AGE:<br>
                                                        <span class="form-patientinfo-age" id="form-patientinfo-age"></span>
                                                    </div>                                                        
                                                    <div class="form-group col-md-1" style="font-size: 20px;">
                                                        WGT:<br>
                                                        <span class="form-patientinfo-weight" id="form-patientinfo-weight"></span>
                                                    </div>
                                                    <div class="form-group col-md-1">
                                                        
                                                        <!-- <button type="submit" class="genric-btn primary" id="recall-prescription-button" style="font-size: 24px;border-radius: 8px;">Recall Prescription</button>
                                                        <button type="submit" class="genric-btn success" id="clear-patient-prescription" style="font-size: 24px;border-radius: 8px;">Clear</button> -->
                                                        <!-- <span style="font-size:18px">Default By: </span><br>
                                                        <input type="radio" class="prescriptionview" name="prescriptionview" style="font-size: 24px;" value="Age">&nbsp;<span style="font-size: 24px;">Age</span> 
                                                        <input type="radio" class="prescriptionview" name="prescriptionview" style="font-size: 24px;" value="Weight">&nbsp;<span style="font-size: 24px;">Weight</span>  -->
                                                        <span style="font-size:18px">Presc. No: </span><br>
                                                        <div style="font-size: 24px;" id="nextprescriptionnumber"></div> 
                                                        <!-- <input type="radio" class="prescriptionview" name="prescriptionview" style="font-size: 24px;" value="Weight">&nbsp;<span style="font-size: 24px;">Weight</span>  -->
                                                    </div>
                                                    <div class="form-group col-md-2">
                                                        Search Patient:<br>
                                                        <input type="text" name="searchpatient" class="form-control" id="searchpatient" placeholder="Search Patients" required>
                                                    </div>
                                                    <!-- <div class="form-group col-md-4" id="form-edit-patient"></div>
                                                    <div class="form-group col-md-4" id="form-view-patientstatus"></div>
                                                    <div class="form-group col-md-4" id="form-view-patient"></div> -->
                                                   
                                                        
                                                        <div class="form-group col-md-3">
                                                           
                                                            Order:<br>
                                                            <select name="selectorder" class="form-control" id="selectorder">
                                                                <option value="DRUGS">Prescription Order</option>
                                                                <option value="LAB ">Laboratory Order</option>
                                                                <option value="">Item Order</option>
                                                                <option value="RADIO">Radiology Order</option>
                                                                <option value="MANAGEMENT">Management Plan</option>
                                                            </select>
                                                       
                                                        </div>
                                                        <div class="form-group col-md-2">
                                                            <div id="prescription-by-group">
                                                                Prescription By:<br>
                                                                <select name="prescriptionview" class="form-control" id="prescriptionview">
                                                                    <option value="Age">Default Age Group</option>
                                                                    <option value="Weight">Default Weight</option>
                                                                    <option value="DosingAge">Dosing Per Age Group</option>
                                                                    <option value="DosingUnit">Dosing Per Unit</option>
                                                                    <option value="DosingWeight">Dosing Per Actual Patient Weight</option>
                                                                </select>
                                                            </div>
                                                           
                                                        </div>
                                                        <div class="form-group col-md-3">
                                                            <div id="default-age-group">
                                                                Select Age Group:<br>
                                                                <select name="selectage" class="form-control" id="selectage">
                                                               
                                                                </select>
                                                            </div>
                                                            <div id="default-weight">
                                                                Select Weight:<br>
                                                                <select name="selectweight" class="form-control" id="selectweight">
                                                               
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="form-group col-md-2">
                                                            Select Unit of Prescription:<br>
                                                            <select name="selectunit" class="form-control" id="selectunit">
                                                               
                                                            </select>
                                                        </div>
                                                        <div class="form-group col-md-2">
                                                            Strength of Drug:<br>
                                                            <select id="selectunittype" name="selectunittype" class="form-control">
                                                                <option value="pieces">Pieces/Service</option>
                                                                <option value="weight">Weight</option>
                                                                <option value="volume">Volume</option>
                                                            </select>
                                                            
                                                        </div>
                                                        <!-- <div class="form-group col-md-3">
                                                            Select Age Group:<br>
                                                            <select name="selectage" class="form-control" id="selectage">
                                                               
                                                            </select>
                                                        </div>
                                                        <div class="form-group col-md-1">
                                                            Weight:<br>
                                                            <input type="text" name="enterweight" class="form-control" id="enterweight" placeholder="Weight" required>
                                                        </div>
                                                        <div class="form-group col-md-2">
                                                            Gender:<br>
                                                            <select name="selectgender" class="form-control" id="selectgender">
                                                                <option value="Female">Female</option>
                                                                <option value="Male">Male</option>
                                                            </select>
                                                        </div> -->

                                                        
                                                       
                                                    
                                                        
                                                        <input type="hidden" id="personid" value="0"> 
                                                        <input type="hidden" id="agegroup" value="0"> 
                                                        <input type="hidden" id="patientweight" value="">
                                                        <input type="hidden" id="patientgender" value=""> 
                                                        <input type="hidden" id="paid" value="">
                                                        <input type="hidden" id="selectpatientnumber" value="">
                                                        
                                                    
                                                    
                                                    
                                                    <div class="form-group col-md-12">
                                                        
                                                        <select name="selectprescription" class="form-control" id="selectprescription">
                                                           
                                                        </select>
                                                    </div>
                                                    <!-- <div class="form-group col-md-6">
                                                        <input type="text" name="manufacturercode" class="form-control" id="manufacturercode"
                                                            placeholder="Manufacturer Code">
                                                    </div> -->
                                                    
                                                    <div class="form-patientinfo"></div>
                                                    
                                                </div>
                                                <div class="regerv_btn">
                                                    <!-- <button type="submit" class="genric-btn primary" id="add-patient-prescription" style="font-size: 24px;border-radius: 8px;">Submit Prescription</button> -->
                                                    <!-- <button type="submit" class="genric-btn primary" id="cancel-sex-button" style="font-size: 24px;border-radius: 8px;">Cancel</button>
                                                    <button type="submit" class="genric-btn success" id="edit-sex-button" style="font-size: 24px;border-radius: 8px;">Edit Sex</button>
                                                    <button type="submit" class="genric-btn danger" id="delete-sex-button" style="font-size: 24px;border-radius: 8px;">Confirm Deletion</button> -->
                                                </div>
                                            </form>
                                            <div class="col-12">
                                            
                                                <form action="controllers/index.php" class="form-signin">
                                                    <!-- <h2>Prescription Order</h2> -->
                                                    <div class="label label-success" id="revenue-order-status"></div>
                                                    <div class="form-row">
                                                        
                                                        <div class="form-group col-md-2">

                                                            Advance Search By:<br>
                                                            <select name="advancesearch" class="form-control" id="advancesearch">
                                                                <option value="itemgrouping">Item Search</option>
                                                                <option value="deptitemgroup">Dept Item Group</option>
                                                                <option value="group">Group</option>
                                                                <option value="class">Class</option>
                                                                <option value="subclass">Sub-Class</option>
                                                                <option value="form">Form</option>
                                                                <option value="prescriptionnumber">Prescription Number</option>
                                                                <option value="routinename">Routine Name</option>
                                                            </select>
                                                        </div>
                                                        <div class="form-group col-md-10">
                                                            <div id="itemgrouping">
                                                                <div class="form-group col-md-12">
                                                                    Search All Items:<br>
                                                                    <input type="text" id="searchitems" name="searchitems" class="form-control">
                                                                    
                                                                </div>
                                                                
                                                            </div>
                                                            <div id="deptitemgroup">
                                                                <div class="row">
                                                                    <div class="form-group col-md-3">
                                                                        Department Item Group:<br>
                                                                        <select id="selectdepartmentitemgrouping" name="selectdepartmentitemgrouping" class="form-control"></select>
                                                        
                                                                        <!-- <input type="text" id="searchgroups" name="searchgroups" class="form-control"> -->
                                                                        
                                                                    </div>
                                                                    <div class="form-group col-md-3">
                                                                        Select Group:<br>
                                                                        <select name="selectusagegroup" id="selectusagegroup" class="form-control" required>
                
                                                                        </select>
                                                                    </div>
                                                                    <div class="form-group col-md-3">
                                                                        Select Class:<br>
                                                                        <select name="selectusageclass" id="selectusageclass" class="form-control" required>
                
                                                                        </select>
                                                                    </div>
                                                                    <div class="form-group col-md-3">
                                                                        Select SubClass:<br>
                                                                        <select name="selectusagesubclass" id="selectusagesubclass" class="form-control" required>
                
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                
                                                            </div>
                                                            <div id="group">
                                                                <div class="row">
                                                                    <div class="form-group col-md-3">
                                                                        Search Groups:<br>
                                                                        <!-- <select id="selectdepartmentitemgrouping" name="selectdepartmentitemgrouping" class="form-control"></select> -->
                                                        
                                                                        <input type="text" id="searchgroups" name="searchgroups" class="form-control">
                                                                        
                                                                    </div>
                                                                    <div class="form-group col-md-3">
                                                                        Select Group:<br>
                                                                        <select name="selectusagegroupgroup" id="selectusagegroupgroup" class="form-control" required>
                
                                                                        </select>
                                                                    </div>
                                                                    <div class="form-group col-md-3">
                                                                        Select Class:<br>
                                                                        <select name="selectusageclassgroup" id="selectusageclassgroup" class="form-control" required>
                
                                                                        </select>
                                                                    </div>
                                                                    <div class="form-group col-md-3">
                                                                        Select SubClass:<br>
                                                                        <select name="selectusagesubclassgroup" id="selectusagesubclassgroup" class="form-control" required>
                
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                
                                                            </div>
                                                            <div id="class">
                                                                <div class="row">
                                                                    <div class="form-group col-md-4">
                                                                        Search Class:<br>
                                                                        <input type="text" id="searchclass" name="searchclass" class="form-control">
                                                                        
                                                                    </div>
                                                                    
                                                                    <div class="form-group col-md-4">
                                                                        Select Class:<br>
                                                                        <select name="selectusageclassclass" id="selectusageclassclass" class="form-control" required>
                
                                                                        </select>
                                                                    </div>
                                                                    <div class="form-group col-md-4">
                                                                        Select SubClass:<br>
                                                                        <select name="selectusagesubclassclass" id="selectusagesubclassclass" class="form-control" required>
                
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                
                                                            </div>
                                                            <div id="subclass">
                                                                <div class="row">
                                                                    <div class="form-group col-md-6">
                                                                        Search Sub-Class:<br>
                                                                        <input type="text" id="searchsubclass" name="searchsubclass" class="form-control">
                                                                        
                                                                    </div>
                        
                                                                    <div class="form-group col-md-6">
                                                                        Select SubClass:<br>
                                                                        <select name="selectusagesubclasssubclass" id="selectusagesubclasssubclass" class="form-control" required>
                
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                
                                                            </div>
                                                            <div id="form">
                                                                <div class="row">
                                                                    <div class="form-group col-md-6">
                                                                        Search Item Form:<br>
                                                                        <input type="text" id="searchform" name="searchform" class="form-control">
                                                                        
                                                                    </div>
                        
                                                                    <div class="form-group col-md-6">
                                                                        Select SubClass:<br>
                                                                        <select name="selectform" id="selectform" class="form-control" required>
                
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                
                                                            </div>
                                                            <div id="prescriptionnumber">
                                                                <div class="row">
                                                                    <div class="form-group col-md-6">
                                                                        Prescription Number:<br>
                                                                        <input type="text" id="searchprescription" name="searchprescription" class="form-control">
                                                                        <!-- <select name="selectitemorder" class="form-control" id="selectitemorder"></select> -->
                                                                    </div>
                                                                    <div class="form-group col-md-6">
                                                                        Recall Prescription:<br>
                                                                        <select name="selectitemlist" class="form-control" id="selectitemlist"></select>
                                                                    </div>
                                                                    <!-- <div class="form-group col-md-1">
                                                                        <br>
                                                                        <button type="submit" style="padding-left: 2px;font-size: x-large;" class="genric-btn success" id="recall-itemorder-button" style="font-size: 24px;border-radius: 8px;">Refill</button>
                                                                    </div> -->
                                                                </div>
                                                                
                                                            </div>
                                                            <div id="routinename">
                                                                <div class="row">
                                                                    <div class="form-group col-md-6">
                                                                        Search Routine Name:<br>
                                                                        <input type="text" id="searchregiment" name="searchregiment" class="form-control">
                                                                        
                                                                    </div>
                                                                    <div class="form-group col-md-6">
                                                                        Select Routine:<br>
                                                                        <select name="selectregiment" id="selectregiment" class="form-control" required>
                    
                                                                        </select>
                                                                    </div>
                                                                </div>
                                            
                                                            </div>
                                                        </div>
                                                            
                                                         
                                                        
                                                    </div>
                                                    <div class="form-row">
<!--                                                         
                                                        <div class="regerv_btn">
                                                            <br>
                                                            <button type="submit" class="genric-btn success" id="add-regiment-button" style="font-size: 24px;border-radius: 8px;">Add Regiment</button>
                                                            <p class="btn btn-primary float-right" id="view-revenue-order-price" style="font-size: 24px;"></p>
                                                        </div> -->
                                                    </div>
                                                    
                                                </form>
                                                
                                            </div>

                                            <div class="row">
                                                <div class="col-3">
                                                    <div class="form-group col-md-12">
                                                        Select Item:<br>
                                                        <select id="selectallitem" style="font-size: 18px;" name="selectallitem" size="15" class="form-control"></select>
                                                        
                                                        <br>
                                                        <button type="submit" class="genric-btn primary" id="add-allitem-button" style="font-size: 16px;border-radius: 8px;">Select</button>
                                                        <button type="submit" class="genric-btn success" id="add-regiment-button" style="font-size: 16px;border-radius: 8px;">Add All</button>
                                                        <button type="submit" class="genric-btn success" id="recall-itemorder-button" style="font-size: 16px;border-radius: 8px;">Refill</button>
    
                                                       
                                                    </div>
                                                </div>
                                                <div class="col-9">
                                                    <div class="card" id="prescription-table">
                                                        <div class="card-header">
                                                            <h4 class="card-title d-inline-block">View Prescription: <span id="viewrevenueordernumber"></span></h4>  <p class="btn btn-primary float-right" id="view-revenue-order-count"></p>
                                                            <!-- <p class="float-right"><input type="text" id="searchsex" name="searchsex" placeholder="Search Sex" style="font-size: 18px;"></p> -->
                                                        </div>
                                                        <div class="card-body p-0">
                                                            <div class="table-responsive">
                                                                <table class="table">
                                                                    <thead>
                                                                        <tr>
                                                                            <th><span style="cursor: pointer;" class="checkallitem" id="selectallitems">Select All</span></th>
                                                                            <th>Form</th>
                                                                            <th>GenericName</th>
                                                                            <th>TradeName</th>
                                                                            <th>Prescription</th>
                                                                            <th>Route</th>
                                                                            <th>Qty</th>
                                                                            <th>UnitPrice</th>
                                                                            <th>DosingInstruction</th>
                                                                            <th>Administration Instruction</th>
                                                                            <!-- <th>Strength</th>
                                                                            <th>Item Info</th>
                                                                            <th>Infusion Set Constant</th>
                                                                            <th>Infusion Rate</th>
                                                                            <th>Oxygen Cylinder Constant</th> -->
                                                                            <th>x</th>
                                                                            <th>Action</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody id="view-revenue-order-list">
                                                                        
                                                                        
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card" id="laboratory-table">
                                                        <div class="card-header">
                                                            <h4 class="card-title d-inline-block">View Laboratory Order: <span id="viewrevenueordernumberlab"></span></h4>  <p class="btn btn-primary float-right" id="view-revenue-order-count-lab"></p>
                                                            <!-- <p class="float-right"><input type="text" id="searchsex" name="searchsex" placeholder="Search Sex" style="font-size: 18px;"></p> -->
                                                        </div>
                                                        <div class="card-body p-0">
                                                            <div class="table-responsive">
                                                                <table class="table">
                                                                    <thead>
                                                                        <tr>
                                                                            <th><span style="cursor: pointer;" class="checkallitem" id="selectallitemslab">Select All</span></th>
                                                                            <th></th>
                                                                            <th>Test Request</th>
                                                                            <th>Specimen</th>
                                                                            <th>Sample Collection</th>
                                                                            <th>Unit Price</th>
                                                                            <th>Qty</th>
                                                                            <th>Qty Amount</th>
                                                                            <th>Special Instruction</th>
                                                                           
                                                                            <!-- <th>Strength</th>
                                                                            <th>Item Info</th>
                                                                            <th>Infusion Set Constant</th>
                                                                            <th>Infusion Rate</th>
                                                                            <th>Oxygen Cylinder Constant</th> -->
                                                                            <th>x</th>
                                                                            <th>Action</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody id="view-revenue-order-list-lab">
                                                                        
                                                                        
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card" id="item-order-table">
                                                        <div class="card-header">
                                                            <h4 class="card-title d-inline-block">View Item Order: <span id="viewrevenueordernumberitem"></span></h4>  <p class="btn btn-primary float-right" id="view-revenue-order-count-item"></p>
                                                            <!-- <p class="float-right"><input type="text" id="searchsex" name="searchsex" placeholder="Search Sex" style="font-size: 18px;"></p> -->
                                                        </div>
                                                        <div class="card-body p-0">
                                                            <div class="table-responsive">
                                                                <table class="table">
                                                                    <thead>
                                                                        <tr>
                                                                            <th><span style="cursor: pointer;" class="checkallitem" id="selectallitemslab">Select All</span></th>
                                                                            <th></th>
                                                                            <th>Item Name</th>
                                                                            <th>Department</th>
                                                                            <th>Department Item Group</th>
                                                                            <th>Unit Price</th>
                                                                            <th>Qty</th>
                                                                            <th>Qty Amount</th>
                                                                            
                                                                           
                                                                            <!-- <th>Strength</th>
                                                                            <th>Item Info</th>
                                                                            <th>Infusion Set Constant</th>
                                                                            <th>Infusion Rate</th>
                                                                            <th>Oxygen Cylinder Constant</th> -->
                                                                            <th>x</th>
                                                                            <th>Action</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody id="view-revenue-order-list-item">
                                                                        
                                                                        
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            
                                            
                                        </div>
                                        
                                        <div class="col-12">
                                            
                                            <div class="card">
                                                <div class="card-header">
                                                    <button type="submit" class="genric-btn primary" id="add-prescription-order-button" style="font-size: 24px;border-radius: 8px;">Submit Prescription</button>
                                                    <button type="submit" class="genric-btn success" id="discard-prescription-order-button" style="font-size: 24px;border-radius: 8px;">Cancel</button>
                                                    <button type="submit" class="genric-btn primary" id="update-prescription-order-button" style="font-size: 24px;border-radius: 8px;">Update</button>
                                                    <button type="submit" class="genric-btn danger" id="cancel-prescription-order-button" style="font-size: 24px;border-radius: 8px;">Clear Prescription</button>
                                                     
                                                    <!-- <p class="float-right"><input type="text" id="searchsex" name="searchsex" placeholder="Search Sex" style="font-size: 18px;"></p> -->
                                                </div>
                                                <input type="hidden" id="patientid" value="0">
                                                <input type="hidden" id="patientname" value="">
                                                <input type="hidden" id="revenue-order-number" value="">
                                                <input type="hidden" id="prescriptionorderid" value="">
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            
                                            <form action="controllers/index.php" class="form-signin">
                                                <h2>Adjust Prescription</h2>
                                                <div class="label label-success" id="sex-status"></div>
                                                <div class="form-row" id="packaging">
                                                    <!-- <div class="form-group col-md-6">
                                                        Weight:<br>
                                                        <select class="form-control" id="weight" name="weight">
                                                       </select>
                                                    </div> -->
                                                    <div class="form-group col-md-3">
                                                        Dosage Value:<br>
                                                        <input type="text" class="form-control"  id="enterdosage">
                                                        
                                                    </div>
                                                    <div class="form-group col-md-3">
                                                        Dosage:<br>
                                                      
                                                        <select class="form-control" id="dosage" name="dosage">
                                                       </select>
                                                    </div>
                                                    <div class="form-group col-md-6">
                                                        Frequency:<br>
                                                        <select class="form-control" id="frequency" name="frequency">
                                                       </select>
                                                    </div>
                                                    <div class="form-group col-md-3">
                                                        Duration Value:<br>
                                                        <input type="text" class="form-control"  id="enterduration">
                                                    </div>
                                                    <div class="form-group col-md-3">
                                                        Duration:<br>
                                                        <select class="form-control" id="duration" name="duration">
                                                       </select>
                                                    </div>
                                                    <div class="form-group col-md-6">
                                                        <br>
                                                        <button type="submit" class="genric-btn success" id="save-package-button" style="font-size: 18px;border-radius: 8px;">SAVE</button>

                                                        <button type="submit" class="genric-btn success" id="clear-package-button" style="font-size: 18px;border-radius: 8px;">CLEAR</button>
                                                        
                                                    </div>
                                                </div>
                                                <div class="regerv_btn">
                                                    <!-- <button type="submit" class="genric-btn primary" id="add-patient-revenue-order-button" style="font-size: 24px;border-radius: 8px;">Adjust Prescription for Patient</button> -->
                                                    <!-- <button type="submit" class="genric-btn primary" id="cancel-sex-button" style="font-size: 24px;border-radius: 8px;">Cancel</button>
                                                    <button type="submit" class="genric-btn success" id="edit-sex-button" style="font-size: 24px;border-radius: 8px;">Edit Sex</button>
                                                    <button type="submit" class="genric-btn danger" id="delete-sex-button" style="font-size: 24px;border-radius: 8px;">Confirm Deletion</button> -->
                                                </div>
                                            </form>
                                        </div>
                                        <div class="col-12">
                                            
                                            <div class="card">
                                                <div class="card-header">
                                                    <h4 class="card-title d-inline-block">View Prescriptions</h4>  <p class="btn btn-primary float-right" id="view-item-order-count"></p>
                                                    <p class="float-right"><input type="text" id="searchrevenueorder" name="searchrevenueorder" placeholder="Search Revenue Order" style="font-size: 18px;" value=""></p>
                                                </div>
                                                <div class="card-body p-0">
                                                    <div class="table-responsive scrollable">
                                                        <table class="table">
                                                            <thead>
                                                                <tr>
                                                                    <th>Number</th>
                                                                    <th>Patient</th>
                                                                    <th>Date</th>
                                                                    <th>Total Price</th>
                                                                    <th>Staff</th>
                                                                    
                                                                    <th>Action</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody id="view-all-revenue-order-list">
                                                                
                                                                
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- <div class="col-lg-5 col-md-6">
                    <div class="reservation_img">
                        <img src="img/loginphoto.jpg" alt="">
                    </div>
                </div> -->
            </div>
        </div>
    </section>
    <!--::regervation_part end::-->

    
    <!-- footer part start-->
    <footer class="footer-area">

        <div class="copyright_part">
            
        </div>
    </footer>

    <!-- footer part end-->

    <!-- jquery plugins here-->

    <script src="js/jquery-1.12.1.min.js"></script>
    <!-- popper js -->
    <script src="js/popper.min.js"></script>
    <!-- bootstrap js -->
    <script src="js/bootstrap.min.js"></script>
    <!-- easing js -->
    <script src="js/jquery.magnific-popup.js"></script>
    <!-- swiper js -->
    <script src="js/swiper.min.js"></script>
    <!-- swiper js -->
    <script src="js/masonry.pkgd.js"></script>
    <!-- particles js -->
    <script src="js/owl.carousel.min.js"></script>
    <!-- <script src="js/jquery.nice-select.min.js"></script> -->
    <!-- swiper js -->
    <script src="js/slick.min.js"></script>
    <script src="js/jquery.counterup.min.js"></script>
    <script src="js/waypoints.min.js"></script>
    <!-- contact js -->
    <script src="js/jquery.ajaxchimp.min.js"></script>
    <script src="js/jquery.form.js"></script>
    <script src="js/jquery.validate.min.js"></script>
    <script src="js/mail-script.js"></script>
    <script src="js/contact.js"></script>
    <!-- custom js -->
    <script src="js/custom.js"></script>
    <script src="views/masterpage.js"></script>
   <script>
       $(document).ready(function(){

            // get departments
            let departmentitemgrouplist = ``
            let departmentlist = ``
            
            let getDepartment = "getDepartment"
            let searchItem = ""

            let deptitemgrpitems = ``
            let displayselectedlistitems = ``

            $("#selectdepartment").on("change", function(evt){
                     evt.preventDefault()
                    //  let department = $("#selectdepartment").val()
                     let department = $("#selectdepartment").val()
                    let splitsearch = department.split(",")
                    department = splitsearch[1]
                        let getDepartmentItemGroupByDepartment = "getDepartmentItemGroupByDepartment"
                        $.post("controllers/combo-setup.php",{department:department,getDepartmentItemGroupByDepartment:getDepartmentItemGroupByDepartment}, function(formdata){
                            if(formdata!="No Record Found"){
                                let data = JSON.parse(formdata)
                                let departmentitemgroupoptions = ``
                                $.each(data.records, function(key, val){
                                    departmentitemgroupoptions += `
                                    <option value="` + val.departmentitemgroup + `">` + val.departmentitemgroup + `</option>
                                    `
                                })
                                departmentitemgrouplist = departmentitemgroupoptions
                                $("#selectdepartmentitemgrouping").html(departmentitemgroupoptions)
                                let departmentitemgroup = $("#selectdepartmentitemgrouping").val()
                                let GetGenericNameByDepartmentItemGrouping = "GetGenericNameByDepartmentItemGrouping"
                                $.post("controllers/combo-setup.php",{searchItem:departmentitemgroup,GetGenericNameByDepartmentItemGrouping:GetGenericNameByDepartmentItemGrouping}, function(formdata){
                                    if(formdata!="No Record Found"){
                                        
                                        let data = JSON.parse(formdata)
                                        let itemoptions = ``
                                        deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                                        $.each(data.records, function(key, val){
                                            itemoptions += `
                                            <option value=" ` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `</option>
                                            `
                                            deptitemgrpitems += `
                                            <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `</option>
                                            `
                                        })
                                        deptitemgrpitems += `</select>`
                                        // departmentitemgrouplist = departmentitemgroupoptions
                                        $("#selectitem").html(itemoptions)
                                        let pricinglist = displayselectedlistitems + `<tr>
                                                    <td></td>
                                                    <td></td>
                                                    <td>` + deptitemgrpitems + `</td>
                                                    <td>
                                                            <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>`
                                        $("#view-revenue-order-list").html(pricinglist)
                                        $("#view-revenue-order-list-item").html(pricinglist)
                                        $("#view-revenue-order-list-lab").html(pricinglist)
                                        $("#selectdptitemgrpitem").on("change", function(evt){
                                            evt.preventDefault()
                                            let selecteditem = $("#selectdptitemgrpitem").val()
                                            selectitemanddisplay(selecteditem)

                                        })
                                        $(".additemtolist").on("click", function(evt){
                                                evt.preventDefault()
                                                let selecteditem = $("#selectdptitemgrpitem").val()
                                                selectitemanddisplay(selecteditem)
                                        })

                                    }

                                })

                                // let deptItemgroup = $("#selectdepartmentitemgrouping").val()
                                let getDeptItemGrpUsageGroup = "getDeptItemGrpUsageGroup"
                                $.post("controllers/combo-setup.php",{searchItem:departmentitemgroup,getDeptItemGrpUsageGroup:getDeptItemGrpUsageGroup}, function(formdata){
                                    if(formdata!="No Record Found"){
                                        let data = JSON.parse(formdata)
                                        let itemgroupoptions = ``
                                        $.each(data.records, function(key, val){
                                            itemgroupoptions += `
                                            <option value="` + val.itemgroup + `">` + val.itemgroup + `</option>
                                            `
                                        })
                                        genericnameusagegrouplist = itemgroupoptions
                                        $("#selectusagegroup").html(itemgroupoptions)
                                        
                                        //$("#selectformdepartmentitemgroup").html(departmentitemgroupoptions)
                                        let selectgroup = $("#selectusagegroup").val()
                                        let getItemClassByItemGroup = "getItemClassByItemGroup"
                                        $.post("controllers/combo-setup.php",{searchItem:selectgroup,getItemClassByItemGroup:getItemClassByItemGroup},function(formdata){
                                            console.log(formdata)
                                            let data = JSON.parse(formdata)
                                            let genericnameclassoptions = ``
                                            $.each(data.records, function(key, val) {
                                            
                                                genericnameclassoptions += `
                                                <option value="` + val.itemclass + `">` + val.itemclass + `</option>
                                                `
                                            })
                                            genericnameusageclasslist = genericnameclassoptions
                                            $("#selectusageclass").html(genericnameclassoptions)
                                            let selectsubclassclass = $("#selectusageclass").val()
                                            let getItemSubClassByClass = "getItemSubClassByClass"
                                            $.post("controllers/combo-setup.php",{selectsubclassclass:selectsubclassclass,getItemSubClassByClass:getItemSubClassByClass},function(formdata){
                                                console.log(formdata)
                                                let data = JSON.parse(formdata)
                                                let genericnamesubclassoptions = `<option value="">Select Sub Class</option>`
                                                $.each(data.records, function(key, val) {
                                                
                                                    genericnamesubclassoptions += `
                                                    <option value="` + val.itemsubclass + `">` + val.itemsubclass + `</option>
                                                    `
                                                })
                                                genericnameusagesubclasslist = genericnamesubclassoptions
                                                $("#selectusagesubclass").html(genericnamesubclassoptions)
                                                let searchItem = $("#searchitems").val()
                                                let selectsubclass = $("#selectusagesubclass").val()
                                                let GetGenericNameByUsageDRUGSSubClass = "GetGenericNameByUsageDRUGSSubClass"
                                                $.post("controllers/combo-setup.php",{searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByUsageDRUGSSubClass:GetGenericNameByUsageDRUGSSubClass},function(formdata){
                                                    console.log(formdata)
                                                    if(formdata!="No Record Found"){
                                                        let data = JSON.parse(formdata)
                                                        let genericnameoptions = ``
                                                        deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                                                        $.each(data.records, function(key, val) {
                                                        
                                                            genericnameoptions += `
                                                            <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `(` + val.itemmanufacturer + `)</option>
                                                            `
                                                            deptitemgrpitems += `
                                                            <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `</option>
                                                            `
                                                        })
                                                        deptitemgrpitems += `</select>`
                                                        genericnamelist = genericnameoptions
                                                        $("#selectallitem").html(genericnameoptions)
                                                        // let selectclass = $("#selectgenericnameitemgroupclass").val()
                                                        let pricinglist = displayselectedlistitems + `<tr>
                                                                    <td></td>
                                                                    <td></td>
                                                                    <td>` + deptitemgrpitems + `</td>
                                                                    <td>
                                                                            <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                                                    <td></td>
                                                                    <td></td>
                                                                    <td></td>
                                                                    <td></td>
                                                                </tr>`
                                                        $("#view-revenue-order-list").html(pricinglist)
                                                        $("#view-revenue-order-list-item").html(pricinglist)
                                                        $("#view-revenue-order-list-lab").html(pricinglist)
                                                        $("#selectdptitemgrpitem").on("change", function(evt){
                                                            evt.preventDefault()
                                                            let selecteditem = $("#selectdptitemgrpitem").val()
                                                            selectitemanddisplay(selecteditem)
                                                        })
                                                        $(".additemtolist").on("click", function(evt){
                                                                evt.preventDefault()
                                                                let selecteditem = $("#selectdptitemgrpitem").val()
                                                                selectitemanddisplay(selecteditem)
                                                        })
                                                    }
                                                
                                                })
                                            })
                                        })
                                    }

                                })
                            }

                        })
                 })

                 $("#selectdepartmentitemgrouping").on("change", function(evt){
                    let departmentitemgroup = $("#selectdepartmentitemgrouping").val()
                    let GetGenericNameByDepartmentItemGrouping = "GetGenericNameByDepartmentItemGrouping"
                    $.post("controllers/combo-setup.php",{searchItem:departmentitemgroup,GetGenericNameByDepartmentItemGrouping:GetGenericNameByDepartmentItemGrouping}, function(formdata){
                        if(formdata!="No Record Found"){
                            console.log(formdata)
                            let data = JSON.parse(formdata)
                            let itemoptions = ``
                            deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                            $.each(data.records, function(key, val){
                                itemoptions += `
                                <option value=" ` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `</option>
                                `
                                deptitemgrpitems += `
                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `</option>
                                `
                            })
                            deptitemgrpitems += `</select>`
                            // departmentitemgrouplist = departmentitemgroupoptions
                            $("#selectitem").html(itemoptions)

                            let pricinglist = displayselectedlistitems + `<tr>
                                        <td></td>
                                        <td></td>
                                        <td>` + deptitemgrpitems + `</td>
                                        <td>
                                                <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>`
                            $("#view-revenue-order-list").html(pricinglist)
                            $("#view-revenue-order-list-item").html(pricinglist)
                            $("#view-revenue-order-list-lab").html(pricinglist)
                            $("#selectdptitemgrpitem").on("change", function(evt){
                                evt.preventDefault()
                                let selecteditem = $("#selectdptitemgrpitem").val()
                                selectitemanddisplay(selecteditem)

                            })
                            $(".additemtolist").on("click", function(evt){
                                    evt.preventDefault()
                                    let selecteditem = $("#selectdptitemgrpitem").val()
                                    selectitemanddisplay(selecteditem)
                            })
                            
                        }



                    })

                    // let deptItemgroup = $("#selectdepartmentitemgrouping").val()
                    let getDeptItemGrpUsageGroup = "getDeptItemGrpUsageGroup"
                    $.post("controllers/combo-setup.php",{searchItem:departmentitemgroup,getDeptItemGrpUsageGroup:getDeptItemGrpUsageGroup}, function(formdata){
                        if(formdata!="No Record Found"){
                            let data = JSON.parse(formdata)
                            let itemoptions = ``
                            $.each(data.records, function(key, val){
                                itemoptions += `
                                <option value="` + val.itemgroup + `">` + val.itemgroup + `</option>
                                `
                            })
                            genericnameusagegrouplist = itemoptions
                            $("#selectusagegroup").html(itemoptions)
                            
                            //$("#selectformdepartmentitemgroup").html(departmentitemgroupoptions)
                            let selectgroup = $("#selectusagegroup").val()
                            let getItemClassByItemGroup = "getItemClassByItemGroup"
                            $.post("controllers/combo-setup.php",{searchItem:selectgroup,getItemClassByItemGroup:getItemClassByItemGroup},function(formdata){
                                console.log(formdata)
                                let data = JSON.parse(formdata)
                                let genericnameclassoptions = ``
                                $.each(data.records, function(key, val) {
                                
                                    genericnameclassoptions += `
                                    <option value="` + val.itemclass + `">` + val.itemclass + `</option>
                                    `
                                })
                                genericnameusageclasslist = genericnameclassoptions
                                $("#selectusageclass").html(genericnameclassoptions)
                                let selectsubclassclass = $("#selectusageclass").val()
                                let getItemSubClassByClass = "getItemSubClassByClass"
                                $.post("controllers/combo-setup.php",{selectsubclassclass:selectsubclassclass,getItemSubClassByClass:getItemSubClassByClass},function(formdata){
                                    console.log(formdata)
                                    let data = JSON.parse(formdata)
                                    let genericnamesubclassoptions = `<option value="">Select Sub Class</option>`
                                    $.each(data.records, function(key, val) {
                                    
                                        genericnamesubclassoptions += `
                                        <option value="` + val.itemsubclass + `">` + val.itemsubclass + `</option>
                                        `
                                    })
                                    genericnameusagesubclasslist = genericnamesubclassoptions
                                    $("#selectusagesubclass").html(genericnamesubclassoptions)
                                    let searchItem = $("#searchitems").val()
                                    let selectsubclass = $("#selectusagesubclass").val()
                                    let GetGenericNameByUsageDRUGSSubClass = "GetGenericNameByUsageDRUGSSubClass"
                                    $.post("controllers/combo-setup.php",{searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByUsageDRUGSSubClass:GetGenericNameByUsageDRUGSSubClass},function(formdata){
                                        console.log(formdata)
                                        if(formdata!="No Record Found"){
                                            let data = JSON.parse(formdata)
                                            let genericnameoptions = ``
                                            deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                                            $.each(data.records, function(key, val) {
                                            
                                                genericnameoptions += `
                                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `(` + val.itemmanufacturer + `)</option>
                                                `
                                                deptitemgrpitems += `
                                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `</option>
                                                `
                                            })
                                            deptitemgrpitems += `</select>`
                                            genericnamelist = genericnameoptions
                                            $("#selectallitem").html(genericnameoptions)
                                            // let selectclass = $("#selectgenericnameitemgroupclass").val()
                                            let pricinglist = displayselectedlistitems + `<tr>
                                                    <td></td>
                                                    <td></td>
                                                    <td>` + deptitemgrpitems + `</td>
                                                    <td>
                                                            <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>`
                                            $("#view-revenue-order-list").html(pricinglist)
                                            $("#view-revenue-order-list-item").html(pricinglist)
                                            $("#view-revenue-order-list-lab").html(pricinglist)
                                            $("#selectdptitemgrpitem").on("change", function(evt){
                                                evt.preventDefault()
                                                let selecteditem = $("#selectdptitemgrpitem").val()
                                                selectitemanddisplay(selecteditem)
                                            })
                                            $(".additemtolist").on("click", function(evt){

                                                evt.preventDefault()
                                                let selecteditem = $("#selectdptitemgrpitem").val()
                                                selectitemanddisplay(selecteditem)
                                            })

                                        }
                                    
                                    })
                                })
                            })
                        }

                    })
                 })

                 //get the next prescription order number
                 function getnextprescriptionnumber(){
                     
                     let getNextPrescription = "getNextPrescription"
                     $.post("controllers/finance-record.php",{getNextPrescription:getNextPrescription},function(data){
                         console.log(data)
                         $("#nextprescriptionnumber").html(data)
                     })
                 }

                 getnextprescriptionnumber()
                 //Advanced Search
                 function loadPatientCards(){
                let loadPatientPards = "loadPatientPards"
                $.post("controllers/patient-record.php",{loadPatientPards: loadPatientPards},function(formdata){
                        console.log("prescription: ",formdata)
                        if(formdata=="No Record Found"){
                            $("#view-item-order-count").html(formdata)
                        }else{
                            data = JSON.parse(formdata)
                            allpatientcards = data.records
                            totalnumbercards = allpatientcards.length
                            totalfoundcards = totalnumbercards
                            let patientcardlist = `<option value='0'>Select Patient</option>`
                            let count = 0
                            console.log()
                            for(i=0;i<allpatientcards.length;i++){
                                    let status = allpatientcards[i].status
                                    
                                        count++
                                        patientcardlist += `
                                            <option value="` + allpatientcards[i].patientnumber + `">` + allpatientcards[i].person + ` [` + allpatientcards[i].status + `: ` + allpatientcards[i].cardnumber + `]</option>
                                        `

                                    
               
                                    // $("#paid").val(allpatientcards[i].status)
                            }
                                
                            totalfoundcards = count
                            $("#selectpatient").html(patientcardlist)
                            $("#card-status").html("Found " + totalfoundcards + " Cards Out of " + totalnumbercards + " Cards")
                            
                        }

                    })
                }

                let allpatientcards = []
                let totalnumbercards = 0
                let totalfoundcards = 0
                loadPatientCards()
                let itemregimentarray = []

                $("#default-weight, #laboratory-table, #item-order-table").hide()
                $("#form, #deptitemgroup, #group,#class,#subclass,#prescriptionnumber,#routinename,#add-regiment-button,#recall-itemorder-button").hide()
                $("#advancesearch").on("change", function(evt){
                    evt.preventDefault()
                    $("#searchitems").val("")
                    if($("#advancesearch").val()=="itemgrouping"){
                        searchAllItem = $("#selectorder").val()
                        $("#itemgrouping").show()
                        $("#add-allitem-button").show()
                        $("#form, #deptitemgroup, #group,#class,#subclass,#prescriptionnumber,#routinename,#add-regiment-button,#recall-itemorder-button").hide()
                    } else if($("#advancesearch").val()=="group"){
                        $("#group").show()
                        $("#add-allitem-button").show()
                        $("#form, #deptitemgroup, #itemgrouping,#class,#subclass,#prescriptionnumber,#routinename,#add-regiment-button,#recall-itemorder-button").hide()
                    } else if($("#advancesearch").val()=="class"){
                        $("#class").show()
                        $("#add-allitem-button").show()
                        $("#form, #deptitemgroup, #itemgrouping,#group,#subclass,#prescriptionnumber,#routinename,#add-regiment-button,#recall-itemorder-button").hide()

                        // get all classes
                        let selectgroup = $("#selectorder").val()
                            let getItemClassByDeptItemGroup = "getItemClassByDeptItemGroup"
                            $.post("controllers/combo-setup.php",{searchItem:selectgroup,getItemClassByDeptItemGroup:getItemClassByDeptItemGroup},function(formdata){
                                console.log(formdata)
                                let data = JSON.parse(formdata)
                                let genericnameclassoptions = ``
                                $.each(data.records, function(key, val) {
                                
                                    genericnameclassoptions += `
                                    <option value="` + val.itemclass + `">` + val.itemclass + `</option>
                                    `
                                })
                                genericnameusageclasslist = genericnameclassoptions
                                $("#selectusageclassclass").html(genericnameclassoptions)
                                let selectsubclassclass = $("#selectusageclassclass").val()
                                let getItemSubClassByClass = "getItemSubClassByClass"
                                $.post("controllers/combo-setup.php",{selectsubclassclass:selectsubclassclass,getItemSubClassByClass:getItemSubClassByClass},function(formdata){
                                    console.log(formdata)
                                    let data = JSON.parse(formdata)
                                    let genericnamesubclassoptions = `<option value="">Select Sub Class</option>`
                                    $.each(data.records, function(key, val) {
                                    
                                        genericnamesubclassoptions += `
                                        <option value="` + val.itemsubclass + `">` + val.itemsubclass + `</option>
                                        `
                                    })
                                    genericnameusagesubclasslist = genericnamesubclassoptions
                                    $("#selectusagesubclassclass").html(genericnamesubclassoptions)
                                    let searchItem = $("#searchitems").val()
                                    let selectsubclass = $("#selectusagesubclassclass").val()
                                    let GetGenericNameByUsageDeptItemGrpSubClass = "GetGenericNameByUsageDeptItemGrpSubClass"
                                    $.post("controllers/combo-setup.php",{departmentitemgroup:searchAllItem,searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByUsageDeptItemGrpSubClass:GetGenericNameByUsageDeptItemGrpSubClass},function(formdata){
                                        console.log(formdata)
                                        if(formdata!="No Record Found"){
                                            let data = JSON.parse(formdata)
                                            let genericnameoptions = ``
                                            deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                                            $.each(data.records, function(key, val) {
                                            
                                                genericnameoptions += `
                                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `(` + val.itemmanufacturer + `)</option>
                                                `
                                                deptitemgrpitems += `
                                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `</option>
                                                `
                                            })
                                            deptitemgrpitems += `</select>`
                                            console.log(deptitemgrpitems)
                                            genericnamelist = genericnameoptions
                                            $("#selectallitem").html(genericnameoptions)
                                            // let selectclass = $("#selectgenericnameitemgroupclass").val()
                                            let pricinglist = displayselectedlistitems + `<tr>
                                                        <td></td>
                                                        <td></td>
                                                        <td>` + deptitemgrpitems + `</td>
                                                        <td>
                                                                <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                    </tr>`
                                            $("#view-revenue-order-list").html(pricinglist)
                                            $("#view-revenue-order-list-item").html(pricinglist)
                                            $("#view-revenue-order-list-lab").html(pricinglist)
                                            $("#selectdptitemgrpitem").on("change", function(evt){
                                                evt.preventDefault()
                                                let selecteditem = $("#selectdptitemgrpitem").val()
                                                selectitemanddisplay(selecteditem)
                                            })
                                            $(".additemtolist").on("click", function(evt){

                                                evt.preventDefault()
                                                let selecteditem = $("#selectdptitemgrpitem").val()
                                                selectitemanddisplay(selecteditem)
                                            })
                                        }
                                    
                                    })
                                })
                            })
                    } else if($("#advancesearch").val()=="subclass"){
                        $("#subclass").show()
                        $("#add-allitem-button").show()
                        $("#form, #deptitemgroup, #itemgrouping,#group,#class,#prescriptionnumber,#routinename,#add-regiment-button,#recall-itemorder-button").hide()

                        // get all sub-classes
                        let selectgroup = $("#selectorder").val()
                           
                                let getItemSubClassByDeptItemGroup = "getItemSubClassByDeptItemGroup"
                                $.post("controllers/combo-setup.php",{selectsubclassclass:selectgroup,getItemSubClassByDeptItemGroup:getItemSubClassByDeptItemGroup},function(formdata){
                                    console.log(formdata)
                                    let data = JSON.parse(formdata)
                                    let genericnamesubclassoptions = ``
                                    $.each(data.records, function(key, val) {
                                    
                                        genericnamesubclassoptions += `
                                        <option value="` + val.itemsubclass + `">` + val.itemsubclass + `</option>
                                        `
                                    })
                                    genericnameusagesubclasslist = genericnamesubclassoptions
                                    $("#selectusagesubclasssubclass").html(genericnamesubclassoptions)
                                    let searchItem = $("#searchitems").val()
                                    let selectsubclass = $("#selectusagesubclasssubclass").val()
                                    let GetGenericNameByUsageDeptItemGrpSubClass = "GetGenericNameByUsageDeptItemGrpSubClass"
                                    $.post("controllers/combo-setup.php",{departmentitemgroup:searchAllItem,searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByUsageDeptItemGrpSubClass:GetGenericNameByUsageDeptItemGrpSubClass},function(formdata){
                                        console.log(formdata)
                                        if(formdata!="No Record Found"){
                                            let data = JSON.parse(formdata)
                                            let genericnameoptions = ``
                                            deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                                            $.each(data.records, function(key, val) {
                                            
                                                genericnameoptions += `
                                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `(` + val.itemmanufacturer + `)</option>
                                                `
                                                deptitemgrpitems += `
                                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `</option>
                                                `
                                            })
                                            deptitemgrpitems += `</select>`
                                            console.log(deptitemgrpitems)
                                            genericnamelist = genericnameoptions
                                            $("#selectallitem").html(genericnameoptions)
                                            // let selectclass = $("#selectgenericnameitemgroupclass").val()
                                            let pricinglist = displayselectedlistitems + `<tr>
                                                        <td></td>
                                                        <td></td>
                                                        <td>` + deptitemgrpitems + `</td>
                                                        <td>
                                                                <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                    </tr>`
                                            $("#view-revenue-order-list").html(pricinglist)
                                            $("#view-revenue-order-list-item").html(pricinglist)
                                            $("#view-revenue-order-list-lab").html(pricinglist)
                                            $("#selectdptitemgrpitem").on("change", function(evt){
                                                evt.preventDefault()
                                                let selecteditem = $("#selectdptitemgrpitem").val()
                                                selectitemanddisplay(selecteditem)
                                            })
                                            $(".additemtolist").on("click", function(evt){

                                                evt.preventDefault()
                                                let selecteditem = $("#selectdptitemgrpitem").val()
                                                selectitemanddisplay(selecteditem)
                                            })
                                        }
                                    
                                    })
                                })
                        
                    } else if($("#advancesearch").val()=="form"){
                        $("#form").show()
                        $("#add-allitem-button").show()
                        $("#subclass, #deptitemgroup, #itemgrouping,#group,#class,#prescriptionnumber,#routinename,#add-regiment-button,#recall-itemorder-button").hide()

                        // get all sub-classes
                        let selectgroup = $("#selectorder").val()
                           
                                let getFormByDeptItemGroup = "getFormByDeptItemGroup"
                                $.post("controllers/combo-setup.php",{selectsubclassclass:selectgroup,getFormByDeptItemGroup:getFormByDeptItemGroup},function(formdata){
                                    console.log(formdata)
                                    let data = JSON.parse(formdata)
                                    let genericnamesubclassoptions = ``
                                    $.each(data.records, function(key, val) {
                                    
                                        genericnamesubclassoptions += `
                                        <option value="` + val.itemform + `">` + val.itemform + `</option>
                                        `
                                    })
                                    // genericnameusagesubclasslist = genericnamesubclassoptions
                                    $("#selectform").html(genericnamesubclassoptions)
                                    let searchItem = $("#searchitems").val()
                                    let selectsubclass = $("#selectform").val()
                                    let GetGenericNameByFormDeptItemGrp = "GetGenericNameByFormDeptItemGrp"
                                    $.post("controllers/combo-setup.php",{departmentitemgroup:searchAllItem,searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByFormDeptItemGrp:GetGenericNameByFormDeptItemGrp},function(formdata){
                                        console.log(formdata)
                                        if(formdata!="No Record Found"){
                                            let data = JSON.parse(formdata)
                                            let genericnameoptions = ``
                                            deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                                            $.each(data.records, function(key, val) {
                                            
                                                genericnameoptions += `
                                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `(` + val.itemmanufacturer + `)</option>
                                                `
                                                deptitemgrpitems += `
                                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `</option>
                                                `
                                            })
                                            deptitemgrpitems += `</select>`
                                            console.log(deptitemgrpitems)
                                            genericnamelist = genericnameoptions
                                            $("#selectallitem").html(genericnameoptions)
                                            // let selectclass = $("#selectgenericnameitemgroupclass").val()
                                            let pricinglist = displayselectedlistitems + `<tr>
                                                        <td></td>
                                                        <td></td>
                                                        <td>` + deptitemgrpitems + `</td>
                                                        <td>
                                                                <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                    </tr>`
                                            $("#view-revenue-order-list").html(pricinglist)
                                            $("#view-revenue-order-list-item").html(pricinglist)
                                            $("#view-revenue-order-list-lab").html(pricinglist)
                                            $("#selectdptitemgrpitem").on("change", function(evt){
                                                evt.preventDefault()
                                                let selecteditem = $("#selectdptitemgrpitem").val()
                                                selectitemanddisplay(selecteditem)
                                            })
                                            $(".additemtolist").on("click", function(evt){

                                                evt.preventDefault()
                                                let selecteditem = $("#selectdptitemgrpitem").val()
                                                selectitemanddisplay(selecteditem)
                                            })
                                        }
                                    
                                    })
                                })
                        
                    } else if($("#advancesearch").val()=="prescriptionnumber"){
                        $("#prescriptionnumber").show()
                        $("#recall-itemorder-button").show()
                        $("#form, #deptitemgroup, #itemgrouping,#group,#subclass,#class,#routinename,#add-regiment-button,#add-allitem-button").hide()

                        let revenueorderid = $("#selectitemlist").val()
                    
                        patientrevenueorderlist.forEach(val => {
                        
                            if(revenueorderid==val.id){
                                let itemorder = val.itemorder
                                console.log(itemorder)
                                recallitems = JSON.parse(itemorder)
                                orderitemlist = recallitems
                                let itemlist = ``
                                let genericnameoptions = ``
                                deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`

                                recallitems.forEach(val => {
                                    itemlist += `<option value="` + val.itemid + `">` + val.genericname + ` (` + val.sellingprice + `)</option>`

                                    genericnameoptions += `
                                    <option value="` + val.itemid + `,` + val.genericname + `">` + value.genericname + `</option>
                                    `
                                    deptitemgrpitems += `
                                    <option value="` + val.itemid + `,` + val.genericname+ `">` + value.genericname + `</option>
                                    `
                                })
                                // $("#selectitemlist").html(itemlist)
                                deptitemgrpitems += `</select>`
                                genericnamelist = genericnameoptions
                                $("#selectallitem").html(genericnameoptions)

                                let pricinglist = displayselectedlistitems + `<tr>
                                            <td></td>
                                            <td></td>
                                            <td>` + deptitemgrpitems + `</td>
                                            <td>
                                                    <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                        </tr>`
                                $("#view-revenue-order-list").html(pricinglist)
                                $("#view-revenue-order-list-item").html(pricinglist)
                                $("#view-revenue-order-list-lab").html(pricinglist)
                                $("#selectdptitemgrpitem").on("change", function(evt){
                                    evt.preventDefault()
                                    let selecteditem = $("#selectdptitemgrpitem").val()
                                    selectitemanddisplay(selecteditem)
                                })
                                $(".additemtolist").on("click", function(evt){

                                    evt.preventDefault()
                                    let selecteditem = $("#selectdptitemgrpitem").val()
                                    selectitemanddisplay(selecteditem)
                                })
                            }
                        
                        });
                    } else if($("#advancesearch").val()=="routinename"){
                        $("#routinename").show()
                        $("#add-regiment-button").show()
                        $("#form, #deptitemgroup, #itemgrouping,#group,#subclass,#prescriptionnumber,#class,#add-allitem-button,#recall-itemorder-button").hide()

                        let getItemRegiment = "getItemRegiment"
                        $.post("controllers/combo-setup.php",{getItemRegiment:getItemRegiment},function(data){
                            if(data!="No Record Found"){
                                // console.log(data)
                                let formdata = JSON.parse(data)
                                itemregimentarray = formdata.records
                                let itemregimentlist = ``
                                formdata.records.forEach(val => {
                                    itemregimentlist += `<option value="` + val.id + `,` + val.regimentname + `">` + val.regimentname + `</option>`
                                });
                                $("#selectregiment").html(itemregimentlist)

                                let regimentname = $("#selectregiment").val()
                                let splitregimentname = regimentname.split(",")
                                regimentname = splitregimentname[1]
                                itemregimentarray.forEach(val => {
                                    if(regimentname == val.regimentname){
                                        console.log(val.regiment)
                                        let regimentlist = JSON.parse(val.regiment)
                                        combinedpricingvaluearray = regimentlist

                                        let genericnameoptions = ``
                                        deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`

                                        let regimentlistitems = ``
                                        let count = 0
                                        regimentlist.forEach(value => {
                                            regimentlistitems += `<option value="` + count + `,` + value.itemid + `">` + value.itemname + `</option>`

                                            genericnameoptions += `
                                            <option value="` + value.itemid + `,` + value.itemname + `">` + value.itemname + `</option>
                                            `
                                            deptitemgrpitems += `
                                            <option value="` + value.itemid + `,` + value.itemname+ `">` + value.itemname + `</option>
                                            `
                                             count++
                                        });
                                        // $("#itemregimentslist").html(regimentlistitems)
                                        deptitemgrpitems += `</select>`

                                        genericnamelist = genericnameoptions
                                        $("#selectallitem").html(genericnameoptions)

                                        let pricinglist = displayselectedlistitems + `<tr>
                                                    <td></td>
                                                    <td></td>
                                                    <td>` + deptitemgrpitems + `</td>
                                                    <td>
                                                            <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>`
                                        $("#view-revenue-order-list").html(pricinglist)
                                        $("#view-revenue-order-list-item").html(pricinglist)
                                        $("#view-revenue-order-list-lab").html(pricinglist)
                                        $("#selectdptitemgrpitem").on("change", function(evt){
                                            evt.preventDefault()
                                            let selecteditem = $("#selectdptitemgrpitem").val()
                                            selectitemanddisplay(selecteditem)
                                        })
                                        $(".additemtolist").on("click", function(evt){

                                            evt.preventDefault()
                                            let selecteditem = $("#selectdptitemgrpitem").val()
                                            selectitemanddisplay(selecteditem)
                                        })

                                        combinedpricingvaluearray = []
                                    }
                                });

                            }
                        })
                    } else if($("#advancesearch").val()=="deptitemgroup"){
                        $("#deptitemgroup").show()
                        $("#add-allitem-button").show()
                        $("#form, #routinename, #itemgrouping,#group,#subclass,#prescriptionnumber,#class,#add-regiment-button,#recall-itemorder-button").hide()
                    }
                })

                $("#selectform").on("change", function(evt){
                    let searchItem = $("#searchitems").val()
                    let selectsubclass = $("#selectform").val()
                    let GetGenericNameByFormDeptItemGrp = "GetGenericNameByFormDeptItemGrp"
                    $.post("controllers/combo-setup.php",{departmentitemgroup:searchAllItem,searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByFormDeptItemGrp:GetGenericNameByFormDeptItemGrp},function(formdata){
                        console.log(formdata)
                        if(formdata!="No Record Found"){
                            let data = JSON.parse(formdata)
                            let genericnameoptions = ``
                            deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                            $.each(data.records, function(key, val) {
                            
                                genericnameoptions += `
                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `(` + val.itemmanufacturer + `)</option>
                                `
                                deptitemgrpitems += `
                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `</option>
                                `
                            })
                            deptitemgrpitems += `</select>`
                            console.log(deptitemgrpitems)
                            genericnamelist = genericnameoptions
                            $("#selectallitem").html(genericnameoptions)
                            // let selectclass = $("#selectgenericnameitemgroupclass").val()
                            let pricinglist = displayselectedlistitems + `<tr>
                                        <td></td>
                                        <td></td>
                                        <td>` + deptitemgrpitems + `</td>
                                        <td>
                                                <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>`
                            $("#view-revenue-order-list").html(pricinglist)
                            $("#view-revenue-order-list-item").html(pricinglist)
                            $("#view-revenue-order-list-lab").html(pricinglist)
                            $("#selectdptitemgrpitem").on("change", function(evt){
                                evt.preventDefault()
                                let selecteditem = $("#selectdptitemgrpitem").val()
                                selectitemanddisplay(selecteditem)
                            })
                            $(".additemtolist").on("click", function(evt){

                                evt.preventDefault()
                                let selecteditem = $("#selectdptitemgrpitem").val()
                                selectitemanddisplay(selecteditem)
                            })
                        }
                    
                    })
                })

                $("#selectregiment").on("change", function(evt){
                    evt.preventDefault()
                    let regimentname = $("#selectregiment").val()
                    let splitregimentname = regimentname.split(",")
                    regimentname = splitregimentname[1]
                    itemregimentarray.forEach(val => {
                        if(regimentname == val.regimentname){
                            console.log(val.regiment)
                            let regimentlist = JSON.parse(val.regiment)
                            combinedpricingvaluearray = regimentlist

                            let genericnameoptions = ``
                            deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`

                            let regimentlistitems = ``
                            let count = 0
                            regimentlist.forEach(value => {
                                regimentlistitems += `<option value="` + count + `,` + value.itemid + `">` + value.itemname + `</option>`

                                genericnameoptions += `
                                <option value="` + value.itemid + `,` + value.itemname + `">` + value.itemname + `</option>
                                `
                                deptitemgrpitems += `
                                <option value="` + value.itemid + `,` + value.itemname+ `">` + value.itemname + `</option>
                                `
                                    count++
                            });
                            // $("#itemregimentslist").html(regimentlistitems)
                            deptitemgrpitems += `</select>`

                            genericnamelist = genericnameoptions
                            $("#selectallitem").html(genericnameoptions)

                            let pricinglist = displayselectedlistitems + `<tr>
                                        <td></td>
                                        <td></td>
                                        <td>` + deptitemgrpitems + `</td>
                                        <td>
                                                <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>`
                            $("#view-revenue-order-list").html(pricinglist)
                            $("#view-revenue-order-list-item").html(pricinglist)
                            $("#view-revenue-order-list-lab").html(pricinglist)
                            $("#selectdptitemgrpitem").on("change", function(evt){
                                evt.preventDefault()
                                let selecteditem = $("#selectdptitemgrpitem").val()
                                selectitemanddisplay(selecteditem)
                            })
                            $(".additemtolist").on("click", function(evt){

                                evt.preventDefault()
                                let selecteditem = $("#selectdptitemgrpitem").val()
                                selectitemanddisplay(selecteditem)
                            })

                            combinedpricingvaluearray = []
                        }
                    });
                })

                $("#searchregiment").on('change keyup paste', function () {
                    let getItemRegimentBySearch = "getItemRegimentBySearch"
                    let searchregiment = $("#searchregiment").val()
                    $.post("controllers/combo-setup.php",{searchregiment:searchregiment,getItemRegimentBySearch:getItemRegimentBySearch},function(data){
                        if(data!="No Record Found"){
                            // console.log(data)
                            let formdata = JSON.parse(data)
                            itemregimentarray = formdata.records
                            let itemregimentlist = ``
                            formdata.records.forEach(val => {
                                itemregimentlist += `<option value="` + val.id + `,` + val.regimentname + `">` + val.regimentname + `</option>`
                            });
                            $("#selectregiment").html(itemregimentlist)

                            let regimentname = $("#selectregiment").val()
                            let splitregimentname = regimentname.split(",")
                            regimentname = splitregimentname[1]
                            itemregimentarray.forEach(val => {
                                if(regimentname == val.regimentname){
                                    console.log(val.regiment)
                                    let regimentlist = JSON.parse(val.regiment)
                                    combinedpricingvaluearray = regimentlist

                                    let genericnameoptions = ``
                                    deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`

                                    let regimentlistitems = ``
                                    let count = 0
                                    regimentlist.forEach(value => {
                                        regimentlistitems += `<option value="` + count + `,` + value.itemid + `">` + value.itemname + `</option>`

                                        genericnameoptions += `
                                        <option value="` + value.itemid + `,` + value.itemname + `">` + value.itemname + `</option>
                                        `
                                        deptitemgrpitems += `
                                        <option value="` + value.itemid + `,` + value.itemname+ `">` + value.itemname + `</option>
                                        `
                                            count++
                                    });
                                    // $("#itemregimentslist").html(regimentlistitems)
                                    deptitemgrpitems += `</select>`

                                    genericnamelist = genericnameoptions
                                    $("#selectallitem").html(genericnameoptions)

                                    let pricinglist = displayselectedlistitems + `<tr>
                                                <td></td>
                                                <td></td>
                                                <td>` + deptitemgrpitems + `</td>
                                                <td>
                                                        <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                            </tr>`
                                    $("#view-revenue-order-list").html(pricinglist)
                                    $("#view-revenue-order-list-item").html(pricinglist)
                                    $("#view-revenue-order-list-lab").html(pricinglist)
                                    $("#selectdptitemgrpitem").on("change", function(evt){
                                        evt.preventDefault()
                                        let selecteditem = $("#selectdptitemgrpitem").val()
                                        selectitemanddisplay(selecteditem)
                                    })
                                    $(".additemtolist").on("click", function(evt){

                                        evt.preventDefault()
                                        let selecteditem = $("#selectdptitemgrpitem").val()
                                        selectitemanddisplay(selecteditem)
                                    })

                                    combinedpricingvaluearray = []
                                }
                            });

                        }
                    })
                    
                });

                
                $("#searchpatient").on('change keyup paste', function () {
                    ApplyFilterGetPatient();
                });

                function ApplyFilterGetPatient() {
                    var searchitemservice = $("#searchpatient").val();
                    console.log("getPatientCards")
                    getPatientCards()
                }

                function getPatientCards(){
                    
                    // $("#viewrevenueordernumber").html("New Prescription Order")
                    let searchItem = $("#searchpatient").val()
                    
                    let count = 0
                    $("#selectpatient").html("")
                    $("#form-edit-patient").html("")
                    $("#form-view-patientstatus").html("")
                    $("#form-view-patient").html("")
                    recallprescriptionlist = []
                    $("#selectprescription").hide()
                    let patientcardlist = `<option value='0'>Select Patient</option>`
                    for(i=0;i<allpatientcards.length;i++){
                        console.log(allpatientcards[i].person)
                        
                        if(allpatientcards[i].person.includes(searchItem) || allpatientcards[i].cardnumber.includes(searchItem) || allpatientcards[i].patientnumber.includes(searchItem)){
                            count++
                            console.log(searchItem)
                            patientcardlist += `
                                <option value="` + allpatientcards[i].patientnumber + `" selected>` + allpatientcards[i].person + ` [` + allpatientcards[i].status + `: ` + allpatientcards[i].cardnumber + `]</option>
                            `
                            
                        }
                    }
                    
                    if(count>0){
                        totalfoundcards = count
                        $("#selectpatient").html(patientcardlist)
                        $("#card-status").html("Found " + totalfoundcards + " Cards Out of " + totalnumbercards + " Cards")
                        let id = $("#selectpatient").val()
                        getPatientCardId(id)
                    } else {
                        $("#card-status").html("Found " + count + " Cards Out of " + totalnumbercards + " Cards")
                    }
                }

                $("#searchprescription").on("change keyup paste", function(){
                    // evt.preventDefault()
                    let id = $(this).val()
                   
                    let searchprescription = $("#searchprescription").val()
                    let getPatientPrescriptionItemOrdersSearch = "getPatientPrescriptionItemOrdersSearch"
                        let patientid = data.patientid
                        $.post("controllers/patient-record.php",{id:searchprescription,getPatientPrescriptionItemOrdersSearch: getPatientPrescriptionItemOrdersSearch},function(orderformdata){
                            console.log(orderformdata)
                            let patientitemorderlist = `<option value="">Select Order</option>`
                            let orderdata = JSON.parse(orderformdata)
                            patientrevenueorderlist = []
                            orderdata.records.forEach(val => {
                                patientitemorderlist += `<option value="` + val.id + `">` + val.revenueordernumber + ` (` + val.status + `: ` + val.totalamount + val.itemorderdate + `)</option>`
                                patientrevenueorderlist.push(val)
                            });
                            $("#selectitemlist").html(patientitemorderlist)

                            let itemorder = patientrevenueorderlist[0].itemorder
                            console.log(itemorder)
                            let recallitems = JSON.parse(itemorder)
                            orderitemlist = recallitems
                            let itemlist = ``
                            recallitems.forEach(val => {
                                itemlist += `<option value="` + val.itemid + `,` + val.genericname + `">` + val.genericname + ` (` + val.sellingprice + `)</option>`

                            })
                            // $("#selectitemlist").html(itemlist)
                        })
                })

                $("#prescriptionview").on("change", function(evt){
                    evt.preventDefault()
                    let prescriptionview = $("#prescriptionview").val()
                    if(prescriptionview=="Age"){
                        $("#default-age-group").show()
                        $("#default-weight").hide()
                    } else if(prescriptionview=="Weight"){
                        $("#default-weight").show()
                        $("#default-age-group").hide()
                    } else {
                        $("#default-weight").hide()
                        $("#default-age-group").hide()
                    }
                })


                $("#selectpatient").on("change", function(evt){
                    evt.preventDefault()
                    let id = $(this).val()
                    console.log(id)
                    
                    
                    getPatientCardId(id)
                })

                let patientrevenueorderlist = []
                let orderitemlist = []

                function getPatientCardId(id){
                    recallprescriptionlist = []
                    $("#selectprescription").hide()
                    let getPatientInfoByPatientNumber = "getPatientInfoByPatientNumber"
                    $.post("controllers/patient-record.php",{id:id,getPatientInfoByPatientNumber: getPatientInfoByPatientNumber},function(formdata){
                        // console.log(formdata)
                       
                       
                        let data = JSON.parse(formdata)
                        let patienttype = data.patienttype
                        if(patienttype=="PAID AND REGISTERED"){
                            $("#paid").val("PAID")
                        } else {
                            $("#paid").val("NOT PAID")
                        }
                        $("#form-edit-patient").html("Patient Number: " + id + "<br>Card Number: " + data.cardnumber + "<br>Card Type: " + data.cardtype)
                        $("#form-view-patientstatus").html("Patient Type: " + data.patienttype + "<br>Patient Status: " + data.patientstatus)
                        $("#form-view-patient").html("Registered: " + data.entereddate + "<br>By: " + data.enteredby + "<br>Updated: " + data.updateddate)
                        let personid = data.personid
                        $("#selectpatientnumber").val(id)
                        $("#patientid").val(data.patientid)
                        $("#patientname").val(data.person)
                        console.log($("#patientname").val())
                        $("#personid").val(data.personid)
                        $("#patientweight").val(data.weight)
                        $("#patientgender").val(data.gender)
                        $("#agegroup").val(data.agegroup)


                        $("#form-patientinfo-age").html(data.age)
                        $("#form-patientinfo-hospitalno").html(data.patientnumber)
                        $("#form-patientinfo-sex").html(data.gender)
                        $("#form-patientinfo-weight").html(data.weight)
                        // console.log(data.age,data.gender,data.weight)

                        //get item orders
                        let getPatientPrescriptionItemOrders = "getPatientPrescriptionItemOrders"
                        let patientid = data.patientid
                        $.post("controllers/patient-record.php",{id:patientid,getPatientPrescriptionItemOrders: getPatientPrescriptionItemOrders},function(orderformdata){
                            console.log(orderformdata)
                            let patientitemorderlist = `<option value="">Select Order</option>`
                            let orderdata = JSON.parse(orderformdata)
                            patientrevenueorderlist = []
                            orderdata.records.forEach(val => {
                                patientitemorderlist += `<option value="` + val.id + `">` + val.revenueordernumber + ` (` + val.status + `: ` + val.totalamount + val.itemorderdate + `)</option>`
                                patientrevenueorderlist.push(val)
                            });
                            $("#selectitemlist").html(patientitemorderlist)

                            let itemorder = patientrevenueorderlist[0].itemorder
                            console.log(itemorder)
                            let recallitems = JSON.parse(itemorder)
                            orderitemlist = recallitems
                            let itemlist = ``
                            recallitems.forEach(val => {
                                itemlist += `<option value="` + val.itemid + `,` + val.genericname + `">` + val.genericname + ` (` + val.sellingprice + `)</option>`

                            })
                            // $("#selectitemlist").html(itemlist)
                        })
                       
                    })
                }


                $("#selectitemorder").on("change", function(evt){
                    evt.preventDefault()
                    let revenueorderid = $("#selectitemorder").val()
                    
                    patientrevenueorderlist.forEach(val => {
                       
                        if(revenueorderid==val.id){
                            let itemorder = val.itemorder
                            recallitems = JSON.parse(itemorder)
                            orderitemlist = recallitems
                            let itemlist = ``
                            recallitems.forEach(val => {
                                itemlist += `<option value="` + val.itemid + `">` + val.genericname + ` (` + val.sellingprice + `)</option>`

                            })
                            $("#selectitemlist").html(itemlist)
                        }
                    
                    });

                })

                $("#selectitemlist").on("change", function(evt){
                    evt.preventDefault()
                    let revenueorderid = $("#selectitemlist").val()
                    
                    patientrevenueorderlist.forEach(val => {
                       
                        if(revenueorderid==val.id){
                            let itemorder = val.itemorder
                            console.log(itemorder)
                            recallitems = JSON.parse(itemorder)
                            orderitemlist = recallitems
                            let itemlist = ``
                            let genericnameoptions = ``
                            deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`

                            recallitems.forEach(val => {
                                itemlist += `<option value="` + val.itemid + `">` + val.genericname + ` (` + val.sellingprice + `)</option>`

                                genericnameoptions += `
                                <option value="` + val.itemid + `,` + val.genericname + `">` + val.genericname + `</option>
                                `
                                deptitemgrpitems += `
                                <option value="` + val.itemid + `,` + val.genericname+ `">` + val.genericname + `</option>
                                `
                            })
                            // $("#selectitemlist").html(itemlist)
                            deptitemgrpitems += `</select>`
                            genericnamelist = genericnameoptions
                            $("#selectallitem").html(genericnameoptions)

                            let pricinglist = displayselectedlistitems + `<tr>
                                        <td></td>
                                        <td></td>
                                        <td>` + deptitemgrpitems + `</td>
                                        <td>
                                                <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>`
                            $("#view-revenue-order-list").html(pricinglist)
                            $("#view-revenue-order-list-item").html(pricinglist)
                            $("#view-revenue-order-list-lab").html(pricinglist)
                            $("#selectdptitemgrpitem").on("change", function(evt){
                                evt.preventDefault()
                                let selecteditem = $("#selectdptitemgrpitem").val()
                                selectitemanddisplay(selecteditem)
                            })
                            $(".additemtolist").on("click", function(evt){

                                evt.preventDefault()
                                let selecteditem = $("#selectdptitemgrpitem").val()
                                selectitemanddisplay(selecteditem)
                            })
                        }
                    });

                })


                let getItemGroupByLikeDeptItemGroup = "getItemGroupByLikeDeptItemGroup"
                let genericnameusagegrouplist = ``
                let genericnameusageclasslist = ``
                let genericnameusagesubclasslist = ``
                let genericnamedepartmentitemgrouplist = ``
                let genericnamelist = ``

                //get departmentitemgroups
                let getDepartmentItemGroup = "getDepartmentItemGroup"
                searchItem = $("#selectorder").val()
                $.post("controllers/combo-setup.php",{searchItem:searchItem,getDepartmentItemGroup: getDepartmentItemGroup},function(formdata){
                     console.log(formdata)
                    if(formdata!="No Record Found"){
                        
                        let data=JSON.parse(formdata)
                        let usagegroupoptions = `<option value="">Select Item Group</option>`
                        $.each(data.records, function(key, val) {
                        
                            usagegroupoptions += `
                            <option value="` + val.departmentitemgroup + `">` + val.departmentitemgroup + `</option>
                        `
                        })
                        genericnamedepartmentitemgrouplist = usagegroupoptions
                        $("#selectdepartmentitemgrouping").html(usagegroupoptions)
                        //$("#selectformdepartmentitemgroup").html(departmentitemgroupoptions)
                       
                    }
                })

//                 $("#selectdepartmentitemgrouping").on("change", function(evt){
//                     evt.preventDefault()
//                     searchAllItem = $("#selectdepartmentitemgrouping").val()
//                     // splitsearch = searchItem.split(",")
//                     // searchItem = splitsearch[0]
//                     // console.log(searchItem)
//                     $.post("controllers/combo-setup.php",{departmentitemgroup:searchAllItem,getItemGroupByLikeDeptItemGroup: getItemGroupByLikeDeptItemGroup},function(formdata){
//                         console.log(formdata)
//                         if(formdata!="No Record Found"){
//                             
//                             let data=JSON.parse(formdata)
//                             let usagegroupoptions = ``
//                             $.each(data.records, function(key, val) {
//                             
//                                 usagegroupoptions += `
//                                 <option value="` + val.itemgroup + `">` + val.itemgroup + `</option>
//                             `
//                             })
//                             genericnameusagegrouplist = usagegroupoptions
//                             $("#selectusagegroup").html(usagegroupoptions)
//                             //$("#selectformdepartmentitemgroup").html(departmentitemgroupoptions)
//                             let selectgroup = $("#selectusagegroup").val()
//                             let getItemClassByItemGroup = "getItemClassByItemGroup"
//                             $.post("controllers/combo-setup.php",{searchItem:selectgroup,getItemClassByItemGroup:getItemClassByItemGroup},function(formdata){
//                                 console.log(formdata)
//                                 let data = JSON.parse(formdata)
//                                 let genericnameclassoptions = ``
//                                 $.each(data.records, function(key, val) {
//                                 
//                                     genericnameclassoptions += `
//                                     <option value="` + val.itemclass + `">` + val.itemclass + `</option>
//                                     `
//                                 })
//                                 genericnameusageclasslist = genericnameclassoptions
//                                 $("#selectusageclass").html(genericnameclassoptions)
//                                 let selectsubclassclass = $("#selectusageclass").val()
//                                 let getItemSubClassByClass = "getItemSubClassByClass"
//                                 $.post("controllers/combo-setup.php",{selectsubclassclass:selectsubclassclass,getItemSubClassByClass:getItemSubClassByClass},function(formdata){
//                                     console.log(formdata)
//                                     let data = JSON.parse(formdata)
//                                     let genericnamesubclassoptions = `<option value="">Select Sub Class</option>`
//                                     $.each(data.records, function(key, val) {
//                                     
//                                         genericnamesubclassoptions += `
//                                         <option value="` + val.itemsubclass + `">` + val.itemsubclass + `</option>
//                                         `
//                                     })
//                                     genericnameusagesubclasslist = genericnamesubclassoptions
//                                     $("#selectusagesubclass").html(genericnamesubclassoptions)
//                                     let searchItem = $("#searchitems").val()
//                                     let selectsubclass = $("#selectusagesubclass").val()
//                                     let GetGenericNameByUsageDRUGSSubClass = "GetGenericNameByUsageDRUGSSubClass"
//                                     $.post("controllers/combo-setup.php",{searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByUsageDRUGSSubClass:GetGenericNameByUsageDRUGSSubClass},function(formdata){
//                                         console.log(formdata)
//                                         if(formdata!="No Record Found"){
//                                             let data = JSON.parse(formdata)
//                                             let genericnameoptions = ``
//                                             deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
//                                             $.each(data.records, function(key, val) {
//                                             
//                                                 genericnameoptions += `
//                                                 <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `(` + val.itemmanufacturer + `)</option>
//                                                 `
//                                                 deptitemgrpitems += `
//                                                 <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `</option>
//                                                 `
//                                             })
//                                             deptitemgrpitems += `</select>`
//                                             console.log(deptitemgrpitems)
//                                             genericnamelist = genericnameoptions
//                                             $("#selectallitem").html(genericnameoptions)
//                                             // let selectclass = $("#selectgenericnameitemgroupclass").val()
//                                             let pricinglist = displayselectedlistitems + `<tr>
//                                                         <td></td>
//                                                         <td>` + deptitemgrpitems + `</td>
//                                                         <td></td>
//                                                         <td></td>
//                                                         <td></td>
//                                                         <td></td>
//                                                         <td></td>
//                                                         <td>
//                                                                 <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
//                                                     </tr>`
//                                             $("#view-revenue-order-list").html(pricinglist)
// 
//                                             $("#selectdptitemgrpitem").on("change", function(evt){
//                                                 evt.preventDefault()
//                                                 let selecteditem = $("#selectdptitemgrpitem").val()
//                                                 selectitemanddisplay(selecteditem)
//                                             })
//                                             $(".additemtolist").on("click", function(evt){
// 
//                                                 evt.preventDefault()
//                                                 let selecteditem = $("#selectdptitemgrpitem").val()
//                                                 selectitemanddisplay(selecteditem)
//                                             })
//                                         }
//                                     
//                                     })
//                                 })
//                             })
//                         }
//                     })
//                 })

                searchAllItem = $("#selectorder").val()
                // splitsearch = searchItem.split(",")
                // searchItem = splitsearch[0]
                // console.log(searchItem)
                $.post("controllers/combo-setup.php",{departmentitemgroup:searchAllItem,getItemGroupByLikeDeptItemGroup: getItemGroupByLikeDeptItemGroup},function(formdata){
                     console.log(formdata)
                    if(formdata!="No Record Found"){
                        
                        let data=JSON.parse(formdata)
                        let usagegroupoptions = ``
                        $.each(data.records, function(key, val) {
                        
                            usagegroupoptions += `
                            <option value="` + val.itemgroup + `">` + val.itemgroup + `</option>
                        `
                        })
                        genericnameusagegrouplist = usagegroupoptions
                        $("#selectusagegroup").html(usagegroupoptions)
                        $("#selectusagegroupgroup").html(usagegroupoptions)
                        //$("#selectformdepartmentitemgroup").html(departmentitemgroupoptions)
                        let selectgroup = $("#selectusagegroup").val()
                        let getItemClassByItemGroup = "getItemClassByItemGroup"
                        $.post("controllers/combo-setup.php",{searchItem:selectgroup,getItemClassByItemGroup:getItemClassByItemGroup},function(formdata){
                            console.log(formdata)
                            let data = JSON.parse(formdata)
                            let genericnameclassoptions = ``
                            $.each(data.records, function(key, val) {
                            
                                genericnameclassoptions += `
                                <option value="` + val.itemclass + `">` + val.itemclass + `</option>
                                `
                            })
                            genericnameusageclasslist = genericnameclassoptions
                            $("#selectusageclass").html(genericnameclassoptions)
                            $("#selectusageclassgroup").html(genericnameclassoptions)
                            let selectsubclassclass = $("#selectusageclass").val()
                            let getItemSubClassByClass = "getItemSubClassByClass"
                            $.post("controllers/combo-setup.php",{selectsubclassclass:selectsubclassclass,getItemSubClassByClass:getItemSubClassByClass},function(formdata){
                                console.log(formdata)
                                let data = JSON.parse(formdata)
                                let genericnamesubclassoptions = `<option value="">Select Sub Class</option>`
                                $.each(data.records, function(key, val) {
                                
                                    genericnamesubclassoptions += `
                                    <option value="` + val.itemsubclass + `">` + val.itemsubclass + `</option>
                                    `
                                })
                                genericnameusagesubclasslist = genericnamesubclassoptions
                                $("#selectusagesubclass").html(genericnamesubclassoptions)
                                $("#selectusagesubclassgroup").html(genericnamesubclassoptions)
                                let searchItem = $("#searchitems").val()
                                let selectsubclass = $("#selectusagesubclass").val()
                                let GetGenericNameByUsageDRUGSSubClass = "GetGenericNameByUsageDRUGSSubClass"
                                $.post("controllers/combo-setup.php",{searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByUsageDRUGSSubClass:GetGenericNameByUsageDRUGSSubClass},function(formdata){
                                    console.log(formdata)
                                    if(formdata!="No Record Found"){
                                         let data = JSON.parse(formdata)
                                        let genericnameoptions = ``
                                        deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                                        $.each(data.records, function(key, val) {
                                        
                                            genericnameoptions += `
                                            <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `(` + val.itemmanufacturer + `)</option>
                                            `
                                            deptitemgrpitems += `
                                            <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `</option>
                                            `
                                        })
                                        deptitemgrpitems += `</select>`
                                        console.log(deptitemgrpitems)
                                        genericnamelist = genericnameoptions
                                        $("#selectallitem").html(genericnameoptions)
                                        // let selectclass = $("#selectgenericnameitemgroupclass").val()
                                        let pricinglist = displayselectedlistitems + `<tr>
                                                    <td></td>
                                                    <td></td>
                                                    <td>` + deptitemgrpitems + `</td>
                                                    <td>
                                                            <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>`
                                        $("#view-revenue-order-list").html(pricinglist)
                                        $("#view-revenue-order-list-item").html(pricinglist)
                                        $("#view-revenue-order-list-lab").html(pricinglist)
                                        $("#selectdptitemgrpitem").on("change", function(evt){
                                            evt.preventDefault()
                                            let selecteditem = $("#selectdptitemgrpitem").val()
                                            selectitemanddisplay(selecteditem)
                                        })
                                        $(".additemtolist").on("click", function(evt){

                                            evt.preventDefault()
                                            let selecteditem = $("#selectdptitemgrpitem").val()
                                            selectitemanddisplay(selecteditem)
                                        })
                                    }
                                   
                                })
                            })
                        })
                    }
                })

                $("#selectorder").on("change", function(evt){
                    let getItemGroupByLikeDeptItemGroup = "getItemGroupByLikeDeptItemGroup"
                    let genericnameusagegrouplist = ``
                    let genericnameusageclasslist = ``
                    let genericnameusagesubclasslist = ``
                    let genericnamelist = ``

                    searchAllItem = $("#selectorder").val()
                    if(searchAllItem==="DRUGS"){
                        $("#prescription-by-group, #prescription-table").show()
                        $("#item-order-table, #laboratory-table").hide()
                        let prescriptionview = $("#prescriptionview").val()
                        if(prescriptionview=="Age"){
                            $("#default-age-group").show()
                            $("#default-weight").hide()
                        } else if(prescriptionview=="Weight"){
                            $("#default-weight").show()
                            $("#default-age-group").hide()
                        } else {
                            $("#default-weight").hide()
                            $("#default-age-group").hide()
                        }
                    } else if(searchAllItem=="LAB "){
                        $("#laboratory-table").show()
                        $("#item-order-table, #prescription-table, #prescription-by-group").hide()
                        $("#default-age-group").hide()
                        $("#default-weight").hide()
                    } else if(searchAllItem==""){
                        $("#item-order-table").show()
                        $("#laboratory-table, #prescription-table, #prescription-by-group").hide()
                        $("#default-age-group").hide()
                        $("#default-weight").hide()
                    } else {
                        $("#prescription-by-group").hide()
                        $("#default-age-group").hide()
                        $("#default-weight").hide()
                    }
                    // splitsearch = searchItem.split(",")
                    // searchItem = splitsearch[0]
                    // console.log(searchAllItem)
                    //get departmentitemgroups
                    let getDepartmentItemGroup = "getDepartmentItemGroup"
                    searchItem = $("#selectorder").val()
                    $.post("controllers/combo-setup.php",{searchItem:searchItem,getDepartmentItemGroup: getDepartmentItemGroup},function(formdata){
                        console.log(formdata)
                        if(formdata!="No Record Found"){
                            
                            let data=JSON.parse(formdata)
                            let usagegroupoptions = `<option value="">Select Item Group</option>`
                            $.each(data.records, function(key, val) {
                            
                                usagegroupoptions += `
                                <option value="` + val.departmentitemgroup + `">` + val.departmentitemgroup + `</option>
                            `
                            })
                            genericnamedepartmentitemgrouplist = usagegroupoptions
                            $("#selectdepartmentitemgrouping").html(usagegroupoptions)
                            //$("#selectformdepartmentitemgroup").html(departmentitemgroupoptions)
                        
                        }
                    })

                    let selectgroup = $("#selectorder").val()
                    let getItemClassByDeptItemGroup = "getItemClassByDeptItemGroup"
                    $.post("controllers/combo-setup.php",{searchItem:selectgroup,getItemClassByDeptItemGroup:getItemClassByDeptItemGroup},function(formdata){
                        console.log(formdata)
                        let data = JSON.parse(formdata)
                        let genericnameclassoptions = ``
                        $.each(data.records, function(key, val) {
                        
                            genericnameclassoptions += `
                            <option value="` + val.itemclass + `">` + val.itemclass + `</option>
                            `
                        })
                        genericnameusageclasslist = genericnameclassoptions
                        $("#selectusageclassclass").html(genericnameclassoptions)
                        let selectsubclassclass = $("#selectusageclassclass").val()
                        let getItemSubClassByClass = "getItemSubClassByClass"
                        $.post("controllers/combo-setup.php",{selectsubclassclass:selectsubclassclass,getItemSubClassByClass:getItemSubClassByClass},function(formdata){
                            console.log(formdata)
                            let data = JSON.parse(formdata)
                            let genericnamesubclassoptions = `<option value="">Select Sub Class</option>`
                            $.each(data.records, function(key, val) {
                            
                                genericnamesubclassoptions += `
                                <option value="` + val.itemsubclass + `">` + val.itemsubclass + `</option>
                                `
                            })
                            genericnameusagesubclasslist = genericnamesubclassoptions
                            $("#selectusagesubclassclass").html(genericnamesubclassoptions)
                            
                        })
                    })

                    // get all sub-classes
                    // let selectgroup = $("#selectorder").val()
                    
                    let getItemSubClassByDeptItemGroup = "getItemSubClassByDeptItemGroup"
                    $.post("controllers/combo-setup.php",{selectsubclassclass:selectgroup,getItemSubClassByDeptItemGroup:getItemSubClassByDeptItemGroup},function(formdata){
                        console.log(formdata)
                        let data = JSON.parse(formdata)
                        let genericnamesubclassoptions = `<option value="">Select Sub Class</option>`
                        $.each(data.records, function(key, val) {
                        
                            genericnamesubclassoptions += `
                            <option value="` + val.itemsubclass + `">` + val.itemsubclass + `</option>
                            `
                        })
                        genericnameusagesubclasslist = genericnamesubclassoptions
                        $("#selectusagesubclasssubclass").html(genericnamesubclassoptions)
                        
                    })

                    // get all sub-classes
                    // let selectgroup = $("#selectorder").val()
                           
                           let getFormByDeptItemGroup = "getFormByDeptItemGroup"
                           $.post("controllers/combo-setup.php",{selectsubclassclass:selectgroup,getFormByDeptItemGroup:getFormByDeptItemGroup},function(formdata){
                               console.log(formdata)
                               let data = JSON.parse(formdata)
                               let genericnamesubclassoptions = `<option value="">Select Form</option>`
                               $.each(data.records, function(key, val) {
                               
                                   genericnamesubclassoptions += `
                                   <option value="` + val.itemform + `">` + val.itemform + `</option>
                                   `
                               })
                            //    genericnameusagesubclasslist = genericnamesubclassoptions
                               $("#selectform").html(genericnamesubclassoptions)
                               
                           })

                    $.post("controllers/combo-setup.php",{departmentitemgroup:searchAllItem,getItemGroupByLikeDeptItemGroup: getItemGroupByLikeDeptItemGroup},function(formdata){
                        console.log(formdata)
                        if(formdata!="No Record Found"){
                            
                            let data=JSON.parse(formdata)
                            let usagegroupoptions = ``
                            $.each(data.records, function(key, val) {
                            
                                usagegroupoptions += `
                                <option value="` + val.itemgroup + `">` + val.itemgroup + `</option>
                            `
                            })
                            genericnameusagegrouplist = usagegroupoptions
                            $("#selectusagegroup").html(usagegroupoptions)
                            $("#selectusagegroupgroup").html(usagegroupoptions)
                            //$("#selectformdepartmentitemgroup").html(departmentitemgroupoptions)
                            let selectgroup = $("#selectusagegroup").val()
                            let getItemClassByItemGroup = "getItemClassByItemGroup"
                            $.post("controllers/combo-setup.php",{searchItem:selectgroup,getItemClassByItemGroup:getItemClassByItemGroup},function(formdata){
                                console.log(formdata)
                                let data = JSON.parse(formdata)
                                let genericnameclassoptions = ``
                                $.each(data.records, function(key, val) {
                                
                                    genericnameclassoptions += `
                                    <option value="` + val.itemclass + `">` + val.itemclass + `</option>
                                    `
                                })
                                genericnameusageclasslist = genericnameclassoptions
                                $("#selectusageclass").html(genericnameclassoptions)
                                let selectsubclassclass = $("#selectusageclass").val()
                                let getItemSubClassByClass = "getItemSubClassByClass"
                                $.post("controllers/combo-setup.php",{selectsubclassclass:selectsubclassclass,getItemSubClassByClass:getItemSubClassByClass},function(formdata){
                                    console.log(formdata)
                                    let data = JSON.parse(formdata)
                                    let genericnamesubclassoptions = `<option value="">Select Sub Class</option>`
                                    $.each(data.records, function(key, val) {
                                    
                                        genericnamesubclassoptions += `
                                        <option value="` + val.itemsubclass + `">` + val.itemsubclass + `</option>
                                        `
                                    })
                                    genericnameusagesubclasslist = genericnamesubclassoptions
                                    $("#selectusagesubclass").html(genericnamesubclassoptions)
                                    let searchItem = $("#searchitems").val()
                                    let selectsubclass = $("#selectusagesubclass").val()
                                    let GetGenericNameByUsageDeptItemGrpSubClass = "GetGenericNameByUsageDeptItemGrpSubClass"
                                    $.post("controllers/combo-setup.php",{departmentitemgroup:searchAllItem,searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByUsageDeptItemGrpSubClass:GetGenericNameByUsageDeptItemGrpSubClass},function(formdata){
                                        console.log(formdata)
                                        if(formdata!="No Record Found"){
                                            let data = JSON.parse(formdata)
                                            let genericnameoptions = ``
                                            deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                                            $.each(data.records, function(key, val) {
                                            
                                                genericnameoptions += `
                                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `(` + val.itemmanufacturer + `)</option>
                                                `
                                                deptitemgrpitems += `
                                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `</option>
                                                `
                                            })
                                            deptitemgrpitems += `</select>`
                                            console.log(deptitemgrpitems)
                                            genericnamelist = genericnameoptions
                                            $("#selectallitem").html(genericnameoptions)
                                            // let selectclass = $("#selectgenericnameitemgroupclass").val()
                                            let pricinglist = displayselectedlistitems + `<tr>
                                                        <td></td>
                                                        <td></td>
                                                        <td>` + deptitemgrpitems + `</td>
                                                        <td>
                                                                <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                    </tr>`
                                            $("#view-revenue-order-list").html(pricinglist)
                                            $("#view-revenue-order-list-item").html(pricinglist)
                                            $("#view-revenue-order-list-lab").html(pricinglist)
                                            $("#selectdptitemgrpitem").on("change", function(evt){
                                                evt.preventDefault()
                                                let selecteditem = $("#selectdptitemgrpitem").val()
                                                selectitemanddisplay(selecteditem)
                                            })
                                            $(".additemtolist").on("click", function(evt){

                                                evt.preventDefault()
                                                let selecteditem = $("#selectdptitemgrpitem").val()
                                                selectitemanddisplay(selecteditem)
                                            })
                                        }
                                    
                                    })
                                })
                            })
                        }
                    })

                })


                $("#searchform").on("change keyup paste", function(){
                    let selectgroup = $("#selectorder").val()
                    let searchform = $("#searchform").val()
                    let getFormByDeptItemGroupSearch = "getFormByDeptItemGroupSearch"
                    $.post("controllers/combo-setup.php",{searchform:searchform,selectsubclassclass:selectgroup,getFormByDeptItemGroupSearch:getFormByDeptItemGroupSearch},function(formdata){
                        console.log(formdata)
                        let data = JSON.parse(formdata)
                        let genericnamesubclassoptions = ``
                        $.each(data.records, function(key, val) {
                        
                            genericnamesubclassoptions += `
                            <option value="` + val.itemform + `">` + val.itemform + `</option>
                            `
                        })
                        // genericnameusagesubclasslist = genericnamesubclassoptions
                        $("#selectform").html(genericnamesubclassoptions)
                        let searchItem = $("#searchitems").val()
                        let selectsubclass = $("#selectform").val()
                        let GetGenericNameByFormDeptItemGrp = "GetGenericNameByFormDeptItemGrp"
                        $.post("controllers/combo-setup.php",{departmentitemgroup:searchAllItem,searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByFormDeptItemGrp:GetGenericNameByFormDeptItemGrp},function(formdata){
                            console.log(formdata)
                            if(formdata!="No Record Found"){
                                let data = JSON.parse(formdata)
                                let genericnameoptions = ``
                                deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                                $.each(data.records, function(key, val) {
                                
                                    genericnameoptions += `
                                    <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `(` + val.itemmanufacturer + `)</option>
                                    `
                                    deptitemgrpitems += `
                                    <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `</option>
                                    `
                                })
                                deptitemgrpitems += `</select>`
                                console.log(deptitemgrpitems)
                                genericnamelist = genericnameoptions
                                $("#selectallitem").html(genericnameoptions)
                                // let selectclass = $("#selectgenericnameitemgroupclass").val()
                                let pricinglist = displayselectedlistitems + `<tr>
                                            <td></td>
                                            <td></td>
                                            <td>` + deptitemgrpitems + `</td>
                                            <td>
                                                    <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                        </tr>`
                                $("#view-revenue-order-list").html(pricinglist)
                                $("#view-revenue-order-list-item").html(pricinglist)
                                $("#view-revenue-order-list-lab").html(pricinglist)

                                $("#selectdptitemgrpitem").on("change", function(evt){
                                    evt.preventDefault()
                                    let selecteditem = $("#selectdptitemgrpitem").val()
                                    selectitemanddisplay(selecteditem)
                                })
                                $(".additemtolist").on("click", function(evt){

                                    evt.preventDefault()
                                    let selecteditem = $("#selectdptitemgrpitem").val()
                                    selectitemanddisplay(selecteditem)
                                })
                            }
                        
                        })
                    })

                })


                $("#searchsubclass").on("change keyup paste", function(){
                    // get all sub-classes
                    let selectgroup = $("#selectorder").val()
                    let searchsubclass = $("#searchsubclass").val()
                           
                           let getItemSubClassByDeptItemGroupSearchSubClass = "getItemSubClassByDeptItemGroupSearchSubClass"
                           $.post("controllers/combo-setup.php",{searchsubclass:searchsubclass,selectsubclassclass:selectgroup,getItemSubClassByDeptItemGroupSearchSubClass:getItemSubClassByDeptItemGroupSearchSubClass},function(formdata){
                               console.log(formdata)
                               let data = JSON.parse(formdata)
                               let genericnamesubclassoptions = ``
                               $.each(data.records, function(key, val) {
                               
                                   genericnamesubclassoptions += `
                                   <option value="` + val.itemsubclass + `">` + val.itemsubclass + `</option>
                                   `
                               })
                               genericnameusagesubclasslist = genericnamesubclassoptions
                               $("#selectusagesubclasssubclass").html(genericnamesubclassoptions)
                               let searchItem = $("#searchitems").val()
                               let selectsubclass = $("#selectusagesubclasssubclass").val()
                               let GetGenericNameByUsageDeptItemGrpSubClass = "GetGenericNameByUsageDeptItemGrpSubClass"
                               $.post("controllers/combo-setup.php",{departmentitemgroup:searchAllItem,searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByUsageDeptItemGrpSubClass:GetGenericNameByUsageDeptItemGrpSubClass},function(formdata){
                                   console.log(formdata)
                                   if(formdata!="No Record Found"){
                                       let data = JSON.parse(formdata)
                                       let genericnameoptions = ``
                                       deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                                       $.each(data.records, function(key, val) {
                                       
                                           genericnameoptions += `
                                           <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `(` + val.itemmanufacturer + `)</option>
                                           `
                                           deptitemgrpitems += `
                                           <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `</option>
                                           `
                                       })
                                       deptitemgrpitems += `</select>`
                                       console.log(deptitemgrpitems)
                                       genericnamelist = genericnameoptions
                                       $("#selectallitem").html(genericnameoptions)
                                       // let selectclass = $("#selectgenericnameitemgroupclass").val()
                                       let pricinglist = displayselectedlistitems + `<tr>
                                                   <td></td>
                                                   <td></td>
                                                   <td>` + deptitemgrpitems + `</td>
                                                   <td>
                                                           <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                                   <td></td>
                                                   <td></td>
                                                   <td></td>
                                                   <td></td>
                                               </tr>`
                                       $("#view-revenue-order-list").html(pricinglist)
                                       $("#view-revenue-order-list-item").html(pricinglist)
                                        $("#view-revenue-order-list-lab").html(pricinglist)

                                       $("#selectdptitemgrpitem").on("change", function(evt){
                                           evt.preventDefault()
                                           let selecteditem = $("#selectdptitemgrpitem").val()
                                           selectitemanddisplay(selecteditem)
                                       })
                                       $(".additemtolist").on("click", function(evt){

                                           evt.preventDefault()
                                           let selecteditem = $("#selectdptitemgrpitem").val()
                                           selectitemanddisplay(selecteditem)
                                       })
                                   }
                               
                               })
                           })

                })

                $("#searchgroups").on("change keyup paste", function(){
                    getItemGroupByLikeDeptItemGroupSearchGroup = "getItemGroupByLikeDeptItemGroupSearchGroup"
                    

                    searchAllItem = $("#selectorder").val()
                    // splitsearch = searchItem.split(",")
                    searchItem = $("#searchgroups").val()
                    // console.log(searchItem)
                    //get departmentitemgroups
                    // let getDepartmentItemGroup = "getDepartmentItemGroup"
                    // searchItem = $("#selectorder").val()
                    
                    $.post("controllers/combo-setup.php",{searchItem:searchItem,departmentitemgroup:searchAllItem,getItemGroupByLikeDeptItemGroupSearchGroup: getItemGroupByLikeDeptItemGroupSearchGroup},function(formdata){
                        console.log(formdata)
                        if(formdata!="No Record Found"){
                            
                            let data=JSON.parse(formdata)
                            let usagegroupoptions = ``
                            $.each(data.records, function(key, val) {
                            
                                usagegroupoptions += `
                                <option value="` + val.itemgroup + `">` + val.itemgroup + `</option>
                            `
                            })
                            genericnameusagegrouplist = usagegroupoptions
                            // $("#selectusagegroup").html(usagegroupoptions)
                            $("#selectusagegroupgroup").html(usagegroupoptions)
                            //$("#selectformdepartmentitemgroup").html(departmentitemgroupoptions)
                            let selectgroup = $("#selectusagegroupgroup").val()
                            let getItemClassByItemGroup = "getItemClassByItemGroup"
                            $.post("controllers/combo-setup.php",{searchItem:selectgroup,getItemClassByItemGroup:getItemClassByItemGroup},function(formdata){
                                console.log(formdata)
                                let data = JSON.parse(formdata)
                                let genericnameclassoptions = ``
                                $.each(data.records, function(key, val) {
                                
                                    genericnameclassoptions += `
                                    <option value="` + val.itemclass + `">` + val.itemclass + `</option>
                                    `
                                })
                                genericnameusageclasslist = genericnameclassoptions
                                $("#selectusageclassgroup").html(genericnameclassoptions)
                                let selectsubclassclass = $("#selectusageclassgroup").val()
                                let getItemSubClassByClass = "getItemSubClassByClass"
                                $.post("controllers/combo-setup.php",{selectsubclassclass:selectsubclassclass,getItemSubClassByClass:getItemSubClassByClass},function(formdata){
                                    console.log(formdata)
                                    let data = JSON.parse(formdata)
                                    let genericnamesubclassoptions = `<option value="">Select Sub Class</option>`
                                    $.each(data.records, function(key, val) {
                                    
                                        genericnamesubclassoptions += `
                                        <option value="` + val.itemsubclass + `">` + val.itemsubclass + `</option>
                                        `
                                    })
                                    genericnameusagesubclasslist = genericnamesubclassoptions
                                    $("#selectusagesubclassgroup").html(genericnamesubclassoptions)
                                    let searchItem = $("#searchitems").val()
                                    let selectsubclass = $("#selectusagesubclassgroup").val()
                                    let GetGenericNameByUsageDeptItemGrpSubClass = "GetGenericNameByUsageDeptItemGrpSubClass"
                                    $.post("controllers/combo-setup.php",{departmentitemgroup:searchAllItem,searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByUsageDeptItemGrpSubClass:GetGenericNameByUsageDeptItemGrpSubClass},function(formdata){
                                        console.log(formdata)
                                        if(formdata!="No Record Found"){
                                            let data = JSON.parse(formdata)
                                            let genericnameoptions = ``
                                            deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                                            $.each(data.records, function(key, val) {
                                            
                                                genericnameoptions += `
                                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `(` + val.itemmanufacturer + `)</option>
                                                `
                                                deptitemgrpitems += `
                                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `</option>
                                                `
                                            })
                                            deptitemgrpitems += `</select>`
                                            console.log(deptitemgrpitems)
                                            genericnamelist = genericnameoptions
                                            $("#selectallitem").html(genericnameoptions)
                                            // let selectclass = $("#selectgenericnameitemgroupclass").val()
                                            let pricinglist = displayselectedlistitems + `<tr>
                                                        <td></td>
                                                        <td></td>
                                                        <td>` + deptitemgrpitems + `</td>
                                                        <td>
                                                                <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                    </tr>`
                                            $("#view-revenue-order-list").html(pricinglist)
                                            $("#view-revenue-order-list-item").html(pricinglist)
                                            $("#view-revenue-order-list-lab").html(pricinglist)

                                            $("#selectdptitemgrpitem").on("change", function(evt){
                                                evt.preventDefault()
                                                let selecteditem = $("#selectdptitemgrpitem").val()
                                                selectitemanddisplay(selecteditem)
                                            })
                                            $(".additemtolist").on("click", function(evt){

                                                evt.preventDefault()
                                                let selecteditem = $("#selectdptitemgrpitem").val()
                                                selectitemanddisplay(selecteditem)
                                            })
                                        }
                                    
                                    })
                                })
                            })
                        }
                    })

                })


                $("#searchclass").on('change keyup paste', function () {
                    let searchclass = $("#searchclass").val()
                    let selectgroup = $("#selectorder").val()
                    let getItemClassByDeptItemGroupSearchClass = "getItemClassByDeptItemGroupSearchClass"
                    $.post("controllers/combo-setup.php",{searchclass:searchclass,searchItem:selectgroup,getItemClassByDeptItemGroupSearchClass:getItemClassByDeptItemGroupSearchClass},function(formdata){
                        console.log(formdata)
                        let data = JSON.parse(formdata)
                        let genericnameclassoptions = ``
                        $.each(data.records, function(key, val) {
                        
                            genericnameclassoptions += `
                            <option value="` + val.itemclass + `">` + val.itemclass + `</option>
                            `
                        })
                        genericnameusageclasslist = genericnameclassoptions
                        $("#selectusageclassclass").html(genericnameclassoptions)
                        let selectsubclassclass = $("#selectusageclassclass").val()
                        let getItemSubClassByClass = "getItemSubClassByClass"
                        $.post("controllers/combo-setup.php",{selectsubclassclass:selectsubclassclass,getItemSubClassByClass:getItemSubClassByClass},function(formdata){
                            console.log(formdata)
                            let data = JSON.parse(formdata)
                            let genericnamesubclassoptions = `<option value="">Select Sub Class</option>`
                            $.each(data.records, function(key, val) {
                            
                                genericnamesubclassoptions += `
                                <option value="` + val.itemsubclass + `">` + val.itemsubclass + `</option>
                                `
                            })
                            genericnameusagesubclasslist = genericnamesubclassoptions
                            $("#selectusagesubclassclass").html(genericnamesubclassoptions)
                            let searchItem = $("#searchitems").val()
                            let selectsubclass = $("#selectusagesubclassclass").val()
                            let GetGenericNameByUsageDeptItemGrpSubClass = "GetGenericNameByUsageDeptItemGrpSubClass"
                            $.post("controllers/combo-setup.php",{departmentitemgroup:searchAllItem,searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByUsageDeptItemGrpSubClass:GetGenericNameByUsageDeptItemGrpSubClass},function(formdata){
                                console.log(formdata)
                                if(formdata!="No Record Found"){
                                    let data = JSON.parse(formdata)
                                    let genericnameoptions = ``
                                    deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                                    $.each(data.records, function(key, val) {
                                    
                                        genericnameoptions += `
                                        <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `(` + val.itemmanufacturer + `)</option>
                                        `
                                        deptitemgrpitems += `
                                        <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `</option>
                                        `
                                    })
                                    deptitemgrpitems += `</select>`
                                    console.log(deptitemgrpitems)
                                    genericnamelist = genericnameoptions
                                    $("#selectallitem").html(genericnameoptions)
                                    // let selectclass = $("#selectgenericnameitemgroupclass").val()
                                    let pricinglist = displayselectedlistitems + `<tr>
                                                <td></td>
                                                <td></td>
                                                <td>` + deptitemgrpitems + `</td>
                                                <td>
                                                        <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                            </tr>`
                                    $("#view-revenue-order-list").html(pricinglist)
                                    $("#view-revenue-order-list-item").html(pricinglist)
                                    $("#view-revenue-order-list-lab").html(pricinglist)

                                    $("#selectdptitemgrpitem").on("change", function(evt){
                                        evt.preventDefault()
                                        let selecteditem = $("#selectdptitemgrpitem").val()
                                        selectitemanddisplay(selecteditem)
                                    })
                                    $(".additemtolist").on("click", function(evt){

                                        evt.preventDefault()
                                        let selecteditem = $("#selectdptitemgrpitem").val()
                                        selectitemanddisplay(selecteditem)
                                    })
                                }
                            
                            })
                        })
                    })
                });

                $("#searchitems").on('change keyup paste', function () {
                    ApplyFilterGenericName();
                });

                function ApplyFilterGenericName() {
                    var searchString = $("#searchitems").val();
                    console.log("GetSubDepartmentsFunction")
                    GetGenericNameFunction()
                }

               

                function GetGenericNameFunction(){
                    let searchItem = $("#searchitems").val()
                    let selectsubclass = $("#selectusagesubclass").val()
                    let GetGenericNameByUsageDeptItemGrpSubClass = "GetGenericNameByUsageDeptItemGrpSubClass"
                    $.post("controllers/combo-setup.php",{departmentitemgroup:searchAllItem,searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByUsageDeptItemGrpSubClass:GetGenericNameByUsageDeptItemGrpSubClass},function(formdata){
                        console.log(formdata)
                        if(formdata!="No Record Found"){
                            let data = JSON.parse(formdata)
                            let genericnameoptions = ``
                            deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                            $.each(data.records, function(key, val) {
                            
                                genericnameoptions += `
                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `(` + val.itemmanufacturer + `)</option>
                                `
                                deptitemgrpitems += `
                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `</option>
                                `
                            })
                            deptitemgrpitems += `</select>`
                            genericnamelist = genericnameoptions
                            $("#selectallitem").html(genericnameoptions)
                            // let selectclass = $("#selectgenericnameitemgroupclass").val()
                            let pricinglist = displayselectedlistitems + `<tr>
                                        <td></td>
                                        <td></td>
                                        <td>` + deptitemgrpitems + `</td>
                                        <td>
                                                <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>`
                            $("#view-revenue-order-list").html(pricinglist)
                            $("#view-revenue-order-list-item").html(pricinglist)
                            $("#view-revenue-order-list-lab").html(pricinglist)
                            $("#selectdptitemgrpitem").on("change", function(evt){
                                evt.preventDefault()
                                let selecteditem = $("#selectdptitemgrpitem").val()
                                selectitemanddisplay(selecteditem)
                            })
                            $(".additemtolist").on("click", function(evt){

                                evt.preventDefault()
                                let selecteditem = $("#selectdptitemgrpitem").val()
                                selectitemanddisplay(selecteditem)
                            })
                        }
                        
                    })
                }
                $("#selectusagesubclass").on("change", function(evt){
                    evt.preventDefault()
                    let searchItem = $("#searchitems").val()
                    let selectsubclass = $("#selectusagesubclass").val()
                    let GetGenericNameByUsageDeptItemGrpSubClass = "GetGenericNameByUsageDeptItemGrpSubClass"
                    $.post("controllers/combo-setup.php",{departmentitemgroup:searchAllItem,searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByUsageDeptItemGrpSubClass:GetGenericNameByUsageDeptItemGrpSubClass},function(formdata){
                        console.log(formdata)
                        if(formdata!="No Record Found"){
                            let data = JSON.parse(formdata)
                            let genericnameoptions = ``
                            deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                            $.each(data.records, function(key, val) {
                            
                                genericnameoptions += `
                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `(` + val.itemmanufacturer + `)</option>
                                `
                                deptitemgrpitems += `
                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `</option>
                                `
                            })
                            deptitemgrpitems += `</select>`
                            genericnamelist = genericnameoptions
                            $("#selectallitem").html(genericnameoptions)
                            // let selectclass = $("#selectgenericnameitemgroupclass").val()
                            let pricinglist = displayselectedlistitems + `<tr>
                                            <td></td>
                                            <td></td>
                                            <td>` + deptitemgrpitems + `</td>
                                            <td>
                                                    <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                        </tr>`
                                $("#view-revenue-order-list").html(pricinglist)
                                $("#view-revenue-order-list-item").html(pricinglist)
                                $("#view-revenue-order-list-lab").html(pricinglist)

                                $("#selectdptitemgrpitem").on("change", function(evt){
                                    evt.preventDefault()
                                    let selecteditem = $("#selectdptitemgrpitem").val()
                                    selectitemanddisplay(selecteditem)
                                })
                                $(".additemtolist").on("click", function(evt){

                                    evt.preventDefault()
                                    let selecteditem = $("#selectdptitemgrpitem").val()
                                    selectitemanddisplay(selecteditem)
                                })
                        }
                        
                    })
                })

                $("#selectusagesubclassgroup").on("change", function(evt){
                    evt.preventDefault()
                    let searchItem = $("#searchitems").val()
                    let selectsubclass = $("#selectusagesubclassgroup").val()
                    let GetGenericNameByUsageDeptItemGrpSubClass = "GetGenericNameByUsageDeptItemGrpSubClass"
                    $.post("controllers/combo-setup.php",{departmentitemgroup:searchAllItem,searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByUsageDeptItemGrpSubClass:GetGenericNameByUsageDeptItemGrpSubClass},function(formdata){
                        console.log(formdata)
                        if(formdata!="No Record Found"){
                            let data = JSON.parse(formdata)
                            let genericnameoptions = ``
                            deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                            $.each(data.records, function(key, val) {
                            
                                genericnameoptions += `
                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `(` + val.itemmanufacturer + `)</option>
                                `
                                deptitemgrpitems += `
                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `</option>
                                `
                            })
                            deptitemgrpitems += `</select>`
                            genericnamelist = genericnameoptions
                            $("#selectallitem").html(genericnameoptions)
                            // let selectclass = $("#selectgenericnameitemgroupclass").val()
                            let pricinglist = displayselectedlistitems + `<tr>
                                            <td></td>
                                            <td></td>
                                            <td>` + deptitemgrpitems + `</td>
                                            <td>
                                                    <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                        </tr>`
                                $("#view-revenue-order-list").html(pricinglist)
                                $("#view-revenue-order-list-item").html(pricinglist)
                                $("#view-revenue-order-list-lab").html(pricinglist)

                                $("#selectdptitemgrpitem").on("change", function(evt){
                                    evt.preventDefault()
                                    let selecteditem = $("#selectdptitemgrpitem").val()
                                    selectitemanddisplay(selecteditem)
                                })
                                $(".additemtolist").on("click", function(evt){

                                    evt.preventDefault()
                                    let selecteditem = $("#selectdptitemgrpitem").val()
                                    selectitemanddisplay(selecteditem)
                                })
                        }
                        
                    })
                })

                $("#selectusagesubclassclass").on("change", function(evt){
                    evt.preventDefault()
                    let searchItem = $("#searchitems").val()
                    let selectsubclass = $("#selectusagesubclassclass").val()
                    let GetGenericNameByUsageDeptItemGrpSubClass = "GetGenericNameByUsageDeptItemGrpSubClass"
                    $.post("controllers/combo-setup.php",{departmentitemgroup:searchAllItem,searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByUsageDeptItemGrpSubClass:GetGenericNameByUsageDeptItemGrpSubClass},function(formdata){
                        console.log(formdata)
                        if(formdata!="No Record Found"){
                            let data = JSON.parse(formdata)
                            let genericnameoptions = ``
                            deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                            $.each(data.records, function(key, val) {
                            
                                genericnameoptions += `
                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `(` + val.itemmanufacturer + `)</option>
                                `
                                deptitemgrpitems += `
                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `</option>
                                `
                            })
                            deptitemgrpitems += `</select>`
                            genericnamelist = genericnameoptions
                            $("#selectallitem").html(genericnameoptions)
                            // let selectclass = $("#selectgenericnameitemgroupclass").val()
                            let pricinglist = displayselectedlistitems + `<tr>
                                            <td></td>
                                            <td></td>
                                            <td>` + deptitemgrpitems + `</td>
                                            <td>
                                                    <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                        </tr>`
                                $("#view-revenue-order-list").html(pricinglist)
                                $("#view-revenue-order-list-item").html(pricinglist)
                                $("#view-revenue-order-list-lab").html(pricinglist)

                                $("#selectdptitemgrpitem").on("change", function(evt){
                                    evt.preventDefault()
                                    let selecteditem = $("#selectdptitemgrpitem").val()
                                    selectitemanddisplay(selecteditem)
                                })
                                $(".additemtolist").on("click", function(evt){

                                    evt.preventDefault()
                                    let selecteditem = $("#selectdptitemgrpitem").val()
                                    selectitemanddisplay(selecteditem)
                                })
                        }
                        
                    })
                })


                $("#selectusagesubclasssubclass").on("change", function(evt){
                    evt.preventDefault()
                    let searchItem = $("#searchitems").val()
                    let selectsubclass = $("#selectusagesubclasssubclass").val()
                    let GetGenericNameByUsageDeptItemGrpSubClass = "GetGenericNameByUsageDeptItemGrpSubClass"
                    $.post("controllers/combo-setup.php",{departmentitemgroup:searchAllItem,searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByUsageDeptItemGrpSubClass:GetGenericNameByUsageDeptItemGrpSubClass},function(formdata){
                        console.log(formdata)
                        if(formdata!="No Record Found"){
                            let data = JSON.parse(formdata)
                            let genericnameoptions = ``
                            deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                            $.each(data.records, function(key, val) {
                            
                                genericnameoptions += `
                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `(` + val.itemmanufacturer + `)</option>
                                `
                                deptitemgrpitems += `
                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `</option>
                                `
                            })
                            deptitemgrpitems += `</select>`
                            genericnamelist = genericnameoptions
                            $("#selectallitem").html(genericnameoptions)
                            // let selectclass = $("#selectgenericnameitemgroupclass").val()
                            let pricinglist = displayselectedlistitems + `<tr>
                                            <td></td>
                                            <td></td>
                                            <td>` + deptitemgrpitems + `</td>
                                            <td>
                                                    <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                        </tr>`
                                $("#view-revenue-order-list").html(pricinglist)
                                $("#view-revenue-order-list-item").html(pricinglist)
                                $("#view-revenue-order-list-lab").html(pricinglist)

                                $("#selectdptitemgrpitem").on("change", function(evt){
                                    evt.preventDefault()
                                    let selecteditem = $("#selectdptitemgrpitem").val()
                                    selectitemanddisplay(selecteditem)
                                })
                                $(".additemtolist").on("click", function(evt){

                                    evt.preventDefault()
                                    let selecteditem = $("#selectdptitemgrpitem").val()
                                    selectitemanddisplay(selecteditem)
                                })
                        }
                        
                    })
                })


                $("#selectusagegroup").on("change", function(evt){
                    evt.preventDefault()
                    //$("#selectformdepartmentitemgroup").html(departmentitemgroupoptions)
                    let selectgroup = $("#selectusagegroup").val()
                    let getItemClassByItemGroup = "getItemClassByItemGroup"
                    console.log(selectgroup)
                    $.post("controllers/combo-setup.php",{searchItem:selectgroup,getItemClassByItemGroup:getItemClassByItemGroup},function(formdata){
                        console.log(formdata)
                        let data = JSON.parse(formdata)
                        let genericnameclassoptions = ``
                        $.each(data.records, function(key, val) {
                        
                            genericnameclassoptions += `
                            <option value="` + val.itemclass + `">` + val.itemclass + `</option>
                            `
                        })
                        genericnameusageclasslist = genericnameclassoptions
                        $("#selectusageclass").html(genericnameclassoptions)
                        let selectsubclassclass = $("#selectusageclass").val()
                        let getItemSubClassByClass = "getItemSubClassByClass"
                        $.post("controllers/combo-setup.php",{selectsubclassclass:selectsubclassclass,getItemSubClassByClass:getItemSubClassByClass},function(formdata){
                            console.log(formdata)
                            let data = JSON.parse(formdata)
                            let genericnamesubclassoptions = `<option value="">Select Sub Class</option>`
                            $.each(data.records, function(key, val) {
                            
                                genericnamesubclassoptions += `
                                <option value="` + val.itemsubclass + `">` + val.itemsubclass + `</option>
                                `
                            })
                            genericnameusagesubclasslist = genericnamesubclassoptions
                            $("#selectusagesubclass").html(genericnamesubclassoptions)
                            let searchItem = $("#searchitems").val()
                            let selectsubclass = $("#selectusagesubclass").val()
                            let GetGenericNameByUsageDeptItemGrpSubClass = "GetGenericNameByUsageDeptItemGrpSubClass"
                            $.post("controllers/combo-setup.php",{departmentitemgroup:searchAllItem,searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByUsageDeptItemGrpSubClass:GetGenericNameByUsageDeptItemGrpSubClass},function(formdata){
                                console.log(formdata)
                                if(formdata!="No Record Found"){
                                    let data = JSON.parse(formdata)
                                    let genericnameoptions = ``
                                    deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                                    $.each(data.records, function(key, val) {
                                    
                                        genericnameoptions += `
                                        <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `(` + val.itemmanufacturer + `)</option>
                                        `
                                        deptitemgrpitems += `
                                        <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `</option>
                                        `
                                    })
                                    deptitemgrpitems += `</select>`
                                    genericnamelist = genericnameoptions
                                    $("#selectallitem").html(genericnameoptions)
                                    // let selectclass = $("#selectgenericnameitemgroupclass").val()
                                    let pricinglist = displayselectedlistitems + `<tr>
                                                    <td></td>
                                                    <td></td>
                                                    <td>` + deptitemgrpitems + `</td>
                                                    <td>
                                                            <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>`
                                        $("#view-revenue-order-list").html(pricinglist)
                                        $("#view-revenue-order-list-item").html(pricinglist)
                                        $("#view-revenue-order-list-lab").html(pricinglist)
                                        $("#selectdptitemgrpitem").on("change", function(evt){
                                            evt.preventDefault()
                                            let selecteditem = $("#selectdptitemgrpitem").val()
                                            selectitemanddisplay(selecteditem)
                                        })
                                        $(".additemtolist").on("click", function(evt){

                                            evt.preventDefault()
                                            let selecteditem = $("#selectdptitemgrpitem").val()
                                            selectitemanddisplay(selecteditem)
                                        })
                                }
                                
                            })
                        })
                    })
                })

                $("#selectusagegroupgroup").on("change", function(evt){
                    evt.preventDefault()
                    //$("#selectformdepartmentitemgroup").html(departmentitemgroupoptions)
                    let selectgroup = $("#selectusagegroupgroup").val()
                    let getItemClassByItemGroup = "getItemClassByItemGroup"
                    console.log(selectgroup)
                    $.post("controllers/combo-setup.php",{searchItem:selectgroup,getItemClassByItemGroup:getItemClassByItemGroup},function(formdata){
                        console.log(formdata)
                        let data = JSON.parse(formdata)
                        let genericnameclassoptions = ``
                        $.each(data.records, function(key, val) {
                        
                            genericnameclassoptions += `
                            <option value="` + val.itemclass + `">` + val.itemclass + `</option>
                            `
                        })
                        genericnameusageclasslist = genericnameclassoptions
                        $("#selectusageclassgroup").html(genericnameclassoptions)
                        let selectsubclassclass = $("#selectusageclassgroup").val()
                        let getItemSubClassByClass = "getItemSubClassByClass"
                        $.post("controllers/combo-setup.php",{selectsubclassclass:selectsubclassclass,getItemSubClassByClass:getItemSubClassByClass},function(formdata){
                            console.log(formdata)
                            let data = JSON.parse(formdata)
                            let genericnamesubclassoptions = `<option value="">Select Sub Class</option>`
                            $.each(data.records, function(key, val) {
                            
                                genericnamesubclassoptions += `
                                <option value="` + val.itemsubclass + `">` + val.itemsubclass + `</option>
                                `
                            })
                            genericnameusagesubclasslist = genericnamesubclassoptions
                            $("#selectusagesubclassgroup").html(genericnamesubclassoptions)
                            let searchItem = $("#searchgroups").val()
                            let selectsubclass = $("#selectusagesubclassgroup").val()
                            let GetGenericNameByUsageDeptItemGrpSubClass = "GetGenericNameByUsageDeptItemGrpSubClass"
                            $.post("controllers/combo-setup.php",{departmentitemgroup:searchAllItem,searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByUsageDeptItemGrpSubClass:GetGenericNameByUsageDeptItemGrpSubClass},function(formdata){
                                console.log(formdata)
                                if(formdata!="No Record Found"){
                                    let data = JSON.parse(formdata)
                                    let genericnameoptions = ``
                                    deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                                    $.each(data.records, function(key, val) {
                                    
                                        genericnameoptions += `
                                        <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `(` + val.itemmanufacturer + `)</option>
                                        `
                                        deptitemgrpitems += `
                                        <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `</option>
                                        `
                                    })
                                    deptitemgrpitems += `</select>`
                                    genericnamelist = genericnameoptions
                                    $("#selectallitem").html(genericnameoptions)
                                    // let selectclass = $("#selectgenericnameitemgroupclass").val()
                                    let pricinglist = displayselectedlistitems + `<tr>
                                                    <td></td>
                                                    <td></td>
                                                    <td>` + deptitemgrpitems + `</td>
                                                    <td>
                                                            <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>`
                                        $("#view-revenue-order-list").html(pricinglist)
                                        $("#view-revenue-order-list-item").html(pricinglist)
                                        $("#view-revenue-order-list-lab").html(pricinglist)
                                        $("#selectdptitemgrpitem").on("change", function(evt){
                                            evt.preventDefault()
                                            let selecteditem = $("#selectdptitemgrpitem").val()
                                            selectitemanddisplay(selecteditem)
                                        })
                                        $(".additemtolist").on("click", function(evt){

                                            evt.preventDefault()
                                            let selecteditem = $("#selectdptitemgrpitem").val()
                                            selectitemanddisplay(selecteditem)
                                        })
                                }
                                
                            })
                        })
                    })
                })


                $("#selectusageclass").on("change", function(evt){
                    evt.preventDefault()
                    let selectsubclassclass = $("#selectusageclass").val()
                    let getItemSubClassByClass = "getItemSubClassByClass"
                    $.post("controllers/combo-setup.php",{selectsubclassclass:selectsubclassclass,getItemSubClassByClass:getItemSubClassByClass},function(formdata){
                        console.log(formdata)
                        let data = JSON.parse(formdata)
                        let genericnamesubclassoptions = `<option value="">Select Sub Class</option>`
                        $.each(data.records, function(key, val) {
                        
                            genericnamesubclassoptions += `
                            <option value="` + val.itemsubclass + `">` + val.itemsubclass + `</option>
                            `
                        })
                        genericnameusagesubclasslist = genericnamesubclassoptions
                        $("#selectusagesubclass").html(genericnamesubclassoptions)
                        let searchItem = $("#searchitems").val()
                        let selectsubclass = $("#selectusagesubclass").val()
                        let GetGenericNameByUsageDeptItemGrpSubClass = "GetGenericNameByUsageDeptItemGrpSubClass"
                        $.post("controllers/combo-setup.php",{departmentitemgroup:searchAllItem,searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByUsageDeptItemGrpSubClass:GetGenericNameByUsageDeptItemGrpSubClass},function(formdata){
                            console.log(formdata)
                            if(formdata!="No Record Found"){
                                let data = JSON.parse(formdata)
                                let genericnameoptions = ``
                                deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                                $.each(data.records, function(key, val) {
                                
                                    genericnameoptions += `
                                    <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `(` + val.itemmanufacturer + `)</option>
                                    `
                                    deptitemgrpitems += `
                                    <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `</option>
                                    `
                                })
                                deptitemgrpitems += `</select>`
                                genericnamelist = genericnameoptions
                                $("#selectallitem").html(genericnameoptions)
                                // let selectclass = $("#selectgenericnameitemgroupclass").val()
                                let pricinglist = displayselectedlistitems + `<tr>
                                                <td></td>
                                                <td></td>
                                                <td>` + deptitemgrpitems + `</td>
                                                <td>
                                                        <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                            </tr>`
                                    $("#view-revenue-order-list").html(pricinglist)
                                    $("#view-revenue-order-list-item").html(pricinglist)
                                    $("#view-revenue-order-list-lab").html(pricinglist)
                                    $("#selectdptitemgrpitem").on("change", function(evt){
                                        evt.preventDefault()
                                        let selecteditem = $("#selectdptitemgrpitem").val()
                                        selectitemanddisplay(selecteditem)
                                    })
                                    $(".additemtolist").on("click", function(evt){

                                        evt.preventDefault()
                                        let selecteditem = $("#selectdptitemgrpitem").val()
                                        selectitemanddisplay(selecteditem)
                                    })
                            }
                            
                        })
                    })
                })

                $("#selectusageclassgroup").on("change", function(evt){
                    evt.preventDefault()
                    let selectsubclassclass = $("#selectusageclassgroup").val()
                    let getItemSubClassByClass = "getItemSubClassByClass"
                    $.post("controllers/combo-setup.php",{selectsubclassclass:selectsubclassclass,getItemSubClassByClass:getItemSubClassByClass},function(formdata){
                        console.log(formdata)
                        let data = JSON.parse(formdata)
                        let genericnamesubclassoptions = `<option value="">Select Sub Class</option>`
                        $.each(data.records, function(key, val) {
                        
                            genericnamesubclassoptions += `
                            <option value="` + val.itemsubclass + `">` + val.itemsubclass + `</option>
                            `
                        })
                        genericnameusagesubclasslist = genericnamesubclassoptions
                        $("#selectusagesubclassgroup").html(genericnamesubclassoptions)
                        let searchItem = $("#searchitems").val()
                        let selectsubclass = $("#selectusagesubclassgroup").val()
                        let GetGenericNameByUsageDeptItemGrpSubClass = "GetGenericNameByUsageDeptItemGrpSubClass"
                        $.post("controllers/combo-setup.php",{departmentitemgroup:searchAllItem,searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByUsageDeptItemGrpSubClass:GetGenericNameByUsageDeptItemGrpSubClass},function(formdata){
                            console.log(formdata)
                            if(formdata!="No Record Found"){
                                let data = JSON.parse(formdata)
                                let genericnameoptions = ``
                                deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                                $.each(data.records, function(key, val) {
                                
                                    genericnameoptions += `
                                    <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `(` + val.itemmanufacturer + `)</option>
                                    `
                                    deptitemgrpitems += `
                                    <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `</option>
                                    `
                                })
                                deptitemgrpitems += `</select>`
                                genericnamelist = genericnameoptions
                                $("#selectallitem").html(genericnameoptions)
                                // let selectclass = $("#selectgenericnameitemgroupclass").val()
                                let pricinglist = displayselectedlistitems + `<tr>
                                                <td></td>
                                                <td></td>
                                                <td>` + deptitemgrpitems + `</td>
                                                <td>
                                                        <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                            </tr>`
                                    $("#view-revenue-order-list").html(pricinglist)
                                    $("#view-revenue-order-list-item").html(pricinglist)
                                    $("#view-revenue-order-list-lab").html(pricinglist)
                                    $("#selectdptitemgrpitem").on("change", function(evt){
                                        evt.preventDefault()
                                        let selecteditem = $("#selectdptitemgrpitem").val()
                                        selectitemanddisplay(selecteditem)
                                    })
                                    $(".additemtolist").on("click", function(evt){

                                        evt.preventDefault()
                                        let selecteditem = $("#selectdptitemgrpitem").val()
                                        selectitemanddisplay(selecteditem)
                                    })
                            }
                            
                        })
                    })
                })

                $("#selectusageclassclass").on("change", function(evt){
                    evt.preventDefault()
                    let selectsubclassclass = $("#selectusageclassclass").val()
                    let getItemSubClassByClass = "getItemSubClassByClass"
                    $.post("controllers/combo-setup.php",{selectsubclassclass:selectsubclassclass,getItemSubClassByClass:getItemSubClassByClass},function(formdata){
                        console.log(formdata)
                        let data = JSON.parse(formdata)
                        let genericnamesubclassoptions = `<option value="">Select Sub Class</option>`
                        $.each(data.records, function(key, val) {
                        
                            genericnamesubclassoptions += `
                            <option value="` + val.itemsubclass + `">` + val.itemsubclass + `</option>
                            `
                        })
                        genericnameusagesubclasslist = genericnamesubclassoptions
                        $("#selectusagesubclassclass").html(genericnamesubclassoptions)
                        let searchItem = $("#searchitems").val()
                        let selectsubclass = $("#selectusagesubclassclass").val()
                        let GetGenericNameByUsageDeptItemGrpSubClass = "GetGenericNameByUsageDeptItemGrpSubClass"
                        $.post("controllers/combo-setup.php",{departmentitemgroup:searchAllItem,searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByUsageDeptItemGrpSubClass:GetGenericNameByUsageDeptItemGrpSubClass},function(formdata){
                            console.log(formdata)
                            if(formdata!="No Record Found"){
                                let data = JSON.parse(formdata)
                                let genericnameoptions = ``
                                deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                                $.each(data.records, function(key, val) {
                                
                                    genericnameoptions += `
                                    <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `(` + val.itemmanufacturer + `)</option>
                                    `
                                    deptitemgrpitems += `
                                    <option value="` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `</option>
                                    `
                                })
                                deptitemgrpitems += `</select>`
                                genericnamelist = genericnameoptions
                                $("#selectallitem").html(genericnameoptions)
                                // let selectclass = $("#selectgenericnameitemgroupclass").val()
                                let pricinglist = displayselectedlistitems + `<tr>
                                                <td></td>
                                                <td></td>
                                                <td>` + deptitemgrpitems + `</td>
                                                <td>
                                                        <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                            </tr>`
                                    $("#view-revenue-order-list").html(pricinglist)
                                    $("#view-revenue-order-list-item").html(pricinglist)
                                    $("#view-revenue-order-list-lab").html(pricinglist)
                                    $("#selectdptitemgrpitem").on("change", function(evt){
                                        evt.preventDefault()
                                        let selecteditem = $("#selectdptitemgrpitem").val()
                                        selectitemanddisplay(selecteditem)
                                    })
                                    $(".additemtolist").on("click", function(evt){

                                        evt.preventDefault()
                                        let selecteditem = $("#selectdptitemgrpitem").val()
                                        selectitemanddisplay(selecteditem)
                                    })
                            }
                            
                        })
                    })
                })



                //Add Prescription Setup

                let itemstrength = ""
            let getDosage = "getDosage"
            // let searchItem = ""
            let dosagelist = ""
            $.post("controllers/combo-setup.php",{searchItem:searchItem,getDosage:getDosage}, function(data){
                if(data!="No Record Found"){
                    let stocktypeoptions = ``
                    data = JSON.parse(data)
                    $.each(data.records, function(key, val) {
                        stocktypeoptions += `<option value="` + val.dosage + `,` + val.abbreviation + `">` + val.dosage + `</option>`
                    });
                    dosagelist = stocktypeoptions
                    $("#dosage").html(stocktypeoptions)
                }
            })
            let durationlist = ""
            let getDuration = "getDuration"
            $.post("controllers/combo-setup.php",{searchItem:searchItem,getDuration:getDuration}, function(data){
                if(data!="No Record Found"){
                    let supplieroptions = ``
                    data = JSON.parse(data)
                    $.each(data.records, function(key, val) {
                        supplieroptions += `<option value="` + val.duration + `,` + val.abbreviation + `">` + val.duration + `</option>`
                    });
                    durationlist = supplieroptions
                    $("#duration").html(supplieroptions)
                }
            })

            let frequencylist = ""
            let getFrequency = "getFrequency"
            //let searchItem = ""
            $.post("controllers/combo-setup.php",{searchItem:searchItem,getFrequency:getFrequency}, function(data){
                if(data!="No Record Found"){
                    let organizationoptions = ``
                    data = JSON.parse(data)
                    // console.log(data)
                    $.each(data.records, function(key, val) {
                        organizationoptions += `<option value="` + val.abbreviation + `,` + val.frequency + `">` + val.frequency + `</option>`
                    });
                    frequencylist = organizationoptions
                    $("#frequency").html(organizationoptions)

                    
                }
            })

            let weightlist = ""
            let getWeight = "getWeight"
            //let searchItem = ""
            $.post("controllers/combo-setup.php",{searchItem:searchItem,getWeight:getWeight}, function(data){
                if(data!="No Record Found"){
                    let organizationoptions = ``
                    data = JSON.parse(data)
                    // console.log(data)
                    $.each(data.records, function(key, val) {
                        organizationoptions += `<option value="` + val.weight + `,` + val.age + `,` + val.sex + `">` + val.sex + `: ` + val.age + `</option>`
                    });
                    weightlist = organizationoptions
                    // $("#weight").html(organizationoptions)

                    
                }
            })

            let agelist = ""
            let searchage = ""
            let getAgeGroup = "getAgeGroup"
            //let searchItem = ""
            $.post("controllers/combo-setup.php",{searchItem:searchage,getAgeGroup:getAgeGroup}, function(data){
                if(data!="No Record Found"){
                    let organizationoptions = ``
                    data = JSON.parse(data)
                    // console.log(data)
                    $.each(data.records, function(key, val) {
                        organizationoptions += `<option value="` + val.age + ` (` + val.agerange + `)">` + val.age + ` (` + val.agerange + `)</option>`
                    });
                    agelist = organizationoptions
                    $("#selectage").html(organizationoptions)

                    
                }
            })

            $("#add-prescription-order-button").show()
            $("#discard-prescription-order-button").hide()
            $("#update-prescription-order-button").hide()
            // $("#cancel-prescription-order-button").hide()

            let prescriptionorderlist = []
            let revenueorderlist = []
            let prescriptionlist = []
                // Add item to revenue order List
                $("#add-allitem-button").on("click", function(evt){
                    evt.preventDefault()
                    let item = $("#selectallitem").val()
                    let splititem = item.split(",")
                    let itemid = splititem[0]
                    let itemname = splititem[1]
                    
                    let getPrescriptionByItemId = "getPrescriptionByItemId"
                    $.post("controllers/combo-setup.php",{itemid:itemid,getPrescriptionByItemId:getPrescriptionByItemId}, function(formdata){
                        console.log(formdata)
                        if(formdata!="No Record Found"){
                            let weight = 0
                            let gender = ""
                            let age = ""
                            // console.log($("#selectpatient").val(), typeof($("#selectpatient").val()))
                            if($("#selectpatient").val()==""||$("#selectpatient").val()==null||$("#selectpatient").val()=="0"){
                                
                                gender = $("#selectgender").val()
                                weight = $("#enterweight").val()
                                age = $("#selectage").val()
                                let splitage = age.split(" (")
                                age = splitage[0]
                            } else {
                                gender = $("#patientgender").val()
                               age = $("#agegroup").val()
                                weight = $("#patientweight").val()
                                console.log(age, weight)
                            }
                            let data = JSON.parse(formdata)
                            let prescription = data.records[0].prescription
                           
                            prescriptionlist = JSON.parse(prescription)
                            


                            let prescription_weight = ""
                            let stat_value = false
                            let totalquantity = 0

                            prescriptionlist.forEach(val => {
                                
                                
                                let prescriptionweight = ""
                                let frequency_value = val.frequency
                                let splitfreq = frequency_value.split(",")
                                if(splitfreq[0]=="stat"){
                                    stat_value = true
                                    prescription_weight = val.weight
                                    prescriptionweight= prescription_weight
                                    totalquantity = 0
                                } else {
                                    if( stat_value == true ){
                                        prescriptionweight= prescription_weight
                                    } else {
                                        prescriptionweight = val.weight
                                        totalquantity = 0
                                    }
                                    stat_value = false
                                }

                                
                                
                                 



                                splitweight = prescriptionweight.split(",")

                                let prescriptiongender = splitweight[2]
                                prescriptionweightlist = splitweight[0].split("-")
                                let lowerweightlist = prescriptionweightlist[0].split("Kg")
                                let lowerweight = parseFloat(lowerweightlist[0])
                                let upperweightlist = prescriptionweightlist[1].split("Kg")
                                let upperweight = parseFloat(upperweightlist[0])
                                let selectweight = 0
                                if(weight!=null){
                                    selectweight = parseFloat(weight)
                                }
                                
                                let prescriptionage = splitweight[1]
                                let splitprescriptionagelist = prescriptionage.split(" (")
                                prescriptionage = splitprescriptionagelist[0]

                               
                                

                                if(gender==prescriptiongender){
                                    console.log(age,prescriptionage)
                                    let view = $('input[name="prescriptionview"]:checked').val()
                                    console.log(view)
                                    if(view=="Age"){
                                        if(age==prescriptionage){
                                            let prescriptiontext = val.enterdosage + " " + val.dosage + "x" + val.frequency + "x" + val.enterduration + " " + val.duration
                                            
                                            let duration_value = 1

                                            if(frequency_value.includes("stat")){
                                                duration_value = 1
                                            }
                                            if(val.duration.includes("day")){
                                                duration_value = parseFloat(val.enterduration)
                                                totalquantity = 0
                                            }

                                            let quantity = parseFloat(val.enterdosage) * duration_value
                                            totalquantity = totalquantity + quantity
                                            quantity = totalquantity
                                            if(val.frequency.includes("tds")){
                                                quantity = quantity * 3
                                            } else if(val.frequency.includes("bd")){
                                                quantity = quantity * 2
                                            } else if(val.frequency.includes("qds")){
                                                quantity = quantity * 4
                                            }
                                            let price = parseFloat(data.records[0].sellingprice)
                                            let totalprice = price * quantity
                                            let stockcode = data.records[0].stockcode
                                            let dosageinstruction = data.records[0].dosageinstruction
                                            let administrationinstruction = data.records[0].administrationinstruction
                                            let strength = data.records[0].strength
                                            let interaction = data.records[0].interaction
                                            let itemform = data.records[0].itemformabbreviation
                                            let infusiongivingset = data.records[0].infusiongivingset + " " + data.records[0].infusionconstant
                                            let infusionrate = data.records[0].infusionrate
                                            let department = data.records[0].department
                                            let departmentitemgroup = data.records[0].departmentitemgroup
                                            let gasinfusionconstant = data.records[0].gasinfusionconstant + " " + data.records[0].gasinfusionrate
                                            let unittype = $("#selectunittype").val()
                                            let prescriptionitem = {
                                                "item":itemname,
                                                "itemid":itemid,
                                                "prescription":prescriptiontext,
                                                "route":data.records[0].usageroute,
                                                "unitpricepiece":data.records[0].sellingprice,
                                                "unitpriceweight":data.records[0].sellingpriceperstrength,
                                                "unitpricevolume":data.records[0].sellingpriceperliquidstrength,
                                                "quantity":quantity,
                                                "totalamount":totalprice,
                                                "stockcode":stockcode,
                                                "dosageinstruction":dosageinstruction,
                                                "administrationinstruction":administrationinstruction,
                                                "strength":strength,
                                                "iteminfo":interaction,
                                                "itemform":itemform,
                                                "infusiongivingset":infusiongivingset,
                                                "infusionrate":infusionrate,
                                                "gasinfusionconstant":gasinfusionconstant,
                                                "unittype":unittype
                                            }
                                            prescriptionorderlist.push(prescriptionitem)
                                           
                                            let sellingprice = 0
                                            if(unittype=="pieces"){
                                                sellingprice = parseFloat(data.records[0].sellingprice)
                                            } else if(unittype=="weight"){
                                                sellingprice = parseFloat(data.records[0].sellingpriceperstrength)
                                            } else if(unittype=="volume"){
                                                sellingprice = parseFloat(data.records[0].sellingpriceperliquidstrength)
                                            }
                                            let revenueorderitem = {"genericname":itemname,
                                                                    "department":department,
                                                                    "departmentitemgroup":departmentitemgroup,
                                                                    "sellingprice":sellingprice,
                                                                    "reorderlevel":"reorderlevel",
                                                                    "unittype":unittype,
                                                                    "itemid":itemid,
                                                                    "quantity":quantity}
                                            revenueorderlist.push(revenueorderitem)
                                            displayprescriptionorder(prescriptionorderlist)
                                        }
                                    } else if(view=="Weight"){
                                        console.log(selectweight,lowerweight,upperweight)
                                        console.log(selectweight>lowerweight)
                                        console.log(selectweight<upperweight)
                                        if(selectweight>lowerweight && selectweight<upperweight){
                                            let prescriptiontext = val.enterdosage + " " + val.dosage + "x" + val.frequency + "x" + val.enterduration + " " + val.duration
                                            let duration_value = 1
                                            if(frequency_value.includes("stat")){
                                                duration_value = 1
                                            }else{
                                                duration_value = parseFloat(val.enterduration)
                                                totalquantity = 0
                                            }

                                            let quantity = parseFloat(val.enterdosage) * duration_value
                                            totalquantity = totalquantity + quantity
                                            quantity = totalquantity

                                            if(val.frequency.includes("tds")){
                                                quantity = quantity * 3
                                            } else if(val.frequency.includes("bd")){
                                                quantity = quantity * 2
                                            } else if(val.frequency.includes("qds")){
                                                quantity = quantity * 4
                                            }
                                            let price = parseFloat(data.records[0].sellingprice)
                                            let totalprice = price * quantity
                                            let stockcode = data.records[0].stockcode
                                            let dosageinstruction = data.records[0].dosageinstruction
                                            let administrationinstruction = data.records[0].administrationinstruction
                                            let strength = data.records[0].strength
                                            let interaction = data.records[0].interaction
                                            let itemform = data.records[0].itemformabbreviation
                                            let infusiongivingset = data.records[0].infusiongivingset + " " + data.records[0].infusionconstant
                                            let infusionrate = data.records[0].infusionrate
                                            let department = data.records[0].department
                                            let departmentitemgroup = data.records[0].departmentitemgroup
                                            let gasinfusionconstant = data.records[0].gasinfusionconstant + " " + data.records[0].gasinfusionrate
                                            let unittype = $("#selectunittype").val()
                                            console.log(unittype)
                                            let prescriptionitem = {
                                                "item":itemname,
                                                "itemid":itemid,
                                                "prescription":prescriptiontext,
                                                "route":data.records[0].usageroute,
                                                "unitpricepiece":data.records[0].sellingprice,
                                                "unitpriceweight":data.records[0].sellingpriceperstrength,
                                                "unitpricevolume":data.records[0].sellingpriceperliquidstrength,
                                                "quantity":quantity,
                                                "totalamount":totalprice,
                                                "stockcode":stockcode,
                                                "dosageinstruction":dosageinstruction,
                                                "administrationinstruction":administrationinstruction,
                                                "strength":strength,
                                                "iteminfo":interaction,
                                                "itemform":itemform,
                                                "infusiongivingset":infusiongivingset,
                                                "infusionrate":infusionrate,
                                                "gasinfusionconstant":gasinfusionconstant,
                                                "unittype":unittype
                                            }
                                            prescriptionorderlist.push(prescriptionitem)
                                            let sellingprice = 0
                                            if(unittype=="pieces"){
                                                sellingprice = parseFloat(data.records[0].sellingprice)
                                            } else if(unittype=="weight"){
                                                sellingprice = parseFloat(data.records[0].sellingpriceperstrength)
                                            } else if(unittype=="volume"){
                                                sellingprice = parseFloat(data.records[0].sellingpriceperliquidstrength)
                                            }
                                            let revenueorderitem = {"genericname":itemname,
                                                                    "department":department,
                                                                    "departmentitemgroup":departmentitemgroup,
                                                                    "sellingprice":sellingprice,
                                                                    "reorderlevel":"reorderlevel",
                                                                    "unittype":unittype,
                                                                    "itemid":itemid,
                                                                    "quantity":quantity}
                                            revenueorderlist.push(revenueorderitem)
                                            displayprescriptionorder(prescriptionorderlist)
                                        }
                                    }
                                    
                                    
                                }
                            });
                        }
                    })
                })


                $("#selectallitem").on("change", function(evt){
                    evt.preventDefault()
                    let item = $("#selectallitem").val()
                    let splititem = item.split(",")
                    let itemid = splititem[0]
                    let itemname = splititem[1]
                    $("#patientcardtotal").html("")
                    
                    let getPrescriptionByItemId = "getPrescriptionByItemId"
                    $.post("controllers/combo-setup.php",{itemid:itemid,getPrescriptionByItemId:getPrescriptionByItemId}, function(formdata){
                        console.log(formdata)
                        if(formdata!="No Record Found"){
                            let weight = 0
                            let gender = ""
                            let age = ""
                            // console.log($("#selectpatient").val(), typeof($("#selectpatient").val()))
                            if($("#selectpatient").val()==""||$("#selectpatient").val()==null){
                                
                                gender = $("#selectgender").val()
                                weight = $("#enterweight").val()
                                age = $("#selectage").val()
                                let splitage = age.split(" (")
                                age = splitage[0]
                            } else {
                                gender = $("#patientgender").val()
                                age = $("#agegroup").val()
                                weight = $("#patientweight").val()
                                console.log(age, weight)
                            }
                            let data = JSON.parse(formdata)
                            let prescription = data.records[0].prescription
                           
                            prescriptionlist = JSON.parse(prescription)
                            


                            let prescription_weight = ""
                            let stat_value = false
                            let totalquantity = 0

                            prescriptionlist.forEach(val => {
                                
                                
                                let prescriptionweight = ""
                                let frequency_value = val.frequency
                                let splitfreq = frequency_value.split(",")
                                if(splitfreq[0]=="stat"){
                                    stat_value = true
                                    prescription_weight = val.weight
                                    prescriptionweight= prescription_weight
                                    totalquantity = 0
                                } else {
                                    if( stat_value == true ){
                                        prescriptionweight= prescription_weight
                                    } else {
                                        prescriptionweight = val.weight
                                        totalquantity = 0
                                    }
                                    stat_value = false
                                }

                                
                                
                                 



                                splitweight = prescriptionweight.split(",")

                                let prescriptiongender = splitweight[2]
                                prescriptionweightlist = splitweight[0].split("-")
                                let lowerweightlist = prescriptionweightlist[0].split("Kg")
                                let lowerweight = parseFloat(lowerweightlist[0])
                                let upperweightlist = prescriptionweightlist[1].split("Kg")
                                let upperweight = parseFloat(upperweightlist[0])
                                let selectweight = 0
                                if(weight!=null){
                                    selectweight = parseFloat(weight)
                                }
                                
                                let prescriptionage = splitweight[1]
                                let splitprescriptionagelist = prescriptionage.split(" (")
                                prescriptionage = splitprescriptionagelist[0]

                               
                                

                                if(gender==prescriptiongender){
                                    console.log(age,prescriptionage)
                                    let view = $('input[name="prescriptionview"]:checked').val()
                                    console.log(view)
                                    if(view=="Age"){
                                        if(age==prescriptionage){
                                            let prescriptiontext = val.enterdosage + " " + val.dosage + "x" + val.frequency + "x" + val.enterduration + " " + val.duration
                                            
                                            let duration_value = 1

                                            if(frequency_value.includes("stat")){
                                                duration_value = 1
                                            }
                                            if(val.duration.includes("day")){
                                                duration_value = parseFloat(val.enterduration)
                                                totalquantity = 0
                                            }

                                            let quantity = parseFloat(val.enterdosage) * duration_value
                                            totalquantity = totalquantity + quantity
                                            quantity = totalquantity
                                            if(val.frequency.includes("tds")){
                                                quantity = quantity * 3
                                            } else if(val.frequency.includes("bd")){
                                                quantity = quantity * 2
                                            } else if(val.frequency.includes("qds")){
                                                quantity = quantity * 4
                                            }
                                            let price = parseFloat(data.records[0].sellingprice)
                                            let totalprice = price * quantity
                                            let stockcode = data.records[0].stockcode
                                            let dosageinstruction = data.records[0].dosageinstruction
                                            let administrationinstruction = data.records[0].administrationinstruction
                                            let strength = data.records[0].strength
                                            let interaction = data.records[0].interaction
                                            let itemform = data.records[0].itemformabbreviation
                                            let infusiongivingset = data.records[0].infusiongivingset + " " + data.records[0].infusionconstant
                                            let infusionrate = data.records[0].infusionrate
                                            let department = data.records[0].department
                                            let departmentitemgroup = data.records[0].departmentitemgroup
                                            let gasinfusionconstant = data.records[0].gasinfusionconstant + " " + data.records[0].gasinfusionrate
                                            let unittype = $("#selectunittype").val()
                                            let prescriptionitem = {
                                                "item":itemname,
                                                "itemid":itemid,
                                                "prescription":prescriptiontext,
                                                "route":data.records[0].usageroute,
                                                "unitpricepiece":data.records[0].sellingprice,
                                                "unitpriceweight":data.records[0].sellingpriceperstrength,
                                                "unitpricevolume":data.records[0].sellingpriceperliquidstrength,
                                                "quantity":quantity,
                                                "totalamount":totalprice,
                                                "stockcode":stockcode,
                                                "dosageinstruction":dosageinstruction,
                                                "administrationinstruction":administrationinstruction,
                                                "strength":strength,
                                                "iteminfo":interaction,
                                                "itemform":itemform,
                                                "infusiongivingset":infusiongivingset,
                                                "infusionrate":infusionrate,
                                                "gasinfusionconstant":gasinfusionconstant,
                                                "unittype":unittype
                                            }
                                            prescriptionorderlist.push(prescriptionitem)
                                           
                                            let sellingprice = 0
                                            if(unittype=="pieces"){
                                                sellingprice = parseFloat(data.records[0].sellingprice)
                                            } else if(unittype=="weight"){
                                                sellingprice = parseFloat(data.records[0].sellingpriceperstrength)
                                            } else if(unittype=="volume"){
                                                sellingprice = parseFloat(data.records[0].sellingpriceperliquidstrength)
                                            }
                                            let revenueorderitem = {"genericname":itemname,
                                                                    "department":department,
                                                                    "departmentitemgroup":departmentitemgroup,
                                                                    "sellingprice":sellingprice,
                                                                    "reorderlevel":"reorderlevel",
                                                                    "unittype":unittype,
                                                                    "itemid":itemid,
                                                                    "quantity":quantity}
                                            revenueorderlist.push(revenueorderitem)
                                            displayprescriptionorder(prescriptionorderlist)
                                        }
                                    } else if(view=="Weight"){
                                        console.log(selectweight,lowerweight,upperweight)
                                        console.log(selectweight>lowerweight)
                                        console.log(selectweight<upperweight)
                                        if(selectweight>lowerweight && selectweight<upperweight){
                                            let prescriptiontext = val.enterdosage + " " + val.dosage + "x" + val.frequency + "x" + val.enterduration + " " + val.duration
                                            let duration_value = 1
                                            if(frequency_value.includes("stat")){
                                                duration_value = 1
                                            }else{
                                                duration_value = parseFloat(val.enterduration)
                                                totalquantity = 0
                                            }

                                            let quantity = parseFloat(val.enterdosage) * duration_value
                                            totalquantity = totalquantity + quantity
                                            quantity = totalquantity

                                            if(val.frequency.includes("tds")){
                                                quantity = quantity * 3
                                            } else if(val.frequency.includes("bd")){
                                                quantity = quantity * 2
                                            } else if(val.frequency.includes("qds")){
                                                quantity = quantity * 4
                                            }
                                            let price = parseFloat(data.records[0].sellingprice)
                                            let totalprice = price * quantity
                                            let stockcode = data.records[0].stockcode
                                            let dosageinstruction = data.records[0].dosageinstruction
                                            let administrationinstruction = data.records[0].administrationinstruction
                                            let strength = data.records[0].strength
                                            let interaction = data.records[0].interaction
                                            let itemform = data.records[0].itemformabbreviation
                                            let infusiongivingset = data.records[0].infusiongivingset + " " + data.records[0].infusionconstant
                                            let infusionrate = data.records[0].infusionrate
                                            let department = data.records[0].department
                                            let departmentitemgroup = data.records[0].departmentitemgroup
                                            let gasinfusionconstant = data.records[0].gasinfusionconstant + " " + data.records[0].gasinfusionrate
                                            let unittype = $("#selectunittype").val()
                                            console.log(unittype)
                                            let prescriptionitem = {
                                                "item":itemname,
                                                "itemid":itemid,
                                                "prescription":prescriptiontext,
                                                "route":data.records[0].usageroute,
                                                "unitpricepiece":data.records[0].sellingprice,
                                                "unitpriceweight":data.records[0].sellingpriceperstrength,
                                                "unitpricevolume":data.records[0].sellingpriceperliquidstrength,
                                                "quantity":quantity,
                                                "totalamount":totalprice,
                                                "stockcode":stockcode,
                                                "dosageinstruction":dosageinstruction,
                                                "administrationinstruction":administrationinstruction,
                                                "strength":strength,
                                                "iteminfo":interaction,
                                                "itemform":itemform,
                                                "infusiongivingset":infusiongivingset,
                                                "infusionrate":infusionrate,
                                                "gasinfusionconstant":gasinfusionconstant,
                                                "unittype":unittype
                                            }
                                            prescriptionorderlist.push(prescriptionitem)
                                            let sellingprice = 0
                                            if(unittype=="pieces"){
                                                sellingprice = parseFloat(data.records[0].sellingprice)
                                            } else if(unittype=="weight"){
                                                sellingprice = parseFloat(data.records[0].sellingpriceperstrength)
                                            } else if(unittype=="volume"){
                                                sellingprice = parseFloat(data.records[0].sellingpriceperliquidstrength)
                                            }
                                            let revenueorderitem = {"genericname":itemname,
                                                                    "department":department,
                                                                    "departmentitemgroup":departmentitemgroup,
                                                                    "sellingprice":sellingprice,
                                                                    "reorderlevel":"reorderlevel",
                                                                    "unittype":unittype,
                                                                    "itemid":itemid,
                                                                    "quantity":quantity}
                                            revenueorderlist.push(revenueorderitem)
                                            displayprescriptionorder(prescriptionorderlist)
                                        }
                                    }
                                    
                                    
                                } else {
                                    $("#patientcardtotal").html("<b>No patient selected, <i>please select a patient</i></b>")
                                }
                            });
                        }
                    })
                })

                $("#recall-itemorder-button").on("click", function(evt){
                    evt.preventDefault()
                    let revenueorderid = $("#selectitemorder").val()
                    console.log(patientrevenueorderlist)
                    
                    patientrevenueorderlist.forEach(val => {
                        
                        if(revenueorderid==val.id){
                            let itemorder = val.itemorder
                            let prescriptionorder = val.prescription
                            prescriptionorderlist = JSON.parse(prescriptionorder)
                                                        
                           
                            $("#revenue-order-id").val(val.id)
                            $("#revenue-order-number").val(val.revenueordernumber)
                            displayprescriptionorder(prescriptionorderlist)
                            $("#viewrevenueordernumber").html(val.revenueordernumber)
                            
                            $("#discard-revenue-order-button").show()
                            $("#update-revenue-order-button").show()
                            $("#add-revenue-order-button").hide()
                        }
                    
                    });
                    

                    

                })



                function selectitemanddisplay(selecteditem){
                    
                    let item = selecteditem
                    let splititem = item.split(",")
                    let itemid = splititem[0]
                    let itemname = splititem[1]
                    
                    let getPrescriptionByItemId = "getPrescriptionByItemId"
                    $.post("controllers/combo-setup.php",{itemid:itemid,getPrescriptionByItemId:getPrescriptionByItemId}, function(formdata){
                        console.log(formdata)
                        if(formdata!="No Record Found"){
                            let weight = 0
                            let gender = ""
                            let age = ""
                            // console.log($("#selectpatient").val(), typeof($("#selectpatient").val()))
                            if($("#selectpatient").val()==""||$("#selectpatient").val()==null){
                                
                                gender = $("#selectgender").val()
                                weight = $("#enterweight").val()
                                age = $("#selectage").val()
                                let splitage = age.split(" (")
                                age = splitage[0]
                            } else {
                                gender = $("#patientgender").val()
                               age = $("#agegroup").val()
                                weight = $("#patientweight").val()
                                console.log(age, weight)
                            }
                            let data = JSON.parse(formdata)
                            let prescription = data.records[0].prescription
                           
                            prescriptionlist = JSON.parse(prescription)
                            


                            let prescription_weight = ""
                            let stat_value = false
                            let totalquantity = 0

                            prescriptionlist.forEach(val => {
                                
                                
                                let prescriptionweight = ""
                                let frequency_value = val.frequency
                                let splitfreq = frequency_value.split(",")
                                if(splitfreq[0]=="stat"){
                                    stat_value = true
                                    prescription_weight = val.weight
                                    prescriptionweight= prescription_weight
                                    totalquantity = 0
                                } else {
                                    if( stat_value == true ){
                                        prescriptionweight= prescription_weight
                                    } else {
                                        prescriptionweight = val.weight
                                        totalquantity = 0
                                    }
                                    stat_value = false
                                }

                                
                                
                                 



                                splitweight = prescriptionweight.split(",")

                                let prescriptiongender = splitweight[2]
                                prescriptionweightlist = splitweight[0].split("-")
                                let lowerweightlist = prescriptionweightlist[0].split("Kg")
                                let lowerweight = parseFloat(lowerweightlist[0])
                                let upperweightlist = prescriptionweightlist[1].split("Kg")
                                let upperweight = parseFloat(upperweightlist[0])
                                let selectweight = 0
                                if(weight!=null){
                                    selectweight = parseFloat(weight)
                                }
                                
                                let prescriptionage = splitweight[1]
                                let splitprescriptionagelist = prescriptionage.split(" (")
                                prescriptionage = splitprescriptionagelist[0]

                               
                                

                                if(gender==prescriptiongender){
                                    console.log(age,prescriptionage)
                                    let view = $('input[name="prescriptionview"]:checked').val()
                                    console.log(view)
                                    if(view=="Age"){
                                        if(age==prescriptionage){
                                            let prescriptiontext = val.enterdosage + " " + val.dosage + "x" + val.frequency + "x" + val.enterduration + " " + val.duration
                                            
                                            let duration_value = 1

                                            if(frequency_value.includes("stat")){
                                                duration_value = 1
                                            }
                                            if(val.duration.includes("day")){
                                                duration_value = parseFloat(val.enterduration)
                                                totalquantity = 0
                                            }

                                            let quantity = parseFloat(val.enterdosage) * duration_value
                                            totalquantity = totalquantity + quantity
                                            quantity = totalquantity
                                            if(val.frequency.includes("tds")){
                                                quantity = quantity * 3
                                            } else if(val.frequency.includes("bd")){
                                                quantity = quantity * 2
                                            } else if(val.frequency.includes("qds")){
                                                quantity = quantity * 4
                                            }
                                            let price = parseFloat(data.records[0].sellingprice)
                                            let totalprice = price * quantity
                                            let stockcode = data.records[0].stockcode
                                            let dosageinstruction = data.records[0].dosageinstruction
                                            let administrationinstruction = data.records[0].administrationinstruction
                                            let strength = data.records[0].strength
                                            let interaction = data.records[0].interaction
                                            let itemform = data.records[0].itemformabbreviation
                                            let infusiongivingset = data.records[0].infusiongivingset + " " + data.records[0].infusionconstant
                                            let infusionrate = data.records[0].infusionrate
                                            let department = data.records[0].department
                                            let departmentitemgroup = data.records[0].departmentitemgroup
                                            let gasinfusionconstant = data.records[0].gasinfusionconstant + " " + data.records[0].gasinfusionrate
                                            let unittype = $("#selectunittype").val()
                                            let prescriptionitem = {
                                                "item":itemname,
                                                "itemid":itemid,
                                                "prescription":prescriptiontext,
                                                "route":data.records[0].usageroute,
                                                "unitpricepiece":data.records[0].sellingprice,
                                                "unitpriceweight":data.records[0].sellingpriceperstrength,
                                                "unitpricevolume":data.records[0].sellingpriceperliquidstrength,
                                                "quantity":quantity,
                                                "totalamount":totalprice,
                                                "stockcode":stockcode,
                                                "dosageinstruction":dosageinstruction,
                                                "administrationinstruction":administrationinstruction,
                                                "strength":strength,
                                                "iteminfo":interaction,
                                                "itemform":itemform,
                                                "infusiongivingset":infusiongivingset,
                                                "infusionrate":infusionrate,
                                                "gasinfusionconstant":gasinfusionconstant,
                                                "unittype":unittype
                                            }
                                            prescriptionorderlist.push(prescriptionitem)
                                           
                                            let sellingprice = 0
                                            if(unittype=="pieces"){
                                                sellingprice = parseFloat(data.records[0].sellingprice)
                                            } else if(unittype=="weight"){
                                                sellingprice = parseFloat(data.records[0].sellingpriceperstrength)
                                            } else if(unittype=="volume"){
                                                sellingprice = parseFloat(data.records[0].sellingpriceperliquidstrength)
                                            }
                                            let revenueorderitem = {"genericname":itemname,
                                                                    "department":department,
                                                                    "departmentitemgroup":departmentitemgroup,
                                                                    "sellingprice":sellingprice,
                                                                    "reorderlevel":"reorderlevel",
                                                                    "unittype":unittype,
                                                                    "itemid":itemid,
                                                                    "quantity":quantity}
                                            revenueorderlist.push(revenueorderitem)
                                            displayprescriptionorder(prescriptionorderlist)
                                        }
                                    } else if(view=="Weight"){
                                        console.log(selectweight,lowerweight,upperweight)
                                        console.log(selectweight>lowerweight)
                                        console.log(selectweight<upperweight)
                                        if(selectweight>lowerweight && selectweight<upperweight){
                                            let prescriptiontext = val.enterdosage + " " + val.dosage + "x" + val.frequency + "x" + val.enterduration + " " + val.duration
                                            let duration_value = 1
                                            if(frequency_value.includes("stat")){
                                                duration_value = 1
                                            }else{
                                                duration_value = parseFloat(val.enterduration)
                                                totalquantity = 0
                                            }

                                            let quantity = parseFloat(val.enterdosage) * duration_value
                                            totalquantity = totalquantity + quantity
                                            quantity = totalquantity

                                            if(val.frequency.includes("tds")){
                                                quantity = quantity * 3
                                            } else if(val.frequency.includes("bd")){
                                                quantity = quantity * 2
                                            } else if(val.frequency.includes("qds")){
                                                quantity = quantity * 4
                                            }
                                            let price = parseFloat(data.records[0].sellingprice)
                                            let totalprice = price * quantity
                                            let stockcode = data.records[0].stockcode
                                            let dosageinstruction = data.records[0].dosageinstruction
                                            let administrationinstruction = data.records[0].administrationinstruction
                                            let strength = data.records[0].strength
                                            let interaction = data.records[0].interaction
                                            let itemform = data.records[0].itemformabbreviation
                                            let infusiongivingset = data.records[0].infusiongivingset + " " + data.records[0].infusionconstant
                                            let infusionrate = data.records[0].infusionrate
                                            let department = data.records[0].department
                                            let departmentitemgroup = data.records[0].departmentitemgroup
                                            let gasinfusionconstant = data.records[0].gasinfusionconstant + " " + data.records[0].gasinfusionrate
                                            let unittype = $("#selectunittype").val()
                                            console.log(unittype)
                                            let prescriptionitem = {
                                                "item":itemname,
                                                "itemid":itemid,
                                                "prescription":prescriptiontext,
                                                "route":data.records[0].usageroute,
                                                "unitpricepiece":data.records[0].sellingprice,
                                                "unitpriceweight":data.records[0].sellingpriceperstrength,
                                                "unitpricevolume":data.records[0].sellingpriceperliquidstrength,
                                                "quantity":quantity,
                                                "totalamount":totalprice,
                                                "stockcode":stockcode,
                                                "dosageinstruction":dosageinstruction,
                                                "administrationinstruction":administrationinstruction,
                                                "strength":strength,
                                                "iteminfo":interaction,
                                                "itemform":itemform,
                                                "infusiongivingset":infusiongivingset,
                                                "infusionrate":infusionrate,
                                                "gasinfusionconstant":gasinfusionconstant,
                                                "unittype":unittype
                                            }
                                            prescriptionorderlist.push(prescriptionitem)
                                            let sellingprice = 0
                                            if(unittype=="pieces"){
                                                sellingprice = parseFloat(data.records[0].sellingprice)
                                            } else if(unittype=="weight"){
                                                sellingprice = parseFloat(data.records[0].sellingpriceperstrength)
                                            } else if(unittype=="volume"){
                                                sellingprice = parseFloat(data.records[0].sellingpriceperliquidstrength)
                                            }
                                            let revenueorderitem = {"genericname":itemname,
                                                                    "department":department,
                                                                    "departmentitemgroup":departmentitemgroup,
                                                                    "sellingprice":sellingprice,
                                                                    "reorderlevel":"reorderlevel",
                                                                    "unittype":unittype,
                                                                    "itemid":itemid,
                                                                    "quantity":quantity}
                                            revenueorderlist.push(revenueorderitem)
                                            displayprescriptionorder(prescriptionorderlist)
                                        }
                                    }
                                    
                                    
                                }
                            });
                        }
                    })
                }

                let totalrevenueorderprice = 0
                let totalrevenueorderitems = 0
                function displayprescriptionorder(prescriptionorderlist){
                    console.log(prescriptionorderlist)
                    if(prescriptionorderlist.length>0){
                        let count = 0
                        let totalprice = 0
                        let totalitems = 0
                        let viewprescriptionlist = ``
                        prescriptionorderlist.forEach(element => {
                            let item = element.item
                            let itemid = element.itemid
                            let route = element.route
                            let unitpricepiece = element.unitpricepiece
                            let unitpriceweight = element.unitpriceweight
                            let prescription = element.prescription
                            let unitpricevolume = element.unitpricevolume
                            let totalamount = element.totalamount
                            let stockcode = element.stockcode
                            let dosageinstruction = element.dosageinstruction
                            let administrationinstruction = element.administrationinstruction
                            let strength = element.strength
                            let iteminfo = element.iteminfo
                            let quantity = element.quantity
                            let itemform = element.itemform
                            let infusiongivingset = element.infusiongivingset
                            let infusionrate = element.infusionrate
                            let gasinfusionconstant = element.gasinfusionconstant
                            let unittype = element.unittype

                            let price = 0
                            if(unittype=="pieces"){
                                price = unitpricepiece
                            } else if(unittype=="weight"){
                                price = unitpriceweight
                            } else if(unittype=="volume"){
                                price = unitpricevolume
                            }
                            console.log(unittype,unitpricepiece, unitpriceweight, unitpricevolume, price)
                            
                            let total = parseFloat(price) * parseFloat(quantity)
                            totalitems++
                            totalprice += total
                            totalrevenueorderprice = totalprice
                            totalrevenueorderitems = totalitems
                            
                                viewprescriptionlist += `<tr>
                                                    <td>
                                                        
                                                        <input type="checkbox" style="height: 25px;width:25px;" class="itemselect" data-id="` + count + `">
                                                    </td> 
                                                    <td>` + itemform + " " + item + `</td>
                                                    <td>` + prescription + `</td>
                                                    <td>`+ route + `</td>
                                                    <td>&#8358;`+ Number(price).toFixed(2) + `</td>
                                                    <td>`+ quantity + `</td>
                                                    <td>&#8358;` + Number(total).toFixed(2) + `</td>
                                                    <td>` + stockcode + `</td>
                                                    <td>` + dosageinstruction + `</td>
                                                    <td>`+ administrationinstruction + `</td>
                                                    <td>` + strength + `</td>
                                                    <td>` + iteminfo + `</td>
                                                    <td>`+ infusiongivingset + `</td>
                                                    <td>` + infusionrate + `</td>
                                                    <td>`+ gasinfusionconstant + `</td>
                                                    <td><input type="number" min="1" max="1000" class="multiplyitem" data-id="` + count + `"></td>
                                                    <td><span class="additem" data-id="` + count + `" style="font-size: 16px;"><i class="fa fa-plus-square"></i>
                                                        <span class="subtractitem" data-id="` + count + `" style="font-size: 16px;"><i class="fa fa-minus-square"></i>
                                                            <span class="deleteitem" data-id="` + count + `" style="font-size: 16px;"><i class="fa fa-trash-o"></i></span></td>
                                                </tr>
                                    `
                                    count++
                                });
                                displayselectedlistitems = viewprescriptionlist
                                viewprescriptionlist += `<tr>
                                                    <td></td>
                                                    <td></td>
                                                    <td>` + deptitemgrpitems + `</td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td>
                                                            <span class="additemtolist" style="font-size:24px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                                </tr>`
                                $("#view-revenue-order-list").html(viewprescriptionlist)
                                $("#selectdptitemgrpitem").on("change", function(evt){
                                    evt.preventDefault()
                                    let selecteditem = $("#selectdptitemgrpitem").val()
                                    selectitemanddisplay(selecteditem)

                                })
                                $(".additemtolist").on("click", function(evt){
                                        evt.preventDefault()
                                        let selecteditem = $("#selectdptitemgrpitem").val()
                                        selectitemanddisplay(selecteditem)
                                })
                                $("#view-revenue-order-count").html(totalitems + " Item(s)")
                                $("#view-revenue-order-price").html("Total: &#8358;" + totalprice.toFixed(2))
                                $(".deleteitem").on("click", function(evt){
                                        evt.preventDefault()
                                        let id = $(this).attr("data-id")
                                    
                                        prescriptionorderlist.splice(id, 1)
                                        console.log(id)
                                        
                                        displayprescriptionorder(prescriptionorderlist)

                                    })
                                    $(".itemselect").change(function(){
                                        if($(this).is(":checked")){
                                            
                                            let id = $(this).attr("data-id")
                                            let prescription = prescriptionorderlist[id].prescription
                                            splitprescription = prescription.split("x")
                                            let dosage = splitprescription[0]
                                            let frequency  = splitprescription[1]
                                            let duration = splitprescription[2]
                                            let splitdosage = dosage.split(" ")
                                            $("#enterdosage").val(splitdosage[0])
                                            let splitdosageunit = splitdosage[1].split(",")
                                            let dosageoption = `<option value="` + splitdosageunit[1] + `">` + splitdosageunit[0] + `</option>`
                                            $("#dosage").html(dosageoption + dosagelist)

                                            let splitfrequencyunit = frequency.split(",")
                                            let frequencyoption = `<option value="` + splitfrequencyunit[0] + `">` + splitfrequencyunit[1] + `</option>`
                                            $("#frequency").html(frequencyoption + frequencylist)
                                            
                                            let splitduration = duration.split(" ")
                                            $("#enterduration").val(splitduration[0])
                                            let splitdurationunit = splitduration[1].split(",")
                                            let durationoption = `<option value="` + splitdurationunit[1] + `">` + splitdurationunit[0] + `</option>`
                                            $("#duration").html(durationoption + durationlist)


                                        } 
                                    })
                                
                                $(".multiplyitem").on('change paste', function () {
                                   let qty = $(this).val()

                                    let id = $(this).attr("data-id")
                                
                                    prescriptionorderlist[id].quantity = qty
                                console.log(prescriptionorderlist)
                                    // $("#view-revenue-order-price").html("&#8358;" + totalprice.toFixed(2))

                                    displayprescriptionorder(prescriptionorderlist)

                                })

                                $(".additem").on("click", function(evt){
                                    evt.preventDefault()
                                    let id = $(this).attr("data-id")
                                
                                    prescriptionorderlist[id].quantity = prescriptionorderlist[id].quantity + 1
                                   console.log(prescriptionorderlist)
                                    // $("#view-revenue-order-price").html("&#8358;" + totalprice.toFixed(2))

                                    displayprescriptionorder(prescriptionorderlist)

                                })

                                $(".subtractitem").on("click", function(evt){
                                        evt.preventDefault()
                                        let id = $(this).attr("data-id")
                                    
                                        prescriptionorderlist[id].quantity = prescriptionorderlist[id].quantity -1
                                        if(prescriptionorderlist[id].quantity==0){
                                            prescriptionorderlist.splice(id, 1)
                                        }
                                        
                                        
                                        displayprescriptionorder(prescriptionorderlist)

                                    })
                               
                    } else {
                        displayselectedlistitems = ``
                        $("#view-revenue-order-list").html("")
                        $("#view-revenue-order-count").html("")
                        $("#view-revenue-order-price").html("")
                    }
                }

               
            
                   
                $("#cancel-prescription-order-button").on("click",function(evt){
                    evt.preventDefault()

                    $("#add-prescription-order-button").show()
                    $("#update-prescription-order-button").hide()
                    // $("#cancel-prescription-order-button").hide()
                    prescriptionorderlist = []
                    displayprescriptionorder(prescriptionorderlist)


                })
                $("#add-prescription-order-button").on("click",function(evt){
                    evt.preventDefault()

                    let patientname = ""
                    let patientid = 0
                    let cardnumber = ""
                    let personid = 0
                    let hospitalnumber = ""
                    console.log($("#selectpatient").val())
                    let selectpatient = $("#selectpatient").val()
                    console.log(selectpatient, typeof(selectpatient))
                    hospitalnumber = $("#selectpatientnumber").val()
                       
                     patientname = $("#patientname").val()
                     patientid = parseFloat($("#patientid").val())
                    personid =  $("#personid").val()

                    let insertRevenueOrder = "insertRevenueOrder"
                    let list = JSON.stringify(revenueorderlist)
                    let price = parseFloat(totalrevenueorderprice).toFixed(2)
                    let items = totalrevenueorderitems
                    let department = "PHARMACY DEPARTMENT"
                    
                    console.log(patientid,personid,hospitalnumber,patientname)
                    $.post("controllers/finance-record.php", {department:department,patientname:patientname,patientid:patientid,personid:personid,cardnumber:cardnumber,hospitalnumber:hospitalnumber,price:price,items:totalrevenueorderitems,list:list,insertRevenueOrder:insertRevenueOrder}, function(data){
                        console.log(data)
                        $("#revenue-order-status").html(data)
                        let revenueordernumber = data
                        
                        let insertPrescription = "insertPrescription"
                        let prescriptionlist = JSON.stringify(prescriptionorderlist)
                        // let prescriptionprice = parseFloat(totalrevenueorderprice).toFixed(2)
                        
                        // let department = $("#selectdepartment").val()
                        // let splitdepartment = department.split(",")
                        // let itemdepartment = splitdepartment[1]
                        
                        $.post("controllers/finance-record.php", {revenueordernumber:revenueordernumber,patientname:patientname,patientid:patientid,personid:personid,cardnumber:cardnumber,hospitalnumber:hospitalnumber,price:price,items:totalrevenueorderitems,list:prescriptionlist,insertPrescription:insertPrescription}, function(data){
                            console.log(data)
                            $("#revenue-order-status").html(data)
                            revenueorderlist = []
                            // displayrevenueorder(revenueorderlist)
                            let searchItem = $("#searchrevenueorder").val()
                            getRevenueOrders(searchItem)
                        }) 
                    }) 

                })

                $("#update-prescription-order-button").on("click",function(evt){
                    evt.preventDefault()

                    let patientname = ""
                    let patientid = 0
                    let cardnumber = ""
                    let personid = 0
                    let hospitalnumber = ""
                    console.log($("#selectpatient").val())
                    let selectpatient = $("#selectpatient").val()
                    console.log(selectpatient, typeof(selectpatient))
                    hospitalnumber = $("#selectpatientnumber").val()
                       
                       patientname = $("#patientname").val()
                       patientid = parseFloat($("#patientid").val())
                      personid =  $("#personid").val()
                    let id = $("#prescriptionorderid").val()
                    let price = parseFloat(totalrevenueorderprice).toFixed(2)
                    let items = totalrevenueorderitems
                    let department = "PHARMACY DEPARTMENT"
                    
                    let updatePrescription = "updatePrescription"
                    let prescriptionlist = JSON.stringify(prescriptionorderlist)
                    let revenuelist = JSON.stringify(revenueorderlist)
                    // let prescriptionprice = parseFloat(totalrevenueorderprice).toFixed(2)
                    let prescriptionnumber = $("#viewrevenueordernumber").val()
                    let revenueordernumber = $("#revenue-order-number").val()
                    // let department = $("#selectdepartment").val()
                    // let splitdepartment = department.split(",")
                    // let itemdepartment = splitdepartment[1]
                    // console.log(patientname,revenueordernumber)
                    $.post("controllers/finance-record.php", {id:id,revenuelist:revenuelist,revenueordernumber:revenueordernumber,prescriptionnumber:prescriptionnumber,patientname:patientname,patientid:patientid,personid:personid,hospitalnumber:hospitalnumber,price:price,items:totalrevenueorderitems,list:prescriptionlist,updatePrescription:updatePrescription}, function(data){
                        console.log(data)
                        $("#revenue-order-status").html(data)
                        $("#add-prescription-order-button").show()
                        $("#update-prescription-order-button").hide()
                        // $("#cancel-prescription-order-button").hide()
                        prescriptionorderlist = []
                        displayprescriptionorder(prescriptionorderlist)
                        let searchItem = $("#searchrevenueorder").val()
                        getRevenueOrders(searchItem)
                    }) 
                

                })


                $("#clear-patient-prescription").on("click", function(evt){
                    evt.preventDefault()


                    $("#selectpatient").html("")
                    $("#form-edit-patient").html("")
                    $("#form-view-patientstatus").html("")
                    $("#form-view-patient").html("")
                    
                    $("#selectpatientnumber").val("")
                    $("#patientid").val("0")
                    $("#patientname").val("")
                 
                    $("#personid").val("0")
                    $("#patientweight").val("")
                    $("#patientgender").val("")
                    $("#agegroup").val("")
                    recallprescriptionlist = []
                    $("#selectprescription").hide()
                })

                let recallprescriptionlist = []
                $("#selectprescription").hide()

                function recallPrescription(){
                    let patientnumber = $("#selectpatientnumber").val()
                    console.log(patientnumber)
                    let getPrescriptionOrderByPatientNumber = "getPrescriptionOrderByPatientNumber"
                    $.post("controllers/finance-record.php", {patientnumber:patientnumber, getPrescriptionOrderByPatientNumber: getPrescriptionOrderByPatientNumber}, function(data){
                        console.log(data)
                        formdata=JSON.parse(data)
                        recallprescriptionlist = formdata.records
                        let prescription = recallprescriptionlist[0].prescription
                        revenueorderlist = JSON.parse(prescription)
                        $("#patientid").val(recallprescriptionlist[0].patientid)
                        $("#patientname").val(recallprescriptionlist[0].patientname)
                        $("#prescriptionorderid").val(recallprescriptionlist[0].id)
                        $("#revenue-order-number").val(recallprescriptionlist[0].revenueordernumber)
                        let prescriptionlist = recallprescriptionlist[0].prescription
                        displayprescriptionorder(revenueorderlist)
                        prescriptionorderlist = revenueorderlist

                        let revenueorder = recallprescriptionlist[0].revenueorder
                        revenueorderlist = JSON.parse(revenueorder)


                        $("#viewrevenueordernumber").html(recallprescriptionlist[0].prescriptionnumber)
                        
                        $("#add-prescription-order-button").hide()
                        $("#update-prescription-order-button").show()
                        // $("#cancel-prescription-order-button").show()

                        let selectprescriptionlist = ``
                        let count = 0
                        recallprescriptionlist.forEach(val => {
                            selectprescriptionlist += `<option value="` + count + `">` + val.prescriptionnumber + ` (` + val.entereddate + `)</option>`
                            count++
                        });
                        $("#selectprescription").html(selectprescriptionlist)
                        $("#selectprescription").show()
        
                    })
                }

                $("#recall-prescription-button").on("click", function(evt){
                    evt.preventDefault()

                    let patientnumber = $("#selectpatientnumber").val()
                    console.log(patientnumber)
                    let getPrescriptionOrderByPatientNumber = "getPrescriptionOrderByPatientNumber"
                    $.post("controllers/finance-record.php", {patientnumber:patientnumber, getPrescriptionOrderByPatientNumber: getPrescriptionOrderByPatientNumber}, function(data){
                        console.log(data)
                        formdata=JSON.parse(data)
                        recallprescriptionlist = formdata.records
                        let prescription = recallprescriptionlist[0].prescription
                        revenueorderlist = JSON.parse(prescription)
                        $("#patientid").val(recallprescriptionlist[0].patientid)
                        $("#patientname").val(recallprescriptionlist[0].patientname)
                        $("#prescriptionorderid").val(recallprescriptionlist[0].id)
                        $("#revenue-order-number").val(recallprescriptionlist[0].revenueordernumber)
                        let prescriptionlist = recallprescriptionlist[0].prescription
                        displayprescriptionorder(revenueorderlist)
                        prescriptionorderlist = revenueorderlist

                        let revenueorder = recallprescriptionlist[0].revenueorder
                        revenueorderlist = JSON.parse(revenueorder)


                        $("#viewrevenueordernumber").html(recallprescriptionlist[0].prescriptionnumber)
                        
                        $("#add-prescription-order-button").hide()
                        $("#update-prescription-order-button").show()
                        // $("#cancel-prescription-order-button").show()

                        let selectprescriptionlist = ``
                        let count = 0
                        recallprescriptionlist.forEach(val => {
                            selectprescriptionlist += `<option value="` + count + `">` + val.prescriptionnumber + ` (` + val.entereddate + `)</option>`
                            count++
                        });
                        $("#selectprescription").html(selectprescriptionlist)
                        $("#selectprescription").show()
        
                    })

                })

                $("#selectprescription").on("change", function(evt){
                    evt.preventDefault()
                    let id = $(this).val()
                    let prescription = recallprescriptionlist[id].prescription
                        revenueorderlist = JSON.parse(prescription)
                        $("#patientid").val(recallprescriptionlist[id].patientid)
                        $("#patientname").val(recallprescriptionlist[id].patientname)
                        $("#prescriptionorderid").val(recallprescriptionlist[id].id)
                        $("#revenue-order-number").val(recallprescriptionlist[id].revenueordernumber)
                        let prescriptionlist = recallprescriptionlist[id].prescription
                        displayprescriptionorder(revenueorderlist)
                        prescriptionorderlist = revenueorderlist

                        let revenueorder = recallprescriptionlist[id].revenueorder
                        revenueorderlist = JSON.parse(revenueorder)

                        $("#viewrevenueordernumber").html(recallprescriptionlist[id].prescriptionnumber)
                        
                        $("#add-prescription-order-button").hide()
                        $("#update-prescription-order-button").show()
                        // $("#cancel-prescription-order-button").show()

                })

                $("#clear-package-button").on("click", function(evt){
                    evt.preventDefault()

                    prescriptionlist = []
                    displayprescriptionorder(prescriptionlist)
                })

                $("#save-package-button").on("click", function(evt){
                    evt.preventDefault()
                    $(".itemselect").each(function(index, obj){
                        if($(this).prop('checked')==true){
                            
                            let id = $(this).attr("data-id")
                            let prescription = prescriptionorderlist[id].prescription
                            let unittype = prescriptionorderlist[id].unittype
                            let sellingprice = 0
                            if(unittype=="pieces"){
                                sellingprice = parseFloat(prescriptionorderlist[id].unitpricepiece)
                            } else if(unittype=="volume"){
                                sellingprice = parseFloat(prescriptionorderlist[id].unitpricevolume)
                            } else if(unittype=="weight"){
                                sellingprice = parseFloat(prescriptionorderlist[id].unitpriceweight)
                            }
                            let frequency = $("#frequency").val()
                            let enterdosage = $("#enterdosage").val()
                            let enterduration = $("#enterduration").val()
                            let prescriptiontext = $("#enterdosage").val() + " " + $("#dosage").val() + "x" + frequency + "x" + $("#enterduration").val() + " " + $("#duration").val()
                            let quantity = parseFloat(enterdosage) * parseFloat(enterduration)
                            if(frequency.includes("tds")){
                                quantity = quantity * 3
                            } else if(frequency.includes("bd")){
                                quantity = quantity * 2
                            } else if(frequency.includes("qds")){
                                quantity = quantity * 4
                            }
                            let price = parseFloat(sellingprice)
                            let totalprice = price * quantity
                            prescriptionorderlist[id].prescription = prescriptiontext
                            prescriptionorderlist[id].quantity = quantity
                            prescriptionorderlist[id].totalamount = totalprice
                            displayprescriptionorder(prescriptionorderlist)

                            revenueorderlist[id].quantity = quantity

                           
                        }
                       
                    })
                })
                let searchItems = $("#searchrevenueorder").val()
                getRevenueOrders(searchItems)
                $("#searchrevenueorder").on('change keyup paste', function () {
                    ApplyFilterGetItem();
                });

                function ApplyFilterGetItem() {
                    var searchitemservice = $("#searchrevenueorder").val();
                    console.log("getRevenueOrders")
                    getRevenueOrders(searchitemservice)
                }
                function getRevenueOrders(search){
                    $("#add-prescription-order-button").show()
                    $("#discard-prescription-order-button").hide()
                    $("#update-prescription-order-button").hide()
                    $("#viewrevenueordernumber").html("New Prescription Order")
                    let searchItem = search
                    getPrescriptionOrder = "getPrescriptionOrder"
                    $.post("controllers/finance-record.php",{searchItem:searchItem,getPrescriptionOrder: getPrescriptionOrder},function(formdata){
                        console.log("prescription: ",searchItem,formdata)
                        if(formdata=="No Record Found"){
                            $("#view-item-order-count").html(formdata)
                        }else{
                            console.log(formdata)
                            console.log(typeof(formdata))
                            let data=JSON.parse(formdata)
                            console.log(data)
                            let count = 0
                                
                            let totalrecord = ``
                            $.each(data.records, function(key, val) {
                                count++
                                
                            totalrecord += `
                                <tr>
                                   
                                    <td>
                                        
                                        <a href="#" data-id="` + val.id + `" class="btn btn-outline-default take-btn itemordername"><h3 style="color:blue;">` + val.prescriptionnumber + `</h3></a>
                                    </td>                 
                                    <td>
                                            <p style="font-size:18px;font-weight:bold;">` + val.patientname + ` [` + val.hospitalnumber + `]</p>
                                    </td> 
                                    
                                    <td>
                                            <p style="font-size:18px;font-weight:bold;">` + val.entereddate + `</p>
                                    </td> 
                                    <td>
                                            <p style="font-size:18px;font-weight:bold;">&#8358;` + (parseFloat(val.totalamount)).toFixed(2) + `</p>
                                    </td> 
                                    
                                    <td>
                                            <p style="font-size:18px;font-weight:bold;">` + val.enteredby + ` (Updated ` + val.updateddate + `)</p>
                                    </td> 
                                    
                                    <td>
                                        <a href="#" data-id="` + val.id + `" class="btn btn-outline-danger take-btn delete-revenue-order">Delete</a>
                                    </td> 
                                </tr>
                            `
                            })
                            $("#view-item-order-count").html(count + " Record(s) Found")
                            $("#view-all-revenue-order-list").html(totalrecord)
                            totalpaiditems = 0
                            totalpaid = 0
                        }
                        

                            $(".itemordername").on("click", function(evt){
                                evt.preventDefault()
                                let id = $(this).attr("data-id")
                                let getPrescriptionOrderById = "getPrescriptionOrderById"
                                $.post("controllers/finance-record.php", {id:id, getPrescriptionOrderById: getPrescriptionOrderById}, function(data){
                                    console.log(data)
                                    formdata=JSON.parse(data)
                                    let prescription = formdata.prescription
                                    revenueorderlist = JSON.parse(prescription)
                                    $("#patientid").val(formdata.patientid)
                                    $("#patientname").val(formdata.patientname)
                                    $("#prescriptionorderid").val(formdata.id)
                                    $("#revenue-order-number").val(formdata.revenueordernumber)
                                    let prescriptionlist = formdata.prescription
                                    displayprescriptionorder(revenueorderlist)
                                    prescriptionorderlist = revenueorderlist

                                    let revenueorder = formdata.revenueorder
                                    revenueorderlist = JSON.parse(revenueorder)

                                    $("#viewrevenueordernumber").html(formdata.prescriptionnumber)
                                    
                                    $("#add-prescription-order-button").hide()
                                    $("#update-prescription-order-button").show()
                                    // $("#cancel-prescription-order-button").show()
                   
                                })
                                
                            })

                        $(".delete-revenue-order").on("click", function(evt){
                            evt.preventDefault()
                                let id = $(this).attr("data-id")
                                let DeletePrescriptionOrderById = "DeletePrescriptionOrderById"
                                $.post("controllers/finance-record.php", {id:id, DeletePrescriptionOrderById: DeletePrescriptionOrderById}, function(data){
                                    console.log(data)
                                    $("#revenue-order-status").html(data)
                                    let searchItem = $("#searchrevenueorder").val()
                                    getRevenueOrders(searchItem)
                                })
                                
                        })
                    })
                    
                }

       })
   </script>
</body>

</html>