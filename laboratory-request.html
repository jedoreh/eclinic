<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>medical</title>
    <link rel="icon" href="img/favicon.png">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- animate CSS -->
    <link rel="stylesheet" href="css/animate.css">
    <!-- owl carousel CSS -->
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <!-- themify CSS -->
    <link rel="stylesheet" href="css/themify-icons.css">
    <!-- flaticon CSS -->
    <link rel="stylesheet" href="css/flaticon.css">
    <!-- magnific popup CSS -->
    <link rel="stylesheet" href="css/magnific-popup.css">
    <!-- nice select CSS -->
    <!-- <link rel="stylesheet" href="css/nice-select.css"> -->
    <!-- swiper CSS -->
    <link rel="stylesheet" href="css/slick.css">
    <!-- style CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <!--::header part start::-->
    <header class="main_menu">
            
        </header>
        <!-- Header part end-->
       
    <!-- breadcrumb start-->
    <section class="breadcrumb breadcrumb_bg">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcrumb_iner">
                        <div class="form-row">
                            <div class="form-group col-md-2">
                                <span id="username" style="color:#F1F1F1;font-size: 17px;"></span>
                            </div>
                            <div class="form-group col-md-6">
                                <span id="pagetitle" style="color:#F1F1F1;font-size: 20px;font-weight: bolder;">Laboratory Ordering</span>
                            </div>
                            <div class="form-group col-md-2">
                                <span id="sysdate" style="color:#F1F1F1"></span>
                            </div>
                            <div class="form-group col-md-2">
                                <span id="systime" style="color:#F1F1F1"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- breadcrumb start-->

    

    <!--::regervation_part start::-->
    <section class="regervation_part padding_bottom" style="margin-top:30px;">
        <div class="container">
            <div class="row align-items-center regervation_content">
                <div class="col-md-12">
                    <div class="regervation_part_iner">
                        <br>
                        <form action="controllers/add-staff.php" class="frmaddperson">
                            <!-- <h2>Laboratory Ordering</h2> -->
                            <div class="label label-success" id="errorlogin"></div>
                            <div class="form-row">
                                
                            </div>
                            
                        </form>
                    </div>
                    <div class="card-box">
                        <ul class="nav nav-tabs nav-tabs-solid nav-tabs-rounded nav-justified">
                            <!-- <li class="nav-item"><a class="nav-link btn-primary active" href="#solid-rounded-justified-tab6" data-toggle="tab">Sex</a></li> -->
                            <!-- <li class="nav-item"><a class="nav-link btn-primary active" href="#solid-rounded-justified-tab3" data-toggle="tab">Laboratory Ordering</a></li>  -->
                            <!-- <li class="nav-item"><a class="nav-link btn-primary" href="#solid-rounded-justified-tab7" data-toggle="tab">Weight</a></li>
                            <li class="nav-item"><a class="nav-link btn-primary" href="#solid-rounded-justified-tab8" data-toggle="tab">Frequency</a></li>
                            <li class="nav-item"><a class="nav-link btn-primary" href="#solid-rounded-justified-tab4" data-toggle="tab">Duration</a></li>
                            <li class="nav-item"><a class="nav-link btn-primary" href="#solid-rounded-justified-tab23" data-toggle="tab">Routes</a></li>
                            <li class="nav-item"><a class="nav-link btn-primary" href="#solid-rounded-justified-tab9" data-toggle="tab">Dosage Unit</a></li> -->
                            <!-- <li class="nav-item dropdown">
                                <a href="#" class="dropdown-toggle nav-link" data-toggle="dropdown">Stocking Setup</a>
                                <div class="dropdown-menu dropdown-menu-right">
                                    <a class="dropdown-item" href="#solid-rounded-justified-tab2" data-toggle="tab">Route of Administration</a>
                                    <a class="dropdown-item" href="#solid-rounded-justified-tab3" data-toggle="tab">Category of Importance</a>
                                    <a class="dropdown-item" href="#solid-rounded-justified-tab4" data-toggle="tab">Stock Location</a>
                                    <a class="dropdown-item" href="#solid-rounded-justified-tab5" data-toggle="tab">Physical Position</a> 
                                </div>
                            </li> -->
                            <!-- <li class="nav-item"><a class="nav-link" href="#solid-rounded-justified-tab3" data-toggle="tab">Department Item Group</a></li>
                            <li class="nav-item"><a class="nav-link" href="#solid-rounded-justified-tab4" data-toggle="tab">Generic Name</a></li> -->
                            <!-- <li class="nav-item"><a class="nav-link" href="#solid-rounded-justified-tab5" data-toggle="tab">State</a></li>
                            <li class="nav-item"><a class="nav-link" href="#solid-rounded-justified-tab6" data-toggle="tab">Default Strength</a></li> -->
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane show active" id="solid-rounded-justified-tab3">
                                <br>
                                <!-- <h3>Sex</h3> -->
                                <div class="container">
                                    <div class="row">
                                        <div class="col-12">
                                            
                                            <form action="controllers/index.php" class="form-signin">
                                                <!-- <h2>Laboratory Order</h2> -->
                                                <div class="label label-success" id="revenue-order-status"></div>
                                                <div class="form-row">
                                                    <div class="form-group col-md-2">
                                                        Search Patient:<br>
                                                        <input type="text" name="searchpatient" class="form-control" id="searchpatient" placeholder="Search Patients" required>
                                                    </div>
                                                    <div class="form-group col-md-4">
                                                        Select Patient:<br>
                                                        <select type="text" name="selectpatient" class="form-control" id="selectpatient"></select>
                                                    </div>
                                                    <div class="form-group col-md-3" style="font-size: 20px;">
                                                        HOSPITAL No.:<br>
                                                        <div class="form-patientinfo-hospitalno" id="form-patientinfo-hospitalno"></div>
                                                    </div>
                                                    <div class="form-group col-md-1" style="font-size: 20px;">
                                                        SEX:<br>
                                                        <div class="form-patientinfo-sex" id="form-patientinfo-sex"></div>
                                                    </div>
                                                    <div class="form-group col-md-1" style="font-size: 20px;">
                                                        AGE:<br>
                                                        <div class="form-patientinfo-age" id="form-patientinfo-age"></div>
                                                    </div>
                                                    <div class="form-group col-md-1" style="font-size: 20px;">
                                                        WEIGHT:<br>
                                                        <div class="form-patientinfo-weight" id="form-patientinfo-weight"></div>
                                                    </div>

                                                    <input type="hidden" id="patientid" value="0">
                                                    <input type="hidden" id="patientname" value="">
                                                    <input type="hidden" id="personid" value="0"> 
                                                    <input type="hidden" id="selectpatientnumber" value="">
                                                    <div class="form-patientinfo-sex"></div>
                                                    
                                                </div>
                                                <div class="form-row">
                                                    <div class="col-12">
                                                        <!-- <h2>Item Order</h2> -->
                                                    </div>
                                                    <div class="col-6">
                                                        Item Order Number:<br>
                                                        <select name="selectitemorder" class="form-control" id="selectitemorder"></select>
                                                    </div>
                                                    <div class="col-4">
                                                        Recall Item Order:<br>
                                                        <select name="selectitemlist" class="form-control" id="selectitemlist"></select>
                                                    </div>
                                                    <div class="col-2">
                                                        <br>
                                                        <button type="submit" class="genric-btn success" id="recall-itemorder-button" style="font-size: 24px;border-radius: 8px;">Refill</button>
                                                    </div>
                                                </div>
                                                <div class="form-row">
                                                    
                                                    
                                                        <div class="form-group col-md-2">
                                                            Search All Items:<br>
                                                            <input type="text" id="searchitems" name="searchitems" class="form-control">
                                                            
                                                        </div>
                                                        <div class="form-group col-md-3">
                                                            Select Group:<br>
                                                            <select name="selectusagegroup" id="selectusagegroup" class="form-control" required>
    
                                                            </select>
                                                        </div>
                                                        <div class="form-group col-md-3">
                                                            Select Class:<br>
                                                            <select name="selectusageclass" id="selectusageclass" class="form-control" required>
    
                                                            </select>
                                                        </div>
                                                        <div class="form-group col-md-3">
                                                            Select SubClass:<br>
                                                            <select name="selectusagesubclass" id="selectusagesubclass" class="form-control" required>
    
                                                            </select>
                                                        </div>
                                                        <div class="form-group col-md-8">
                                                            Select Lab Test:<br>
                                                            <select id="selectallitem" name="selectallitem" class="form-control"></select>
                                                            
                                                        </div>
                                                        <!-- <div class="form-group col-md-12">
                                                            Select Unit Type:<br>
                                                            <select id="selectunittype" name="selectunittype" class="form-control">
                                                                <option value="pieces">Pieces/Service</option>
                                                                <option value="weight">Weight</option>
                                                                <option value="volume">Volume</option>
                                                            </select>
                                                            
                                                        </div> -->
                                                       
                                                        <div class="form-group col-md-4">
                                                            <br>
                                                            <button type="submit" class="genric-btn primary" id="add-allitem-button" style="font-size: 24px;border-radius: 8px;">Add Item</button>
                                                           
                                                        </div>
                                                        <div class="form-edit-item"></div>
                                                    
                                                </div>
                                                <div class="form-row">
                                                    <div class="form-group col-md-2">
                                                        Search Regiment:<br>
                                                        <input type="text" id="searchregiment" name="searchregiment" class="form-control">
                                                        
                                                    </div>
                                                    <div class="form-group col-md-4">
                                                        Select Regiment:<br>
                                                        <select name="selectregiment" id="selectregiment" class="form-control" required>

                                                        </select>
                                                    </div>
                                                    <div class="form-group col-md-3">
                                                        <br>
                                                        <button type="submit" class="genric-btn success" id="add-regiment-button" style="font-size: 24px;border-radius: 8px;">Add Regiment</button>
                                                    
                                                    </div>
                                                    <div class="form-group col-md-3">
                                                        <br>

                                                        <p class="btn btn-primary float-right" id="view-revenue-order-price" style="font-size: 24px;"></p>
                                                
                                                    </div>
                                                </div>
                                            </form>
                                            
                                        </div>
                                        <div class="col-12">
                                           
                                            <div class="card">
                                                <div class="card-header">
                                                    <h4 class="card-title d-inline-block">View Lab Order: <span id="viewrevenueordernumber"></span></h4>  <p class="btn btn-primary float-right" id="view-revenue-order-count"></p>
                                                    <!-- <p class="float-right"><input type="text" id="searchsex" name="searchsex" placeholder="Search Sex" style="font-size: 18px;"></p> -->
                                                </div>
                                                <div class="card-body p-0">
                                                    <div class="table-responsive">
                                                        <table class="table">
                                                            <thead>
                                                                <tr>
                                                                    <th><span style="cursor: pointer;" class="checkallitem" id="selectallitems">Select All</span></th>
                                                                    <th>Lab Request</th>
                                                                    <th>Specimen</th>
                                                                    <th>Sample Collection</th>
                                                                    <th>Unit Price</th>
                                                                    <th>Total Prescribed Qty</th>
                                                                    <th>Total Amount</th>
                                                                    
                                                                    <th>Item Info</th>
                                                                    
                                                                    <th>x</th>
                                                                    <th>Action</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody id="view-revenue-order-list">
                                                                
                                                                
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                        </div>
                                        <div class="col-12">
                                            
                                            <div class="card">
                                                <div class="card-header">
                                                    <button type="submit" class="genric-btn primary" id="add-prescription-order-button" style="font-size: 24px;border-radius: 8px;">Submit Laboratory Order</button>
                                                    <button type="submit" class="genric-btn success" id="discard-prescription-order-button" style="font-size: 24px;border-radius: 8px;">Cancel</button>
                                                    <button type="submit" class="genric-btn primary" id="update-prescription-order-button" style="font-size: 24px;border-radius: 8px;">Update</button>
                                                    <button type="submit" class="genric-btn danger" id="cancel-prescription-order-button" style="font-size: 24px;border-radius: 8px;">Clear Prescription</button>
                                                     
                                                    <!-- <p class="float-right"><input type="text" id="searchsex" name="searchsex" placeholder="Search Sex" style="font-size: 18px;"></p> -->
                                                </div>
                                                <input type="hidden" id="patientid" value="0">
                                                <input type="hidden" id="patientname" value="">
                                                <input type="hidden" id="revenue-order-number" value="">
                                                <input type="hidden" id="prescriptionorderid" value="">
                                            </div>
                                        </div>
                                        
                                        <div class="col-12">
                                            
                                            <div class="card">
                                                <div class="card-header">
                                                    <h4 class="card-title d-inline-block">View Laboratory Orders</h4>  <p class="btn btn-primary float-right" id="view-item-order-count"></p>
                                                    <p class="float-right"><input type="text" id="searchrevenueorder" name="searchrevenueorder" placeholder="Search Revenue Order" style="font-size: 18px;"></p>
                                                </div>
                                                <div class="card-body p-0">
                                                    <div class="table-responsive scrollable">
                                                        <table class="table">
                                                            <thead>
                                                                <tr>
                                                                    <th>Number</th>
                                                                    <th>Patient</th>
                                                                    <th>Date</th>
                                                                    <th>Total Price</th>
                                                                    <th>Staff</th>
                                                                    
                                                                    <th>Action</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody id="view-all-revenue-order-list">
                                                                
                                                                
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- <div class="col-lg-5 col-md-6">
                    <div class="reservation_img">
                        <img src="img/loginphoto.jpg" alt="">
                    </div>
                </div> -->
            </div>
        </div>
    </section>
    <!--::regervation_part end::-->

    
    <!-- footer part start-->
    <footer class="footer-area">

        <div class="copyright_part">
            
        </div>
    </footer>

    <!-- footer part end-->

    <!-- jquery plugins here-->

    <script src="js/jquery-1.12.1.min.js"></script>
    <!-- popper js -->
    <script src="js/popper.min.js"></script>
    <!-- bootstrap js -->
    <script src="js/bootstrap.min.js"></script>
    <!-- easing js -->
    <script src="js/jquery.magnific-popup.js"></script>
    <!-- swiper js -->
    <script src="js/swiper.min.js"></script>
    <!-- swiper js -->
    <script src="js/masonry.pkgd.js"></script>
    <!-- particles js -->
    <script src="js/owl.carousel.min.js"></script>
    <!-- <script src="js/jquery.nice-select.min.js"></script> -->
    <!-- swiper js -->
    <script src="js/slick.min.js"></script>
    <script src="js/jquery.counterup.min.js"></script>
    <script src="js/waypoints.min.js"></script>
    <!-- contact js -->
    <script src="js/jquery.ajaxchimp.min.js"></script>
    <script src="js/jquery.form.js"></script>
    <script src="js/jquery.validate.min.js"></script>
    <script src="js/mail-script.js"></script>
    <script src="js/contact.js"></script>
    <!-- custom js -->
    <script src="js/custom.js"></script>
    <script src="views/masterpage.js"></script>
    <script src="views/records.js"></script>
    <script>
        $(document).ready(function(){
             // get departments
             let departmentitemgrouplist = ``
            let departmentlist = ``
            
            let getDepartment = "getDepartment"
            let searchItem = ""

            let deptitemgrpitems = ``
            let displayselectedlistitems = ``

            $("#selectdepartment").on("change", function(evt){
                     evt.preventDefault()
                    //  let department = $("#selectdepartment").val()
                     let department = $("#selectdepartment").val()
                    let splitsearch = department.split(",")
                    department = splitsearch[1]
                        let getDepartmentItemGroupByDepartment = "getDepartmentItemGroupByDepartment"
                        $.post("controllers/combo-setup.php",{department:department,getDepartmentItemGroupByDepartment:getDepartmentItemGroupByDepartment}, function(formdata){
                            if(formdata!="No Record Found"){
                                let data = JSON.parse(formdata)
                                let departmentitemgroupoptions = ``
                                $.each(data.records, function(key, val){
                                    departmentitemgroupoptions += `
                                    <option value="` + val.departmentitemgroup + `">` + val.departmentitemgroup + `</option>
                                    `
                                })
                                departmentitemgrouplist = departmentitemgroupoptions
                                $("#selectdepartmentitemgrouping").html(departmentitemgroupoptions)
                                let departmentitemgroup = $("#selectdepartmentitemgrouping").val()
                                let GetGenericNameByDepartmentItemGrouping = "GetGenericNameByDepartmentItemGrouping"
                                $.post("controllers/combo-setup.php",{searchItem:departmentitemgroup,GetGenericNameByDepartmentItemGrouping:GetGenericNameByDepartmentItemGrouping}, function(formdata){
                                    if(formdata!="No Record Found"){
                                        
                                        let data = JSON.parse(formdata)
                                        let itemoptions = ``
                                        deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                                        $.each(data.records, function(key, val){
                                            itemoptions += `
                                            <option value=" ` + val.id + `,` + val.itemgenericname + `">` + val.tradename + " (" + val.itemgenericname + `)</option>
                                            `
                                            deptitemgrpitems += `
                                            <option value="` + val.id + `,` + val.itemgenericname + `">` + val.tradename + " (" + val.itemgenericname + `)</option>
                                            `
                                        })
                                        deptitemgrpitems += `</select>`
                                        // departmentitemgrouplist = departmentitemgroupoptions
                                        $("#selectitem").html(itemoptions)

                                        let pricinglist = displayselectedlistitems + `<tr>
                                                    <td>` + deptitemgrpitems + `</td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td>
                                                            <span class="additemtolist" style="font-size:18px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                                </tr>`
                                        $("#view-revenue-order-list").html(pricinglist)
                                        $("#selectdptitemgrpitem").on("change", function(evt){
                                            evt.preventDefault()
                                            let selecteditem = $("#selectdptitemgrpitem").val()
                                            selectitemanddisplay(selecteditem)

                                        })
                                        $(".additemtolist").on("click", function(evt){
                                                evt.preventDefault()
                                                let selecteditem = $("#selectdptitemgrpitem").val()
                                                selectitemanddisplay(selecteditem)
                                        })
                                        
                                    }

                                })

                                // let deptItemgroup = $("#selectdepartmentitemgrouping").val()
                                let getDeptItemGrpUsageGroup = "getDeptItemGrpUsageGroup"
                                $.post("controllers/combo-setup.php",{searchItem:departmentitemgroup,getDeptItemGrpUsageGroup:getDeptItemGrpUsageGroup}, function(formdata){
                                    if(formdata!="No Record Found"){
                                        let data = JSON.parse(formdata)
                                        let itemgroupoptions = ``
                                        $.each(data.records, function(key, val){
                                            itemgroupoptions += `
                                            <option value="` + val.itemgroup + `">` + val.itemgroup + `</option>
                                            `
                                        })
                                        genericnameusagegrouplist = itemgroupoptions
                                        $("#selectusagegroup").html(itemgroupoptions)
                                        
                                        //$("#selectformdepartmentitemgroup").html(departmentitemgroupoptions)
                                        let selectgroup = $("#selectusagegroup").val()
                                        let getItemClassByItemGroup = "getItemClassByItemGroup"
                                        $.post("controllers/combo-setup.php",{searchItem:selectgroup,getItemClassByItemGroup:getItemClassByItemGroup},function(formdata){
                                            console.log(formdata)
                                            let data = JSON.parse(formdata)
                                            let genericnameclassoptions = ``
                                            $.each(data.records, function(key, val) {
                                            
                                                genericnameclassoptions += `
                                                <option value="` + val.itemclass + `">` + val.itemclass + `</option>
                                                `
                                            })
                                            genericnameusageclasslist = genericnameclassoptions
                                            $("#selectusageclass").html(genericnameclassoptions)
                                            let selectsubclassclass = $("#selectusageclass").val()
                                            let getItemSubClassByClass = "getItemSubClassByClass"
                                            $.post("controllers/combo-setup.php",{selectsubclassclass:selectsubclassclass,getItemSubClassByClass:getItemSubClassByClass},function(formdata){
                                                console.log(formdata)
                                                let data = JSON.parse(formdata)
                                                let genericnamesubclassoptions = `<option value="">Select Sub Class</option>`
                                                $.each(data.records, function(key, val) {
                                                
                                                    genericnamesubclassoptions += `
                                                    <option value="` + val.itemsubclass + `">` + val.itemsubclass + `</option>
                                                    `
                                                })
                                                genericnameusagesubclasslist = genericnamesubclassoptions
                                                $("#selectusagesubclass").html(genericnamesubclassoptions)
                                                let searchItem = $("#searchitems").val()
                                                let selectsubclass = $("#selectusagesubclass").val()
                                                let GetGenericNameByUsageLABSubClass = "GetGenericNameByUsageLABSubClass"
                                                $.post("controllers/combo-setup.php",{searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByUsageLABSubClass:GetGenericNameByUsageLABSubClass},function(formdata){
                                                    console.log(formdata)
                                                    if(formdata!="No Record Found"){
                                                        let data = JSON.parse(formdata)
                                                        let genericnameoptions = ``
                                                        deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                                                        $.each(data.records, function(key, val) {
                                                        
                                                            genericnameoptions += `
                                                            <option value="` + val.id + `,` + val.itemgenericname + `">` + val.tradename + " (" + val.itemgenericname + `)</option>
                                                            `
                                                            deptitemgrpitems += `
                                                            <option value="` + val.id + `,` + val.itemgenericname + `">` + val.tradename + " (" + val.itemgenericname + `)</option>
                                                            `
                                                        })
                                                        deptitemgrpitems += `</select>`
                                                        genericnamelist = genericnameoptions
                                                        $("#selectallitem").html(genericnameoptions)
                                                        // let selectclass = $("#selectgenericnameitemgroupclass").val()
                                                        let pricinglist = displayselectedlistitems + `<tr>
                                                                    <td>` + deptitemgrpitems + `</td>
                                                                    <td></td>
                                                                    <td></td>
                                                                    <td></td>
                                                                    <td></td>
                                                                    <td></td>
                                                                    <td></td>
                                                                    <td>
                                                                            <span class="additemtolist" style="font-size:18px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                                                </tr>`
                                                        $("#view-revenue-order-list").html(pricinglist)
                                                        $("#selectdptitemgrpitem").on("change", function(evt){
                                                            evt.preventDefault()
                                                            let selecteditem = $("#selectdptitemgrpitem").val()
                                                            selectitemanddisplay(selecteditem)

                                                        })
                                                        $(".additemtolist").on("click", function(evt){
                                                                evt.preventDefault()
                                                                let selecteditem = $("#selectdptitemgrpitem").val()
                                                                selectitemanddisplay(selecteditem)
                                                        })
                                                    }
                                                
                                                })
                                            })
                                        })
                                    }

                                })
                            }

                        })
                 })

                 function selectitemanddisplay(selectitem){
                   
                    let item = selectitem
                    let splititem = item.split(",")
                    let itemid = splititem[0]
                    let itemname = splititem[1]
                    
                    let getLabItemByItemId = "getLabItemByItemId"
                    $.post("controllers/combo-setup.php",{itemid:itemid,getLabItemByItemId:getLabItemByItemId}, function(formdata){
                        //console.log(formdata)
                        if(formdata!="No Record Found"){
                            
                            let data = JSON.parse(formdata)
                                let specimen = ""
                                let sample = ""
                                let specialinstruction = ""
                                    specimen = data.records[0].specimen
                               
                                    specialinstruction = data.records[0].specialinstruction
                              
                                    sample = data.records[0].sample
                             

                                let price = parseFloat(data.records[0].sellingprice)
                                let totalprice = price 
                                let stockcode = data.records[0].stockcode
                                
                                let strength = data.records[0].strength
                                
                                let itemform = data.records[0].itemformabbreviation
                                let quantity = 1
                                let department = data.records[0].department
                                let departmentitemgroup = data.records[0].departmentitemgroup
                                let iteminfo = ""
                                let prescriptionitem = {
                                    "item":itemname,
                                    "itemid":itemid,
                                    "unitpricepiece":data.records[0].sellingprice,
                                    "unitpriceweight":data.records[0].sellingpriceperstrength,
                                    "unitpricevolume":data.records[0].sellingpriceperliquidstrength,
                                    "quantity":quantity,
                                    "totalamount":totalprice,
                                    "stockcode":stockcode,
                                    "strength":strength,
                                    "itemform":itemform,
                                    "specimen":specimen,
                                    "sample":sample,
                                    "specialinstruction":specialinstruction,
                                    "iteminfo":iteminfo
                                }
                                prescriptionorderlist.push(prescriptionitem)
                                
                                let sellingprice = parseFloat(data.records[0].sellingprice)
                               
                                let revenueorderitem = {"genericname":itemname,
                                                        "department":department,
                                                        "departmentitemgroup":departmentitemgroup,
                                                        "sellingprice":sellingprice,
                                                        "reorderlevel":"reorderlevel",
                                                        "unittype":"",
                                                        "itemid":itemid,
                                                        "quantity":quantity}
                                revenueorderlist.push(revenueorderitem)
                                displayprescriptionorder(prescriptionorderlist)
                                      
                                    
                             
                            }
                        })
                 }

                 $("#selectallitem").on("change", function(evt){
                    evt.preventDefault()
                    let item = $("#selectallitem").val()
                    let splititem = item.split(",")
                    let itemid = splititem[0]
                    let itemname = splititem[1]
                    
                    let getLabItemByItemId = "getLabItemByItemId"
                    $.post("controllers/combo-setup.php",{itemid:itemid,getLabItemByItemId:getLabItemByItemId}, function(formdata){
                        console.log(formdata)
                        if(formdata!="No Record Found"){
                            
                            let data = JSON.parse(formdata)
                                let specimen = ""
                                let sample = ""
                                let specialinstruction = ""
                                    specimen = data.records[0].specimen
                               
                                    specialinstruction = data.records[0].specialinstruction
                              
                                    sample = data.records[0].sample
                             

                                let price = parseFloat(data.records[0].sellingprice)
                                let totalprice = price 
                                let stockcode = data.records[0].stockcode
                                
                                let strength = data.records[0].strength
                                
                                let itemform = data.records[0].itemformabbreviation
                                let quantity = 1
                                let department = data.records[0].department
                                let departmentitemgroup = data.records[0].departmentitemgroup
                                let iteminfo = ""
                                let prescriptionitem = {
                                    "item":itemname,
                                    "itemid":itemid,
                                    "unitpricepiece":data.records[0].sellingprice,
                                    "unitpriceweight":data.records[0].sellingpriceperstrength,
                                    "unitpricevolume":data.records[0].sellingpriceperliquidstrength,
                                    "quantity":quantity,
                                    "totalamount":totalprice,
                                    "stockcode":stockcode,
                                    "strength":strength,
                                    "itemform":itemform,
                                    "specimen":specimen,
                                    "sample":sample,
                                    "specialinstruction":specialinstruction,
                                    "iteminfo":iteminfo
                                }
                                prescriptionorderlist.push(prescriptionitem)
                                
                                let sellingprice = parseFloat(data.records[0].sellingprice)
                               
                                let revenueorderitem = {"genericname":itemname,
                                                        "department":department,
                                                        "departmentitemgroup":departmentitemgroup,
                                                        "sellingprice":sellingprice,
                                                        "reorderlevel":"reorderlevel",
                                                        "unittype":"",
                                                        "itemid":itemid,
                                                        "quantity":quantity}
                                revenueorderlist.push(revenueorderitem)
                                displayprescriptionorder(prescriptionorderlist)
                                      
                                    
                             
                            }
                        })
                 })

                 $("#selectdepartmentitemgrouping").on("change", function(evt){
                    let departmentitemgroup = $("#selectdepartmentitemgrouping").val()
                    let GetGenericNameByDepartmentItemGrouping = "GetGenericNameByDepartmentItemGrouping"
                    $.post("controllers/combo-setup.php",{searchItem:departmentitemgroup,GetGenericNameByDepartmentItemGrouping:GetGenericNameByDepartmentItemGrouping}, function(formdata){
                        if(formdata!="No Record Found"){
                            console.log(formdata)
                            let data = JSON.parse(formdata)
                            let itemoptions = ``
                            deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                            $.each(data.records, function(key, val){
                                itemoptions += `
                                <option value=" ` + val.id + `,` + val.itemgenericname + `">` + val.itemgenericname + `</option>
                                `
                                deptitemgrpitems += `
                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.tradename + " (" + val.itemgenericname + `)</option>
                                `
                            })
                            deptitemgrpitems += `</select>`
                            // departmentitemgrouplist = departmentitemgroupoptions
                            $("#selectitem").html(itemoptions)
                            let pricinglist = displayselectedlistitems + `<tr>
                                        <td>` + deptitemgrpitems + `</td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td>
                                                <span class="additemtolist" style="font-size:18px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                    </tr>`
                            $("#view-revenue-order-list").html(pricinglist)

                            $("#selectdptitemgrpitem").on("change", function(evt){
                                evt.preventDefault()
                                let selecteditem = $("#selectdptitemgrpitem").val()
                                selectitemanddisplay(selecteditem)

                            })
                            $(".additemtolist").on("click", function(evt){
                                    evt.preventDefault()
                                    let selecteditem = $("#selectdptitemgrpitem").val()
                                    selectitemanddisplay(selecteditem)
                            })

                        }



                    })

                    // let deptItemgroup = $("#selectdepartmentitemgrouping").val()
                    let getDeptItemGrpUsageGroup = "getDeptItemGrpUsageGroup"
                    $.post("controllers/combo-setup.php",{searchItem:departmentitemgroup,getDeptItemGrpUsageGroup:getDeptItemGrpUsageGroup}, function(formdata){
                        if(formdata!="No Record Found"){
                            let data = JSON.parse(formdata)
                            let itemoptions = ``
                            $.each(data.records, function(key, val){
                                itemoptions += `
                                <option value="` + val.itemgroup + `">` + val.itemgroup + `</option>
                                `
                            })
                            genericnameusagegrouplist = itemoptions
                            $("#selectusagegroup").html(itemoptions)
                            
                            //$("#selectformdepartmentitemgroup").html(departmentitemgroupoptions)
                            let selectgroup = $("#selectusagegroup").val()
                            let getItemClassByItemGroup = "getItemClassByItemGroup"
                            $.post("controllers/combo-setup.php",{searchItem:selectgroup,getItemClassByItemGroup:getItemClassByItemGroup},function(formdata){
                                console.log(formdata)
                                let data = JSON.parse(formdata)
                                let genericnameclassoptions = ``
                                $.each(data.records, function(key, val) {
                                
                                    genericnameclassoptions += `
                                    <option value="` + val.itemclass + `">` + val.itemclass + `</option>
                                    `
                                })
                                genericnameusageclasslist = genericnameclassoptions
                                $("#selectusageclass").html(genericnameclassoptions)
                                let selectsubclassclass = $("#selectusageclass").val()
                                let getItemSubClassByClass = "getItemSubClassByClass"
                                $.post("controllers/combo-setup.php",{selectsubclassclass:selectsubclassclass,getItemSubClassByClass:getItemSubClassByClass},function(formdata){
                                    console.log(formdata)
                                    let data = JSON.parse(formdata)
                                    let genericnamesubclassoptions = `<option value="">Select Sub Class</option>`
                                    $.each(data.records, function(key, val) {
                                    
                                        genericnamesubclassoptions += `
                                        <option value="` + val.itemsubclass + `">` + val.itemsubclass + `</option>
                                        `
                                    })
                                    genericnameusagesubclasslist = genericnamesubclassoptions
                                    $("#selectusagesubclass").html(genericnamesubclassoptions)
                                    let searchItem = $("#searchitems").val()
                                    let selectsubclass = $("#selectusagesubclass").val()
                                    let GetGenericNameByUsageLABSubClass = "GetGenericNameByUsageLABSubClass"
                                    $.post("controllers/combo-setup.php",{searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByUsageLABSubClass:GetGenericNameByUsageLABSubClass},function(formdata){
                                        console.log(formdata)
                                        if(formdata!="No Record Found"){
                                            let data = JSON.parse(formdata)
                                            let genericnameoptions = ``
                                            deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                                            $.each(data.records, function(key, val) {
                                            
                                                genericnameoptions += `
                                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.tradename + " (" + val.itemgenericname + `)</option>
                                                `
                                                deptitemgrpitems += `
                                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.tradename + " (" + val.itemgenericname + `)</option>
                                                `
                                            })
                                            deptitemgrpitems += `</select>`
                                            genericnamelist = genericnameoptions
                                            $("#selectallitem").html(genericnameoptions)
                                            // let selectclass = $("#selectgenericnameitemgroupclass").val()
                                            let pricinglist = displayselectedlistitems + `<tr>
                                                        <td>` + deptitemgrpitems + `</td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td>
                                                                <span class="additemtolist" style="font-size:18px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                                    </tr>`
                                            $("#view-revenue-order-list").html(pricinglist)
                                            $("#selectdptitemgrpitem").on("change", function(evt){
                                                evt.preventDefault()
                                                let selecteditem = $("#selectdptitemgrpitem").val()
                                                selectitemanddisplay(selecteditem)

                                            })
                                            $(".additemtolist").on("click", function(evt){
                                                    evt.preventDefault()
                                                    let selecteditem = $("#selectdptitemgrpitem").val()
                                                    selectitemanddisplay(selecteditem)
                                            })
                                        }
                                    
                                    })
                                })
                            })
                        }

                    })
                 })

                
                 //Advanced Search
                 function loadPatientCards(){
                // let loadPaidPatientPards = "loadPaidPatientPards"
                let loadPatientPards = "loadPatientPards"
                $.post("controllers/patient-record.php",{loadPatientPards: loadPatientPards},function(formdata){
                        console.log("prescription: ",formdata)
                        if(formdata=="No Record Found"){
                            $("#view-item-order-count").html(formdata)
                        }else{
                            data = JSON.parse(formdata)
                            allpatientcards = data.records
                            totalnumbercards = allpatientcards.length
                            totalfoundcards = totalnumbercards
                            let patientcardlist = `<option value='0'>Select Patient</option>`
                            let count = 0
                            // console.log()
                            for(i=0;i<allpatientcards.length;i++){
                                    let status = allpatientcards[i].status
                                    
                                        count++
                                        patientcardlist += `
                                            <option value="` + allpatientcards[i].patientnumber + `">` + allpatientcards[i].person + ` [` + allpatientcards[i].status + `: ` + allpatientcards[i].cardnumber + `]</option>
                                        `

                                    
               
                                    // $("#paid").val(allpatientcards[i].status)
                            }
                                
                            totalfoundcards = count
                            $("#selectpatient").html(patientcardlist)
                            $("#patientcardtotal").html("Found " + totalfoundcards + " Cards Out of " + totalnumbercards + " Cards")
                            
                        }

                    })
                }

                let allpatientcards = []
                let totalnumbercards = 0
                let totalfoundcards = 0
                loadPatientCards()
                
                $("#searchpatient").on('change keyup paste', function () {
                    ApplyFilterGetPatient();
                });

                function ApplyFilterGetPatient() {
                    var searchitemservice = $("#searchpatient").val();
                    console.log("getPatientCards")
                    getPatientCards()
                }

                function getPatientCards(){
                    
                    // $("#viewrevenueordernumber").html("New Prescription Order")
                    let searchItem = $("#searchpatient").val()
                    
                    let count = 0
                    $("#selectpatient").html("")
                    $("#form-edit-patient").html("")
                    $("#form-view-patientstatus").html("")
                    $("#form-view-patient").html("")
                    recallprescriptionlist = []
                    $("#selectprescription").hide()
                    let patientcardlist = `<option value='0'>Select Patient</option>`
                    for(i=0;i<allpatientcards.length;i++){
                        console.log(allpatientcards[i].person)
                        
                        if(allpatientcards[i].person.includes(searchItem) || allpatientcards[i].cardnumber.includes(searchItem) || allpatientcards[i].patientnumber.includes(searchItem)){
                            count++
                            console.log(searchItem)
                            patientcardlist += `
                                <option value="` + allpatientcards[i].patientnumber + `" selected>` + allpatientcards[i].person + ` [` + allpatientcards[i].status + `: ` + allpatientcards[i].cardnumber + `]</option>
                            `
                            
                        }
                    }
                    
                    totalfoundcards = count
                    $("#selectpatient").html(patientcardlist)
                    // $("#patientcardtotal").html("Found " + totalfoundcards + " Cards Out of " + totalnumbercards + " Cards")
                    let id = $("#selectpatient").val()
                    getPatientCardId(id)
                }

                $("#selectpatient").on("change", function(evt){
                    evt.preventDefault()
                    let id = $(this).val()
                    console.log(id)
                    
                    
                    getPatientCardId(id)
                })

                let patientrevenueorderlist = []

                function getPatientCardId(id){
                    recallprescriptionlist = []
                    $("#selectprescription").hide()
                    let getPatientInfoByPatientNumber = "getPatientInfoByPatientNumber"
                    $.post("controllers/patient-record.php",{id:id,getPatientInfoByPatientNumber: getPatientInfoByPatientNumber},function(formdata){
                        // console.log(formdata)
                       
                       
                        let data = JSON.parse(formdata)
                        let patienttype = data.patienttype
                        
                        let personid = data.personid
                        $("#selectpatientnumber").val(id)
                        $("#patientid").val(data.patientid)
                        $("#patientname").val(data.person)
                        $("#personid").val(data.personid)
                       
                        
                       $("#form-patientinfo-age").html(data.age)
                       $("#form-patientinfo-hospitalno").html(data.patientnumber)
                       $("#form-patientinfo-sex").html(data.gender)
                       $("#form-patientinfo-weight").html(data.weight)
                       

                        //get item orders
                        let getPatientLaboratoryItemOrders = "getPatientLaboratoryItemOrders"
                        let patientid = data.patientid
                        $.post("controllers/patient-record.php",{id:patientid,getPatientLaboratoryItemOrders: getPatientLaboratoryItemOrders},function(orderformdata){
                            console.log(orderformdata)
                            let patientitemorderlist = ``
                            let orderdata = JSON.parse(orderformdata)
                            patientrevenueorderlist = []
                            orderdata.records.forEach(val => {
                                patientitemorderlist += `<option value="` + val.id + `">` + val.revenueordernumber + ` (` + val.status + `: ` + val.totalamount + val.itemorderdate + `)</option>`
                                patientrevenueorderlist.push(val)
                            });
                            $("#selectitemorder").html(patientitemorderlist)

                            let itemorder = patientrevenueorderlist[0].itemorder
                            console.log(itemorder)
                            let recallitems = JSON.parse(itemorder)
                            orderitemlist = recallitems
                            let itemlist = ``
                            recallitems.forEach(val => {
                                itemlist += `<option value="` + val.itemid + `">` + val.genericname + ` (` + val.sellingprice + `)</option>`

                            })
                            $("#selectitemlist").html(itemlist)
                        })

                    })
                }




                let getItemGroupByLikeDeptItemGroup = "getItemGroupByLikeDeptItemGroup"
                let genericnameusagegrouplist = ``
                let genericnameusageclasslist = ``
                let genericnameusagesubclasslist = ``
                let genericnamelist = ``

                searchAllItem = "LABORATORY"


                // splitsearch = searchItem.split(",")
                // searchItem = splitsearch[0]
                // console.log(searchItem)
                $.post("controllers/combo-setup.php",{departmentitemgroup:searchAllItem,getItemGroupByLikeDeptItemGroup: getItemGroupByLikeDeptItemGroup},function(formdata){
                     console.log(formdata)
                    if(formdata!="No Record Found"){
                        
                        let data=JSON.parse(formdata)
                        let usagegroupoptions = ``
                        $.each(data.records, function(key, val) {
                        
                            usagegroupoptions += `
                            <option value="` + val.itemgroup + `">` + val.itemgroup + `</option>
                        `
                        })
                        genericnameusagegrouplist = usagegroupoptions
                        $("#selectusagegroup").html(usagegroupoptions)
                        //$("#selectformdepartmentitemgroup").html(departmentitemgroupoptions)
                        let selectgroup = $("#selectusagegroup").val()
                        let getItemClassByItemGroup = "getItemClassByItemGroup"
                        $.post("controllers/combo-setup.php",{searchItem:selectgroup,getItemClassByItemGroup:getItemClassByItemGroup},function(formdata){
                            console.log(formdata)
                            let data = JSON.parse(formdata)
                            let genericnameclassoptions = ``
                            $.each(data.records, function(key, val) {
                            
                                genericnameclassoptions += `
                                <option value="` + val.itemclass + `">` + val.itemclass + `</option>
                                `
                            })
                            genericnameusageclasslist = genericnameclassoptions
                            $("#selectusageclass").html(genericnameclassoptions)
                            let selectsubclassclass = $("#selectusageclass").val()
                            let getItemSubClassByClass = "getItemSubClassByClass"
                            $.post("controllers/combo-setup.php",{selectsubclassclass:selectsubclassclass,getItemSubClassByClass:getItemSubClassByClass},function(formdata){
                                console.log(formdata)
                                let data = JSON.parse(formdata)
                                let genericnamesubclassoptions = `<option value="">Select Sub Class</option>`
                                $.each(data.records, function(key, val) {
                                
                                    genericnamesubclassoptions += `
                                    <option value="` + val.itemsubclass + `">` + val.itemsubclass + `</option>
                                    `
                                })
                                genericnameusagesubclasslist = genericnamesubclassoptions
                                $("#selectusagesubclass").html(genericnamesubclassoptions)
                                let searchItem = $("#searchitems").val()
                                let selectsubclass = $("#selectusagesubclass").val()
                                let GetGenericNameByUsageLABSubClass = "GetGenericNameByUsageLABSubClass"
                                $.post("controllers/combo-setup.php",{searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByUsageLABSubClass:GetGenericNameByUsageLABSubClass},function(formdata){
                                    console.log(formdata)
                                    if(formdata!="No Record Found"){
                                         let data = JSON.parse(formdata)
                                        let genericnameoptions = ``
                                        deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                                        $.each(data.records, function(key, val) {
                                        
                                            genericnameoptions += `
                                            <option value="` + val.id + `,` + val.itemgenericname + `">` + val.tradename + " (" + val.itemgenericname + `)</option>
                                            `
                                            deptitemgrpitems += `
                                            <option value="` + val.id + `,` + val.itemgenericname + `">` + val.tradename + " (" + val.itemgenericname + `)</option>
                                            `
                                        })
                                        deptitemgrpitems += `</select>`
                                        genericnamelist = genericnameoptions
                                        $("#selectallitem").html(genericnameoptions)
                                        // let selectclass = $("#selectgenericnameitemgroupclass").val()
                                        let pricinglist = displayselectedlistitems + `<tr>
                                                    <td>` + deptitemgrpitems + `</td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td>
                                                            <span class="additemtolist" style="font-size:18px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                                </tr>`
                                        $("#view-revenue-order-list").html(pricinglist)
                                        $("#selectdptitemgrpitem").on("change", function(evt){
                                            evt.preventDefault()
                                            let selecteditem = $("#selectdptitemgrpitem").val()
                                            selectitemanddisplay(selecteditem)

                                        })
                                        $(".additemtolist").on("click", function(evt){
                                                evt.preventDefault()
                                                let selecteditem = $("#selectdptitemgrpitem").val()
                                                selectitemanddisplay(selecteditem)
                                        })
                                    }
                                   
                                })
                            })
                        })
                    }
                })


                $("#searchitems").on('change keyup paste', function () {
                    ApplyFilterGenericName();
                });

                function ApplyFilterGenericName() {
                    var searchString = $("#searchitems").val();
                    console.log("GetSubDepartmentsFunction")
                    GetGenericNameFunction()
                }

                $("#selectitemorder").on("change", function(evt){
                    evt.preventDefault()
                    let revenueorderid = $("#selectitemorder").val()
                    
                    patientrevenueorderlist.forEach(val => {
                       
                        if(revenueorderid==val.id){
                            let itemorder = val.itemorder
                            recallitems = JSON.parse(itemorder)
                            
                            let itemlist = ``
                            recallitems.forEach(val => {
                                itemlist += `<option value="` + val.itemid + `">` + val.genericname + ` (` + val.sellingprice + `)</option>`

                            })
                            $("#selectitemlist").html(itemlist)
                        }
                    
                    });

                })

                $("#recall-itemorder-button").on("click", function(evt){
                    evt.preventDefault()
                    let revenueorderid = $("#selectitemorder").val()
                    console.log(patientrevenueorderlist)
                    
                    patientrevenueorderlist.forEach(val => {
                        
                        if(revenueorderid==val.id){
                            let itemorder = val.itemorder
                            let prescriptionorder = val.laboratoryorder
                            prescriptionorderlist = JSON.parse(prescriptionorder)
                                                        
                           
                            $("#revenue-order-id").val(val.id)
                            $("#revenue-order-number").val(val.revenueordernumber)
                            displayprescriptionorder(prescriptionorderlist)
                            $("#viewrevenueordernumber").html(val.revenueordernumber)
                            
                            $("#discard-revenue-order-button").show()
                            $("#update-revenue-order-button").show()
                            $("#add-revenue-order-button").hide()
                        }
                    
                    });
                    

                    

                })

               

                function GetGenericNameFunction(){
                    let searchItem = $("#searchitems").val()
                    let selectsubclass = $("#selectusagesubclass").val()
                    let  = "GetGenericNameByUsageLABSubClass"
                    $.post("controllers/combo-setup.php",{searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByUsageLABSubClass:GetGenericNameByUsageLABSubClass},function(formdata){
                        console.log(formdata)
                        if(formdata!="No RecGetGenericNameByUsageLABSubClassord Found"){
                            let data = JSON.parse(formdata)
                            let genericnameoptions = ``
                            deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                            $.each(data.records, function(key, val) {
                            
                                genericnameoptions += `
                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.tradename + " (" + val.itemgenericname + `)</option>
                                `
                                deptitemgrpitems += `
                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.tradename + " (" + val.itemgenericname + `)</option>
                                `
                            })
                            deptitemgrpitems += `</select>`
                            genericnamelist = genericnameoptions
                            $("#selectallitem").html(genericnameoptions)
                            // let selectclass = $("#selectgenericnameitemgroupclass").val()
                            let pricinglist = displayselectedlistitems + `<tr>
                                        <td>` + deptitemgrpitems + `</td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td>
                                                <span class="additemtolist" style="font-size:18px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                    </tr>`
                            $("#view-revenue-order-list").html(pricinglist)
                            $("#selectdptitemgrpitem").on("change", function(evt){
                                evt.preventDefault()
                                let selecteditem = $("#selectdptitemgrpitem").val()
                                selectitemanddisplay(selecteditem)

                            })
                            $(".additemtolist").on("click", function(evt){
                                    evt.preventDefault()
                                    let selecteditem = $("#selectdptitemgrpitem").val()
                                    selectitemanddisplay(selecteditem)
                            })
                        }
                        
                    })
                }
                $("#selectusagesubclass").on("change", function(evt){
                    evt.preventDefault()
                    let searchItem = $("#searchitems").val()
                    let selectsubclass = $("#selectusagesubclass").val()
                    let GetGenericNameByUsageLABSubClass = "GetGenericNameByUsageLABSubClass"
                    $.post("controllers/combo-setup.php",{searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByUsageLABSubClass:GetGenericNameByUsageLABSubClass},function(formdata){
                        console.log(formdata)
                        if(formdata!="No Record Found"){
                            let data = JSON.parse(formdata)
                            let genericnameoptions = ``
                            deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                            $.each(data.records, function(key, val) {
                            
                                genericnameoptions += `
                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.tradename + " (" + val.itemgenericname + `)</option>
                                `
                                deptitemgrpitems += `
                                <option value="` + val.id + `,` + val.itemgenericname + `">` + val.tradename + " (" + val.itemgenericname + `)</option>
                                `
                            })
                            deptitemgrpitems += `</select>`
                            genericnamelist = genericnameoptions
                            $("#selectallitem").html(genericnameoptions)
                            // let selectclass = $("#selectgenericnameitemgroupclass").val()
                            let pricinglist = displayselectedlistitems + `<tr>
                                        <td>` + deptitemgrpitems + `</td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td>
                                                <span class="additemtolist" style="font-size:18px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                    </tr>`
                            $("#view-revenue-order-list").html(pricinglist)
                            $("#selectdptitemgrpitem").on("change", function(evt){
                                evt.preventDefault()
                                let selecteditem = $("#selectdptitemgrpitem").val()
                                selectitemanddisplay(selecteditem)

                            })
                            $(".additemtolist").on("click", function(evt){
                                    evt.preventDefault()
                                    let selecteditem = $("#selectdptitemgrpitem").val()
                                    selectitemanddisplay(selecteditem)
                            })
                        }
                        
                    })
                })


                $("#selectusagegroup").on("change", function(evt){
                    evt.preventDefault()
                    //$("#selectformdepartmentitemgroup").html(departmentitemgroupoptions)
                    let selectgroup = $("#selectusagegroup").val()
                    let getItemClassByItemGroup = "getItemClassByItemGroup"
                    console.log(selectgroup)
                    $.post("controllers/combo-setup.php",{searchItem:selectgroup,getItemClassByItemGroup:getItemClassByItemGroup},function(formdata){
                        console.log(formdata)
                        let data = JSON.parse(formdata)
                        let genericnameclassoptions = ``
                        $.each(data.records, function(key, val) {
                        
                            genericnameclassoptions += `
                            <option value="` + val.itemclass + `">` + val.itemclass + `</option>
                            `
                        })
                        genericnameusageclasslist = genericnameclassoptions
                        $("#selectusageclass").html(genericnameclassoptions)
                        let selectsubclassclass = $("#selectusageclass").val()
                        let getItemSubClassByClass = "getItemSubClassByClass"
                        $.post("controllers/combo-setup.php",{selectsubclassclass:selectsubclassclass,getItemSubClassByClass:getItemSubClassByClass},function(formdata){
                            console.log(formdata)
                            let data = JSON.parse(formdata)
                            let genericnamesubclassoptions = `<option value="">Select Sub Class</option>`
                            $.each(data.records, function(key, val) {
                            
                                genericnamesubclassoptions += `
                                <option value="` + val.itemsubclass + `">` + val.itemsubclass + `</option>
                                `
                            })
                            genericnameusagesubclasslist = genericnamesubclassoptions
                            $("#selectusagesubclass").html(genericnamesubclassoptions)
                            let searchItem = $("#searchitems").val()
                            let selectsubclass = $("#selectusagesubclass").val()
                            let GetGenericNameByUsageLABSubClass = "GetGenericNameByUsageLABSubClass"
                            $.post("controllers/combo-setup.php",{searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByUsageLABSubClass:GetGenericNameByUsageLABSubClass},function(formdata){
                                console.log(formdata)
                                if(formdata!="No Record Found"){
                                    let data = JSON.parse(formdata)
                                    let genericnameoptions = ``
                                    deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                                    $.each(data.records, function(key, val) {
                                    
                                        genericnameoptions += `
                                        <option value="` + val.id + `,` + val.itemgenericname + `">` + val.tradename + " (" + val.itemgenericname + `)</option>
                                        `
                                        deptitemgrpitems += `
                                        <option value="` + val.id + `,` + val.itemgenericname + `">` + val.tradename + " (" + val.itemgenericname + `)</option>
                                        `
                                    })
                                    deptitemgrpitems += `</select>`
                                    genericnamelist = genericnameoptions
                                    $("#selectallitem").html(genericnameoptions)
                                    // let selectclass = $("#selectgenericnameitemgroupclass").val()
                                    let pricinglist = displayselectedlistitems + `<tr>
                                                <td>` + deptitemgrpitems + `</td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td>
                                                        <span class="additemtolist" style="font-size:18px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                            </tr>`
                                    $("#view-revenue-order-list").html(pricinglist)
                                    $("#selectdptitemgrpitem").on("change", function(evt){
                                        evt.preventDefault()
                                        let selecteditem = $("#selectdptitemgrpitem").val()
                                        selectitemanddisplay(selecteditem)

                                    })
                                    $(".additemtolist").on("click", function(evt){
                                            evt.preventDefault()
                                            let selecteditem = $("#selectdptitemgrpitem").val()
                                            selectitemanddisplay(selecteditem)
                                    })
                                }
                                
                            })
                        })
                    })
                })


                $("#selectusageclass").on("change", function(evt){
                    evt.preventDefault()
                    let selectsubclassclass = $("#selectusageclass").val()
                    let getItemSubClassByClass = "getItemSubClassByClass"
                    $.post("controllers/combo-setup.php",{selectsubclassclass:selectsubclassclass,getItemSubClassByClass:getItemSubClassByClass},function(formdata){
                        console.log(formdata)
                        let data = JSON.parse(formdata)
                        let genericnamesubclassoptions = `<option value="">Select Sub Class</option>`
                        $.each(data.records, function(key, val) {
                        
                            genericnamesubclassoptions += `
                            <option value="` + val.itemsubclass + `">` + val.itemsubclass + `</option>
                            `
                        })
                        genericnameusagesubclasslist = genericnamesubclassoptions
                        $("#selectusagesubclass").html(genericnamesubclassoptions)
                        let searchItem = $("#searchitems").val()
                        let selectsubclass = $("#selectusagesubclass").val()
                        let GetGenericNameByUsageLABSubClass = "GetGenericNameByUsageLABSubClass"
                        $.post("controllers/combo-setup.php",{searchItem:searchItem,itemsubclass:selectsubclass,GetGenericNameByUsageLABSubClass:GetGenericNameByUsageLABSubClass},function(formdata){
                            console.log(formdata)
                            if(formdata!="No Record Found"){
                                let data = JSON.parse(formdata)
                                let genericnameoptions = ``
                                deptitemgrpitems = `<select id="selectdptitemgrpitem" name="selectdptitemgrpitem" class="form-control">`
                                $.each(data.records, function(key, val) {
                                
                                    genericnameoptions += `
                                    <option value="` + val.id + `,` + val.itemgenericname + `">` + val.tradename + " (" + val.itemgenericname + `)</option>
                                    `
                                    deptitemgrpitems += `
                                    <option value="` + val.id + `,` + val.itemgenericname + `">` + val.tradename + " (" + val.itemgenericname + `)</option>
                                    `
                                })
                                deptitemgrpitems += `</select>`
                                genericnamelist = genericnameoptions
                                $("#selectallitem").html(genericnameoptions)
                                // let selectclass = $("#selectgenericnameitemgroupclass").val()
                                let pricinglist = displayselectedlistitems + `<tr>
                                            <td>` + deptitemgrpitems + `</td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td>
                                                    <span class="additemtolist" style="font-size:18px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                        </tr>`
                                $("#view-revenue-order-list").html(pricinglist)
                                $("#selectdptitemgrpitem").on("change", function(evt){
                                    evt.preventDefault()
                                    let selecteditem = $("#selectdptitemgrpitem").val()
                                    selectitemanddisplay(selecteditem)

                                })
                                $(".additemtolist").on("click", function(evt){
                                        evt.preventDefault()
                                        let selecteditem = $("#selectdptitemgrpitem").val()
                                        selectitemanddisplay(selecteditem)
                                })
                            }
                            
                        })
                    })
                })




                //Add Laboratory Setup

                let itemstrength = ""
            let getSpecimen = "getSpecimen"
            // let searchItem = ""
            let specimenlist = ""
            $.post("controllers/combo-setup.php",{searchSpecimen:searchItem,getSpecimen:getSpecimen}, function(data){
                if(data!="No Record Found"){
                    let stocktypeoptions = `<option value="">No Selection</option>`
                    data = JSON.parse(data)
                    $.each(data.records, function(key, val) {
                        stocktypeoptions += `<option value="` + val.specimen + `,` + val.id + `">` + val.specimen + `</option>`
                    });
                    specimenlist = stocktypeoptions
                    // $("#selectspecimen").html(stocktypeoptions)
                }
            })
            let samsplecollectionlist = ""
            let getSample = "getSample"
            $.post("controllers/combo-setup.php",{searchSample:searchItem,getSample:getSample}, function(data){
                if(data!="No Record Found"){
                    let supplieroptions = `<option value="">No Selection</option>`
                    data = JSON.parse(data)
                    $.each(data.records, function(key, val) {
                        supplieroptions += `<option value="` + val.sample + `,` + val.id + `">` + val.sample + `</option>`
                    });
                    samsplecollectionlist = supplieroptions
                    // $("#selectsamplecollection").html(supplieroptions)
                }
            })

            $("#add-prescription-order-button").show()
            $("#discard-prescription-order-button").hide()
            $("#update-prescription-order-button").hide()
            $("#cancel-prescription-order-button").hide()

            let prescriptionorderlist = []
            let revenueorderlist = []
            let prescriptionlist = []
                // Add item to revenue order List
                $("#add-allitem-button").on("click", function(evt){
                    evt.preventDefault()
                    let item = $("#selectallitem").val()
                    let splititem = item.split(",")
                    let itemid = splititem[0]
                    let itemname = splititem[1]
                    
                    let getLabItemByItemId = "getLabItemByItemId"
                    $.post("controllers/combo-setup.php",{itemid:itemid,getLabItemByItemId:getLabItemByItemId}, function(formdata){
                        //console.log(formdata)
                        if(formdata!="No Record Found"){
                            
                            let data = JSON.parse(formdata)
                                let specimen = ""
                                let sample = ""
                                let specialinstruction = ""
                                    specimen = data.records[0].specimen
                               
                                    specialinstruction = data.records[0].specialinstruction
                              
                                    sample = data.records[0].sample
                             

                                let price = parseFloat(data.records[0].sellingprice)
                                let totalprice = price 
                                let stockcode = data.records[0].stockcode
                                
                                let strength = data.records[0].strength
                                
                                let itemform = data.records[0].itemformabbreviation
                                let quantity = 1
                                let department = data.records[0].department
                                let departmentitemgroup = data.records[0].departmentitemgroup
                                let iteminfo = ""
                                let prescriptionitem = {
                                    "item":itemname,
                                    "itemid":itemid,
                                    "unitpricepiece":data.records[0].sellingprice,
                                    "unitpriceweight":data.records[0].sellingpriceperstrength,
                                    "unitpricevolume":data.records[0].sellingpriceperliquidstrength,
                                    "quantity":quantity,
                                    "totalamount":totalprice,
                                    "stockcode":stockcode,
                                    "strength":strength,
                                    "itemform":itemform,
                                    "specimen":specimen,
                                    "sample":sample,
                                    "specialinstruction":specialinstruction,
                                    "iteminfo":iteminfo
                                }
                                prescriptionorderlist.push(prescriptionitem)
                                
                                let sellingprice = parseFloat(data.records[0].sellingprice)
                               
                                let revenueorderitem = {"genericname":itemname,
                                                        "department":department,
                                                        "departmentitemgroup":departmentitemgroup,
                                                        "sellingprice":sellingprice,
                                                        "reorderlevel":"reorderlevel",
                                                        "unittype":"",
                                                        "itemid":itemid,
                                                        "quantity":quantity}
                                revenueorderlist.push(revenueorderitem)
                                displayprescriptionorder(prescriptionorderlist)
                                      
                                    
                             
                            }
                        })
                      })

                let totalrevenueorderprice = 0
                let totalrevenueorderitems = 0
                function displayprescriptionorder(prescriptionorderlist){
                    console.log(prescriptionorderlist)
                    if(prescriptionorderlist.length>0){
                        let count = 0
                        let totalprice = 0
                        let totalitems = 0
                        let viewprescriptionlist = ``
                        prescriptionorderlist.forEach(element => {
                            let item = element.item
                            let itemid = element.itemid
                            let route = element.route
                            let unitpricepiece = element.unitpricepiece
                            let unitpriceweight = element.unitpriceweight
                            
                            let unitpricevolume = element.unitpricevolume
                            let totalamount = element.totalamount
                            let stockcode = element.stockcode
                            
                            let strength = element.strength
                            let iteminfo = element.specialinstruction
                            let quantity = element.quantity
                            let itemform = element.itemform
                            let specimen = element.specimen
                            let sample = element.sample
                            

                            let price = unitpricepiece
                            
                            console.log(unitpricepiece, unitpriceweight, unitpricevolume, price)
                            
                            let total = parseFloat(price) * parseFloat(quantity)
                            totalitems++
                            totalprice += total
                            totalrevenueorderprice = totalprice
                            totalrevenueorderitems = totalitems
                            
                                viewprescriptionlist += `<tr>
                                                    <td>
                                                        
                                                        <input type="checkbox" style="height: 25px;width:25px;" class="itemselect" data-id="` + count + `">
                                                    </td> 
                                                    <td>` + itemform + " " + item + `</td>
                                                    <td>` + specimen + `</td>
                                                    <td>`+ sample + `</td>
                                                    <td>&#8358;`+ Number(price).toFixed(2) + `</td>
                                                    <td>`+ quantity + `</td>
                                                    <td>&#8358;` + Number(total).toFixed(2) + `</td>
                                                    
                                                    <td>` + iteminfo + `</td>
                                                    
                                                    <td><input type="number" min="1" max="1000" class="multiplyitem" data-id="` + count + `"></td>
                                                    <td><span class="additem" data-id="` + count + `" style="font-size: 16px;"><i class="fa fa-plus-square"></i>
                                                        <span class="subtractitem" data-id="` + count + `" style="font-size: 16px;"><i class="fa fa-minus-square"></i>
                                                            <span class="deleteitem" data-id="` + count + `" style="font-size: 16px;"><i class="fa fa-trash-o"></i></span></td>
                                                </tr>
                                    `
                                    count++
                                });

                                displayselectedlistitems = viewprescriptionlist
                                viewprescriptionlist += `<tr>
                                                    <td>` + deptitemgrpitems + `</td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td>
                                                            <span class="additemtolist" style="font-size:18px;cursor:pointer;"><i class="fa fa-plus-square"></i> Add</span></td>
                                                </tr>`

                                $("#view-revenue-order-list").html(viewprescriptionlist)
                                $("#selectdptitemgrpitem").on("change", function(evt){
                                    evt.preventDefault()
                                    let selecteditem = $("#selectdptitemgrpitem").val()
                                    selectitemanddisplay(selecteditem)

                                })
                                $(".additemtolist").on("click", function(evt){
                                        evt.preventDefault()
                                        let selecteditem = $("#selectdptitemgrpitem").val()
                                        selectitemanddisplay(selecteditem)
                                })
                                $("#view-revenue-order-count").html(totalitems + " Item(s)")
                                $("#view-revenue-order-price").html("Total: &#8358;" + totalprice.toFixed(2))
                                $(".deleteitem").on("click", function(evt){
                                        evt.preventDefault()
                                        let id = $(this).attr("data-id")
                                    
                                        prescriptionorderlist.splice(id, 1)
                                        console.log(id)
                                        
                                        displayprescriptionorder(prescriptionorderlist)

                                    })
                                    $(".itemselect").change(function(){
                                        if($(this).is(":checked")){
                                            
                                            let id = $(this).attr("data-id")
                                            

                                        } 
                                    })
                                
                                $(".multiplyitem").on('change paste', function () {
                                   let qty = $(this).val()

                                    let id = $(this).attr("data-id")
                                
                                    prescriptionorderlist[id].quantity = qty
                                console.log(prescriptionorderlist)
                                    // $("#view-revenue-order-price").html("&#8358;" + totalprice.toFixed(2))

                                    displayprescriptionorder(prescriptionorderlist)

                                })

                                $(".additem").on("click", function(evt){
                                    evt.preventDefault()
                                    let id = $(this).attr("data-id")
                                
                                    prescriptionorderlist[id].quantity = prescriptionorderlist[id].quantity + 1
                                   console.log(prescriptionorderlist)
                                    // $("#view-revenue-order-price").html("&#8358;" + totalprice.toFixed(2))

                                    displayprescriptionorder(prescriptionorderlist)

                                })

                                $(".subtractitem").on("click", function(evt){
                                        evt.preventDefault()
                                        let id = $(this).attr("data-id")
                                    
                                        prescriptionorderlist[id].quantity = prescriptionorderlist[id].quantity -1
                                        if(prescriptionorderlist[id].quantity==0){
                                            prescriptionorderlist.splice(id, 1)
                                        }
                                        
                                        
                                        displayprescriptionorder(prescriptionorderlist)

                                    })
                               
                    } else {
                        $("#view-revenue-order-list").html("")
                        $("#view-revenue-order-count").html("")
                        $("#view-revenue-order-price").html("")
                    }
                }
                $("#selectallitems").on("click", function(evt){
                    // totalpaiditems =0
                    // totalpaid =0
                    $(".itemselect").each(function(index, obj){
                        $(this).prop('checked',true)
                       
                    })
                })
                $("#add-prescription-order-button").on("click",function(evt){
                    evt.preventDefault()

                    let patientname = ""
                    let patientid = 0
                    let cardnumber = ""
                    let personid = 0
                    let hospitalnumber = ""
                    console.log($("#selectpatient").val())
                    let selectpatient = $("#selectpatient").val()
                    console.log(selectpatient, typeof(selectpatient))
                    hospitalnumber = $("#selectpatientnumber").val()
                       
                     patientname = $("#patientname").val()
                     patientid = parseFloat($("#patientid").val())
                    personid =  $("#personid").val()

                    let insertRevenueOrder = "insertRevenueOrder"
                    let list = JSON.stringify(revenueorderlist)
                    let price = parseFloat(totalrevenueorderprice).toFixed(2)
                    let items = totalrevenueorderitems
                    let department = "LABORATORY DEPARTMENT"
                    let patienttype = "PATIENT"
                    console.log(patientid,personid,hospitalnumber,patientname)
                    $.post("controllers/finance-record.php", {patienttype:patienttype,department:department,patientname:patientname,patientid:patientid,personid:personid,cardnumber:cardnumber,hospitalnumber:hospitalnumber,price:price,items:totalrevenueorderitems,list:list,insertRevenueOrder:insertRevenueOrder}, function(data){
                        console.log(data)
                        $("#revenue-order-status").html(data)
                        let revenueordernumber = data
                        
                        let insertLaboratoryOrder = "insertLaboratoryOrder"
                        let prescriptionlist = JSON.stringify(prescriptionorderlist)
                        // let prescriptionprice = parseFloat(totalrevenueorderprice).toFixed(2)
                        
                        // let department = $("#selectdepartment").val()
                        // let splitdepartment = department.split(",")
                        // let itemdepartment = splitdepartment[1]
                        
                        $.post("controllers/finance-record.php", {revenueordernumber:revenueordernumber,patientname:patientname,patientid:patientid,personid:personid,cardnumber:cardnumber,hospitalnumber:hospitalnumber,price:price,items:totalrevenueorderitems,list:prescriptionlist,insertLaboratoryOrder:insertLaboratoryOrder}, function(data){
                            console.log(data)
                            $("#revenue-order-status").html(data)
                            revenueorderlist = []
                            // displayrevenueorder(revenueorderlist)
                            getRevenueOrders()
                        }) 
                    }) 

                })

                $("#update-prescription-order-button").on("click",function(evt){
                    evt.preventDefault()

                    let patientname = ""
                    let patientid = 0
                    let cardnumber = ""
                    let personid = 0
                    let hospitalnumber = ""
                    console.log($("#selectpatient").val())
                    let selectpatient = $("#selectpatient").val()
                    console.log(selectpatient, typeof(selectpatient))
                    hospitalnumber = $("#selectpatientnumber").val()
                       
                       patientname = $("#patientname").val()
                       patientid = parseFloat($("#patientid").val())
                      personid =  $("#personid").val()
                    let id = $("#prescriptionorderid").val()
                    let price = parseFloat(totalrevenueorderprice).toFixed(2)
                    let items = totalrevenueorderitems
                    let department = "LABORATORY DEPARTMENT"
                    
                    let updateLaboratoryOrder = "updateLaboratoryOrder"
                    let prescriptionlist = JSON.stringify(prescriptionorderlist)
                    let revenuelist = JSON.stringify(revenueorderlist)
                    // let prescriptionprice = parseFloat(totalrevenueorderprice).toFixed(2)
                    let prescriptionnumber = $("#viewrevenueordernumber").val()
                    let revenueordernumber = $("#revenue-order-number").val()
                    // let department = $("#selectdepartment").val()
                    // let splitdepartment = department.split(",")
                    // let itemdepartment = splitdepartment[1]
                    // console.log(patientname,revenueordernumber)
                    $.post("controllers/finance-record.php", {id:id,revenuelist:revenuelist,revenueordernumber:revenueordernumber,prescriptionnumber:prescriptionnumber,patientname:patientname,patientid:patientid,personid:personid,hospitalnumber:hospitalnumber,price:price,items:totalrevenueorderitems,list:prescriptionlist,updateLaboratoryOrder:updateLaboratoryOrder}, function(data){
                        console.log(data)
                        $("#revenue-order-status").html(data)
                        $("#add-prescription-order-button").show()
                        $("#update-prescription-order-button").hide()
                        $("#cancel-prescription-order-button").hide()
                        prescriptionorderlist = []
                        displayprescriptionorder(prescriptionorderlist)
                        getRevenueOrders()
                    }) 
                

                })

                $("#clear-patient-prescription").on("click", function(evt){
                    evt.preventDefault()


                    $("#selectpatient").html("")
                    $("#form-edit-patient").html("")
                    $("#form-view-patientstatus").html("")
                    $("#form-view-patient").html("")
                    
                    $("#selectpatientnumber").val("")
                    $("#patientid").val("0")
                    $("#patientname").val("")
                 
                    $("#personid").val("0")
                    $("#patientweight").val("")
                    $("#patientgender").val("")
                    $("#agegroup").val("")
                    recallprescriptionlist = []
                    $("#selectprescription").hide()
                })

                let recallprescriptionlist = []
                $("#selectprescription").hide()


                $("#recall-prescription-button").on("click", function(evt){
                    evt.preventDefault()

                    let patientnumber = $("#selectpatientnumber").val()
                    console.log(patientnumber)
                    let getLaboratoryOrderByPatientNumber = "getLaboratoryOrderByPatientNumber"
                    $.post("controllers/finance-record.php", {patientnumber:patientnumber, getLaboratoryOrderByPatientNumber: getLaboratoryOrderByPatientNumber}, function(data){
                        console.log(data)
                        formdata=JSON.parse(data)
                        recallprescriptionlist = formdata.records
                        let prescription = recallprescriptionlist[0].prescription
                        revenueorderlist = JSON.parse(prescription)
                        $("#patientid").val(recallprescriptionlist[0].patientid)
                        $("#patientname").val(recallprescriptionlist[0].patientname)
                        $("#prescriptionorderid").val(recallprescriptionlist[0].id)
                        $("#revenue-order-number").val(recallprescriptionlist[0].revenueordernumber)
                        let prescriptionlist = recallprescriptionlist[0].prescription
                        displayprescriptionorder(revenueorderlist)
                        prescriptionorderlist = revenueorderlist

                        let revenueorder = recallprescriptionlist[0].revenueorder
                        revenueorderlist = JSON.parse(revenueorder)


                        $("#viewrevenueordernumber").html(recallprescriptionlist[0].prescriptionnumber)
                        
                        $("#add-prescription-order-button").hide()
                        $("#update-prescription-order-button").show()
                        $("#cancel-prescription-order-button").show()

                        let selectprescriptionlist = ``
                        let count = 0
                        recallprescriptionlist.forEach(val => {
                            selectprescriptionlist += `<option value="` + count + `">` + val.prescriptionnumber + ` (` + val.entereddate + `)</option>`
                            count++
                        });
                        $("#selectprescription").html(selectprescriptionlist)
                        $("#selectprescription").show()
        
                    })

                })

                $("#selectprescription").on("change", function(evt){
                    evt.preventDefault()
                    let id = $(this).val()
                    let prescription = recallprescriptionlist[id].prescription
                        revenueorderlist = JSON.parse(prescription)
                        $("#patientid").val(recallprescriptionlist[id].patientid)
                        $("#patientname").val(recallprescriptionlist[id].patientname)
                        $("#prescriptionorderid").val(recallprescriptionlist[id].id)
                        $("#revenue-order-number").val(recallprescriptionlist[id].revenueordernumber)
                        let prescriptionlist = recallprescriptionlist[id].prescription
                        displayprescriptionorder(revenueorderlist)
                        prescriptionorderlist = revenueorderlist

                        let revenueorder = recallprescriptionlist[id].revenueorder
                        revenueorderlist = JSON.parse(revenueorder)

                        $("#viewrevenueordernumber").html(recallprescriptionlist[id].prescriptionnumber)
                        
                        $("#add-prescription-order-button").hide()
                        $("#update-prescription-order-button").show()
                        $("#cancel-prescription-order-button").show()

                })

                getRevenueOrders()
                $("#searchrevenueorder").on('change keyup paste', function () {
                    ApplyFilterGetItem();
                });

                function ApplyFilterGetItem() {
                    var searchitemservice = $("#searchrevenueorder").val();
                    console.log("getRevenueOrders")
                    getRevenueOrders()
                }
                function getRevenueOrders(){
                    $("#add-prescription-order-button").show()
                    $("#discard-prescription-order-button").hide()
                    $("#update-prescription-order-button").hide()
                    $("#viewrevenueordernumber").html("New Laboratory Order")
                    let searchItem = $("#searchrevenueorder").val()
                    getLaboratoryOrder = "getLaboratoryOrder"
                    $.post("controllers/finance-record.php",{searchItem:searchItem,getLaboratoryOrder: getLaboratoryOrder},function(formdata){
                        console.log("prescription: ",formdata)
                        if(formdata=="No Record Found"){
                            $("#view-item-order-count").html(formdata)
                        }else{
                            console.log(formdata)
                            console.log(typeof(formdata))
                            let data=JSON.parse(formdata)
                            console.log(data)
                            let count = 0
                                
                            let totalrecord = ``
                            $.each(data.records, function(key, val) {
                                count++
                                
                            totalrecord += `
                                <tr>
                                   
                                    <td>
                                        
                                        <a href="#" data-id="` + val.id + `" class="btn btn-outline-default take-btn itemordername"><h3 style="color:blue;">` + val.prescriptionnumber + `</h3></a>
                                    </td>                 
                                    <td>
                                            <p style="font-size:18px;font-weight:bold;">` + val.patientname + ` [` + val.hospitalnumber + `]</p>
                                    </td> 
                                    
                                    <td>
                                            <p style="font-size:18px;font-weight:bold;">` + val.entereddate + `</p>
                                    </td> 
                                    <td>
                                            <p style="font-size:18px;font-weight:bold;">&#8358;` + (parseFloat(val.totalamount)).toFixed(2) + `</p>
                                    </td> 
                                    
                                    <td>
                                            <p style="font-size:18px;font-weight:bold;">` + val.enteredby + ` (Updated ` + val.updateddate + `)</p>
                                    </td> 
                                    
                                    <td>
                                        <a href="#" data-id="` + val.id + `" class="btn btn-outline-danger take-btn delete-revenue-order">Delete</a>
                                    </td> 
                                </tr>
                            `
                            })
                            $("#view-item-order-count").html(count + " Record(s) Found")
                            $("#view-all-revenue-order-list").html(totalrecord)
                            totalpaiditems = 0
                            totalpaid = 0
                        }
                        

                            $(".itemordername").on("click", function(evt){
                                evt.preventDefault()
                                let id = $(this).attr("data-id")
                                let getLaboratoryOrderById = "getLaboratoryOrderById"
                                $.post("controllers/finance-record.php", {id:id, getLaboratoryOrderById: getLaboratoryOrderById}, function(data){
                                    console.log(data)
                                    formdata=JSON.parse(data)
                                    let prescription = formdata.prescription
                                    revenueorderlist = JSON.parse(prescription)
                                    $("#patientid").val(formdata.patientid)
                                    $("#patientname").val(formdata.patientname)
                                    $("#prescriptionorderid").val(formdata.id)
                                    $("#revenue-order-number").val(formdata.revenueordernumber)
                                    let prescriptionlist = formdata.prescription
                                    displayprescriptionorder(revenueorderlist)
                                    prescriptionorderlist = revenueorderlist

                                    let revenueorder = formdata.revenueorder
                                    revenueorderlist = JSON.parse(revenueorder)

                                    $("#viewrevenueordernumber").html(formdata.prescriptionnumber)
                                    
                                    $("#add-prescription-order-button").hide()
                                    $("#update-prescription-order-button").show()
                                    $("#cancel-prescription-order-button").show()
                   
                                })
                                
                            })

                        $(".delete-revenue-order").on("click", function(evt){
                            evt.preventDefault()
                                let id = $(this).attr("data-id")
                                let DeletePrescriptionOrderById = "DeletePrescriptionOrderById"
                                $.post("controllers/finance-record.php", {id:id, DeletePrescriptionOrderById: DeletePrescriptionOrderById}, function(data){
                                    console.log(data)
                                    $("#revenue-order-status").html(data)
                                    getRevenueOrders()
                                })
                                
                        })
                    })
                    
                }
        })
    </script>
</body>

</html>